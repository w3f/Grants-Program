"use strict";(self.webpackChunkgrants=self.webpackChunkgrants||[]).push([[91274],{54550:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var n=i(74848),s=i(28453);const r={},a="Pallet Verifier",o={id:"applications/pallet-verifier",title:"Pallet Verifier",description:"- Team Name: David Semakula",source:"@site/applications/pallet-verifier.md",sourceDirName:"applications",slug:"/applications/pallet-verifier",permalink:"/applications/pallet-verifier",draft:!1,unlisted:!1,editUrl:"https://github.com/w3f/Grants-Program/edit/master/applications/pallet-verifier.md",tags:[],version:"current",frontMatter:{}},l={},c=[{value:"Project Overview \ud83d\udcc4",id:"project-overview-page_facing_up",level:2},{value:"Overview",id:"overview",level:3},{value:"Background",id:"background",level:4},{value:"Objective",id:"objective",level:4},{value:"Project Details",id:"project-details",level:3},{value:"Introduction",id:"introduction",level:4},{value:"Architecture",id:"architecture",level:4},{value:"MIRAI Integration",id:"mirai-integration",level:4},{value:"Panics",id:"panics",level:5},{value:"Arithmetic overflow/underflow (and lossy integer conversions)",id:"arithmetic-overflowunderflow-and-lossy-integer-conversions",level:5},{value:"Adding MIRAI annotations automatically",id:"adding-mirai-annotations-automatically",level:5},{value:"Adding MIRAI annotations to MIR",id:"adding-mirai-annotations-to-mir",level:6},{value:"Adding the MIRAI-annotations crate as a dependency",id:"adding-the-mirai-annotations-crate-as-a-dependency",level:6},{value:"Identifying (and generating) tractable entry points",id:"identifying-and-generating-tractable-entry-points",level:5},{value:"The generics challenge",id:"the-generics-challenge",level:6},{value:"Too many macro-generated entry points",id:"too-many-macro-generated-entry-points",level:6},{value:"The <code>TestExternalities</code> and <code>SubstrateHostFunctions</code> challenge",id:"the-testexternalities-and-substratehostfunctions-challenge",level:6},{value:"Finding tractable entry points",id:"finding-tractable-entry-points",level:6},{value:"Generating tractable entry points automatically",id:"generating-tractable-entry-points-automatically",level:6},{value:"Using MIRAI as a library",id:"using-mirai-as-a-library",level:5},{value:"Benchmarking performance and accuracy",id:"benchmarking-performance-and-accuracy",level:5},{value:"Other considerations",id:"other-considerations",level:5},{value:"Technology Stack",id:"technology-stack",level:4},{value:"Ecosystem Fit",id:"ecosystem-fit",level:3},{value:"Team \ud83d\udc65",id:"team-busts_in_silhouette",level:2},{value:"Team members",id:"team-members",level:3},{value:"Contact",id:"contact",level:3},{value:"Legal Structure",id:"legal-structure",level:3},{value:"Team&#39;s experience",id:"teams-experience",level:3},{value:"Team Code Repos",id:"team-code-repos",level:3},{value:"Team LinkedIn Profiles (if available)",id:"team-linkedin-profiles-if-available",level:3},{value:"Development Status \ud83d\udcd6",id:"development-status-open_book",level:2},{value:"Development Roadmap \ud83d\udd29",id:"development-roadmap-nut_and_bolt",level:2},{value:"Overview",id:"overview-1",level:3},{value:"Milestone 1 \u2014 rustc driver, cargo subcommand, basic MIRAI integration, and automatic tractable entry point generation",id:"milestone-1--rustc-driver-cargo-subcommand-basic-mirai-integration-and-automatic-tractable-entry-point-generation",level:3},{value:"Milestone 2 \u2014 MIR annotation capabilities and detecting arithmetic overflow/underflow (and lossy integer conversions) due to <code>as</code> conversions",id:"milestone-2--mir-annotation-capabilities-and-detecting-arithmetic-overflowunderflow-and-lossy-integer-conversions-due-to-as-conversions",level:3},{value:"Future Plans",id:"future-plans",level:2},{value:"Referral Program (optional) \ud83d\udcb0",id:"referral-program-optional-moneybag",level:2},{value:"Additional Information \u2795",id:"additional-information-heavy_plus_sign",level:2}];function h(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"pallet-verifier",children:"Pallet Verifier"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Team Name:"})," David Semakula"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Payment Address:"})," 16AExTwdZnzJ4UDM1MeQ3cNuetTtFz1yrpYTaVqCNJtmeppK (AssetHub USDT)"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsxs)(t.strong,{children:[(0,n.jsx)(t.a,{href:"https://github.com/w3f/Grants-Program/tree/master#level_slider-levels",children:"Level"}),":"]})," 2"]}),"\n"]}),"\n",(0,n.jsxs)(t.h2,{id:"project-overview-page_facing_up",children:["Project Overview ","\ud83d\udcc4"]}),"\n",(0,n.jsxs)(t.p,{children:["This application is a response to the ",(0,n.jsx)(t.a,{href:"https://github.com/w3f/Grants-Program/blob/master/docs/RFPs/Static-Analysis-for-Runtime-Pallets.md",children:"RFP for Static Analysis for Runtime Pallets"}),"."]}),"\n",(0,n.jsx)(t.h3,{id:"overview",children:"Overview"}),"\n",(0,n.jsxs)(t.p,{children:["pallet-verifier is a tool for static analysis of ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/runtime-development/#frame",children:"FRAME runtime pallets"})," that are used for\nbuilding ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/",children:"Substrate"}),"-based blockchains."]}),"\n",(0,n.jsx)(t.h4,{id:"background",children:"Background"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/runtime-development/#frame",children:"FRAME pallets"})," are modules that implement the business logic for the different use cases and features\nthat you might want to include in a blockchain ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/reference/glossary/#runtime",children:"runtime"}),".\nThis enables developers to easily create application-specific ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/",children:"Substrate"}),"-based blockchain ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/reference/glossary/#runtime",children:"runtime"})," environments\nfrom a modular set of components."]}),"\n",(0,n.jsx)(t.h4,{id:"objective",children:"Objective"}),"\n",(0,n.jsxs)(t.p,{children:["pallet-verifier aims to detect ",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/",children:"common security vulnerabilities"})," found in FRAME pallets using\n",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Static_program_analysis",children:"static program analysis"})," techniques like ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Data-flow_analysis",children:"data-flow analysis"}),",\n",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Abstract_interpretation",children:"abstract interpretation"})," and ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Symbolic_execution",children:"symbolic execution"}),"."]}),"\n",(0,n.jsx)(t.h3,{id:"project-details",children:"Project Details"}),"\n",(0,n.jsx)(t.h4,{id:"introduction",children:"Introduction"}),"\n",(0,n.jsxs)(t.p,{children:["This stage of the project will focus on detecting ",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/dont_panic/",children:"panics"})," and ",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/arithmetic_overflow/",children:"arithmetic overflow/underflow"}),"\n(and ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/reference/expressions/operator-expr.html#semantics",children:"lossy integer conversions"}),") in ",(0,n.jsx)(t.a,{href:"https://docs.rs/frame-support/latest/frame_support/pallet_macros/attr.call.html",children:"dispatchable functions/extrinsics"})," of ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/runtime-development/#frame",children:"FRAME pallets"}),".\nHowever, other classes of security vulnerabilities (e.g. ",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/origins/",children:"insufficient or missing origin checks"}),",\n",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/randomness/",children:"bad randomness"}),", ",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/validate_unsigned/",children:"insufficient unsigned transaction validation"})," e.t.c)\nwill also be targeted in the future."]}),"\n",(0,n.jsx)(t.h4,{id:"architecture",children:"Architecture"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/runtime-development/#frame",children:"FRAME"})," is a ",(0,n.jsx)(t.a,{href:"https://www.rust-lang.org/",children:"Rust"}),"-based ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/rust-by-example/macros/dsl.html",children:"DSL (Domain Specific Language)"}),", therefore, the source code representation that\npallet-verifier will analyze is Rust's ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/mir/",children:"MIR (Mid-level Intermediate Representation)"}),". This is because MIR is\n",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/mir/",children:'"a radically simplified form of Rust that is [ideal] for certain flow-sensitive [analysis]"'}),"\n(see also ",(0,n.jsx)(t.a,{href:"https://blog.rust-lang.org/2016/04/19/MIR.html#reducing-rust-to-a-simple-core",children:"this"})," and ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/WhyMir.md",children:"this"}),")."]}),"\n",(0,n.jsxs)(t.p,{children:["As such, pallet-verifier will be built as a custom ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/rustc-driver.html",children:"rust compiler (rustc) driver"})," which will use\n",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI",children:"MIRAI"})," as a backend for ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#abstract-interpretation",children:"abstract interpretation"})," (and in the future, also as a\n",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/TagAnalysis.md",children:"tag and taint analysis"})," engine)."]}),"\n",(0,n.jsxs)(t.p,{children:["Additionally, our custom rustc driver will be distributed as a ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/cargo/reference/external-tools.html#custom-subcommands",children:"custom cargo sub-command"}),"\n(e.g. ",(0,n.jsx)(t.code,{children:"cargo verify-pallet"}),") to allow for a seamless and familiar developer experience."]}),"\n",(0,n.jsx)(t.h4,{id:"mirai-integration",children:"MIRAI Integration"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI",children:'"MIRAI is an abstract interpreter for the Rust compiler\'s mid-level intermediate representation (MIR)"'}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["At this stage of the project, we'll use MIRAI to detect ",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/dont_panic/",children:"panics"})," and ",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/arithmetic_overflow/",children:"arithmetic overflow/underflow"}),"\n(and ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/reference/expressions/operator-expr.html#semantics",children:"lossy integer conversions"}),").\nHowever, as noted before, MIRAI also includes a ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/TagAnalysis.md",children:"tag and taint analysis framework"})," that can be used for\napplicable analyses in the future."]}),"\n",(0,n.jsx)(t.h5,{id:"panics",children:"Panics"}),"\n",(0,n.jsxs)(t.p,{children:["Finding potential panics (abrupt terminations) is one of ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/README.md#who-should-use-mirai",children:"MIRAI's primary use cases"}),".\nMIRAI does this by performing a ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Data-flow_analysis#Sensitivities",children:"path-sensitive"})," analysis.\nThis means that given an ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#entry-points",children:"entry point"}),", MIRAI ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md",children:'"will analyze all possible code paths that\nstart from that entry point and determine if any of them can reach a program point where an abrupt runtime termination\nwill happen"'}),". Notably, ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/README.md#who-should-use-mirai",children:'"[this] use case generally requires no annotations"'}),"."]}),"\n",(0,n.jsx)(t.h5,{id:"arithmetic-overflowunderflow-and-lossy-integer-conversions",children:"Arithmetic overflow/underflow (and lossy integer conversions)"}),"\n",(0,n.jsxs)(t.p,{children:["MIRAI can detect potential ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/reference/expressions/operator-expr.html#overflow",children:"arithmetic overflow/underflow due to arithmetic operations"}),",\nif its ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/README.md#how-to-use-mirai",children:"diagnostic level"})," is set to ",(0,n.jsx)(t.code,{children:"library"})," or ",(0,n.jsx)(t.code,{children:"paranoid"})," (i.e. ",(0,n.jsx)(t.code,{children:"--diag=library|paranoid"}),"),\nand either the rustc ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/rustc/codegen-options/index.html#overflow-checks",children:'"overflow-checks"'})," (i.e. ",(0,n.jsx)(t.code,{children:"-C overflow-checks=true|on|yes|y"}),") or\n",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/rustc/codegen-options/index.html#debug-assertions",children:'"debug-assertions"'})," (i.e. ",(0,n.jsx)(t.code,{children:"-C debug-assertions=true|on|yes|y"}),") flag is enabled.\nThis use case also generally requires no annotations, because when the aforementioned rustc flags are enabled,\nrustc automatically adds instructions for ",(0,n.jsx)(t.a,{href:"https://rust-lang.github.io/rfcs/0560-integer-overflow.html",children:"dynamic overflow checking"}),", which MIRAI can use\nto detect potential arithmetic overflow/underflow."]}),"\n",(0,n.jsxs)(t.p,{children:["However, there's one exception, because ",(0,n.jsxs)(t.a,{href:"https://rust-lang.github.io/rfcs/0560-integer-overflow.html#detailed-design",children:["dynamic overflow checks are ",(0,n.jsx)(t.em,{children:"not"})," added"]}),"\n(",(0,n.jsx)(t.a,{href:"https://github.com/rust-lang/rfcs/pull/1019#issuecomment-88277675",children:"see also"}),") for ",(0,n.jsxs)(t.a,{href:"https://doc.rust-lang.org/reference/expressions/operator-expr.html#type-cast-expressions",children:[(0,n.jsx)(t.code,{children:"as"})," conversions (i.e. type cast operations)"]})," e.g."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-rust",children:"fn convert_with_overflow(val: u16) -> u8 {\n    val as u8\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Therefore, MIRAI ",(0,n.jsx)(t.em,{children:"cannot"})," automatically detect arithmetic overflow/underflow (and ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/reference/expressions/operator-expr.html#semantics",children:"lossy conversions"}),")\ndue to explicit ",(0,n.jsxs)(t.a,{href:"https://doc.rust-lang.org/reference/expressions/operator-expr.html#type-cast-expressions",children:[(0,n.jsx)(t.code,{children:"as"})," conversions"]}),", even when the aforementioned MIRAI options and rustc flags are enabled."]}),"\n",(0,n.jsxs)(t.p,{children:["As such, pallet-verifier will need to automatically add ",(0,n.jsx)(t.a,{href:"https://crates.io/crates/mirai-annotations",children:"annotations"})," that allow MIRAI to verify that all reachable\n",(0,n.jsx)(t.code,{children:"as"})," conversions are safe/lossless (or emit a warning otherwise)."]}),"\n",(0,n.jsx)(t.h5,{id:"adding-mirai-annotations-automatically",children:"Adding MIRAI annotations automatically"}),"\n",(0,n.jsxs)(t.p,{children:["At this stage of the project, pallet-verifier will only add ",(0,n.jsx)(t.a,{href:"https://crates.io/crates/mirai-annotations",children:"annotations"})," for verifying that integer ",(0,n.jsx)(t.code,{children:"as"})," conversions\ndon't overflow/underflow nor lose precision."]}),"\n",(0,n.jsxs)(t.p,{children:["The first step of this process is finding all integer ",(0,n.jsx)(t.code,{children:"as"})," conversions that are either narrowing or lossy conversions\n(i.e. the range of the source type is not a subset of that of the final type e.g. an ",(0,n.jsx)(t.code,{children:"as"})," conversion from ",(0,n.jsx)(t.code,{children:"u16"})," to ",(0,n.jsx)(t.code,{children:"u8"}),"\nor ",(0,n.jsx)(t.code,{children:"u8"})," to ",(0,n.jsx)(t.code,{children:"i8"}),"). This will be done by implementing a ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/mir/visitor.html",children:"MIR visitor"})," that finds ",(0,n.jsxs)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/enum.Rvalue.html",children:[(0,n.jsx)(t.code,{children:"Rvalue"}),"s"]})," of\nthe ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/enum.Rvalue.html#variant.Cast",children:(0,n.jsx)(t.code,{children:"Rvalue::Cast(CastKind, Operand<'tcx>, Ty<'tcx>)"})})," variant, and cast kind of\n",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/syntax/enum.CastKind.html",children:(0,n.jsx)(t.code,{children:"CastKind::IntToInt"})}),", and comparing the source type to the final type."]}),"\n",(0,n.jsxs)(t.p,{children:["Then, for the identified narrowing and lossy conversions, pallet-verifier will add ",(0,n.jsxs)(t.a,{href:"https://docs.rs/mirai-annotations/1.12.0/mirai_annotations/macro.verify.html",children:["MIRAI ",(0,n.jsx)(t.code,{children:"verify!"})]}),"\nannotations with predicates that bound the operand within the range of the final type of the cast expression\n(e.g. for a ",(0,n.jsx)(t.code,{children:"u16"})," to ",(0,n.jsx)(t.code,{children:"u8"})," conversion, the predicate would be ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/std/primitive.u8.html#associatedconstant.MAX",children:(0,n.jsx)(t.code,{children:"val <= u8::MAX"})})," where ",(0,n.jsx)(t.code,{children:"val"})," represents\nthe operand of the type cast operation)."]}),"\n",(0,n.jsx)(t.h6,{id:"adding-mirai-annotations-to-mir",children:"Adding MIRAI annotations to MIR"}),"\n",(0,n.jsxs)(t.p,{children:["pallet-verifier will add ",(0,n.jsx)(t.a,{href:"https://crates.io/crates/mirai-annotations",children:"MIRAI annotations"})," by ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_interface/interface/struct.Config.html#structfield.override_queries",children:"overriding"})," rustc's\n",(0,n.jsxs)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/struct.TyCtxt.html#method.optimized_mir",children:[(0,n.jsx)(t.code,{children:"optimized_mir"})," query"]})," (see also ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/mir/optimizations.html",children:"this"})," and ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/query.html",children:"this"}),").\nThis is notably ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/struct.TyCtxt.html#method.optimized_mir",children:'"the only query that can fetch non-local MIR"'})," which will allow us to\ndetect potentially lossy and overflowing/underflowing ",(0,n.jsx)(t.code,{children:"as"})," conversions introduced by calls to third-party code/ dependencies.\nIt's also notably the rustc query that MIRAI uses to get the MIR that it interprets (see ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/call_visitor.rs#L278",children:"here"})," and\n",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/call_visitor.rs#L278",children:"here"}),") for ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/WhyMir.md",children:"similar reasons"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["However, this presents a challenge because MIRAI annotations are ordinarily exposed as ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/book/ch19-06-macros.html",children:"Rust declarative macros"}),"\n(e.g. ",(0,n.jsx)(t.a,{href:"https://docs.rs/mirai-annotations/1.12.0/mirai_annotations/macro.verify.html",children:(0,n.jsx)(t.code,{children:"verify!"})}),"), but ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/macro-expansion.html",children:"macro expansion"})," has already been completed (i.e. during ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/overview.html#lexing-and-parsing",children:"lexing and parsing"}),")\nby this stage of the compilation pipeline (i.e. ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/overview.html#code-generation",children:"code generation"}),").\nSo pallet-verifier will need to add ",(0,n.jsx)(t.a,{href:"https://crates.io/crates/mirai-annotations",children:"MIRAI annotations"})," using their equivalent MIR instructions\nas opposed to the typical declarative macros."]}),"\n",(0,n.jsxs)(t.p,{children:["Fortunately, MIRAI's declarative macros expand to relatively straight-forward calls to simple functions with\n",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/NOP_(code)",children:"noop"})," bodies, that MIRAI treats as special ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Intrinsic_function",children:"intrinsic/built-in"})," instructions during abstract interpretation\n(see ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/known_names.rs#L18-L30",children:"this"}),", ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/known_names.rs#L463-L475",children:"this"})," and ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/call_visitor.rs#L476-L659",children:"this"}),").\nFor example, the ",(0,n.jsx)(t.a,{href:"https://docs.rs/mirai-annotations/1.12.0/mirai_annotations/macro.verify.html",children:(0,n.jsx)(t.code,{children:"verify!"})})," macro ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/annotations/src/lib.rs#L845-L855",children:"expands to"})," a call to the\n",(0,n.jsxs)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/annotations/src/lib.rs#L1179",children:[(0,n.jsx)(t.code,{children:"mirai_verify"})," function"]})," which is defined as follows in the ",(0,n.jsx)(t.a,{href:"https://crates.io/crates/mirai-annotations",children:"MIRAI annotations crate"}),":"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-rust",children:"pub fn mirai_verify(_condition: bool, _message: &str) {}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["This makes it relatively straight-forward to retrieve the ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/def_id/struct.DefId.html",children:(0,n.jsx)(t.code,{children:"DefId"})})," of the target function\n(e.g. ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/annotations/src/lib.rs#L1179",children:(0,n.jsx)(t.code,{children:"mirai_verify"})}),") and ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/syntax/enum.Operand.html#method.function_handle",children:"use it to construct MIR for calling the function"}),",\nthus adding a MIR instruction equivalent to using the corresponding declarative macro (e.g. ",(0,n.jsx)(t.a,{href:"https://docs.rs/mirai-annotations/1.12.0/mirai_annotations/macro.verify.html",children:(0,n.jsx)(t.code,{children:"verify!"})}),")."]}),"\n",(0,n.jsx)(t.h6,{id:"adding-the-mirai-annotations-crate-as-a-dependency",children:"Adding the MIRAI-annotations crate as a dependency"}),"\n",(0,n.jsxs)(t.p,{children:["It's improbable that any of the FRAME pallets that pallet-verifier will be invoked on will include the\n",(0,n.jsx)(t.a,{href:"https://crates.io/crates/mirai-annotations",children:"mirai-annotations crate"})," as a dependency, but we'll need it included as a dependency to allow us\n(and MIRAI) to use/access ",(0,n.jsxs)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/def_id/struct.DefId.html",children:[(0,n.jsx)(t.code,{children:"DefId"}),"s"]})," (and ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/known_names.rs#L485-L487",children:"related definition information"}),") when\nadding (and interpreting) annotations as described in the previous section."]}),"\n",(0,n.jsxs)(t.p,{children:["The process for ",(0,n.jsx)(t.em,{children:'"silently"'})," adding the ",(0,n.jsx)(t.a,{href:"https://crates.io/crates/mirai-annotations",children:"mirai-annotations crate"})," (i.e. without modifying target\nFRAME pallet crates) will actually be relatively straight-forward, because:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["the ",(0,n.jsx)(t.a,{href:"https://crates.io/crates/mirai-annotations",children:"mirai-annotations crate"})," is essentially just a single relatively small\n",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/annotations/src/lib.rs",children:(0,n.jsx)(t.code,{children:"lib.rs"})})," file with ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/annotations/Cargo.toml#L16",children:"no dependencies"})]}),"\n",(0,n.jsxs)(t.li,{children:["pallet-verifier will be built as a custom ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/rustc-driver.html",children:"rustc driver"})," and ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/cargo/reference/external-tools.html#custom-subcommands",children:"cargo subcommand"})," that\nwill also set itself as the ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-reads",children:(0,n.jsx)(t.code,{children:"RUSTC_WRAPPER"})})," when it's invoked by ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/cargo/",children:"cargo"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"The process, in more detail, will work as follows:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["first we'll compile the ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/annotations/src/lib.rs",children:(0,n.jsx)(t.code,{children:"lib.rs"})})," file (or just its relevant content) as a library by\ninvoking ",(0,n.jsx)(t.code,{children:"rustc"})," directly."]}),"\n",(0,n.jsxs)(t.li,{children:["then, because pallet-verifier will be the ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-reads",children:(0,n.jsx)(t.code,{children:"RUSTC_WRAPPER"})})," when it's invoked, we can simply add an additional\n",(0,n.jsxs)(t.a,{href:"https://doc.rust-lang.org/rustc/command-line-arguments.html#--extern-specify-where-an-external-library-is-located",children:[(0,n.jsx)(t.code,{children:"--extern mirai_annotations=/path/to/compiled-artifact.rlib"})," argument"]})," to the arguments received\nfrom ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/cargo/",children:"cargo"})," when invoking rustc on the target FRAME pallet."]}),"\n"]}),"\n",(0,n.jsx)(t.h5,{id:"identifying-and-generating-tractable-entry-points",children:"Identifying (and generating) tractable entry points"}),"\n",(0,n.jsx)(t.h6,{id:"the-generics-challenge",children:"The generics challenge"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/runtime-development/#frame",children:"FRAME"})," is inherently a ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Generic_programming",children:"generic"})," framework because it makes extensive use of ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/book/ch10-00-generics.html",children:"Rust generic types and traits"}),",\nmost notably for ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/rust-basics/#generics-and-configuration-traits",children:'defining the configuration and "dependencies"'})," of pallets using a ",(0,n.jsx)(t.code,{children:"Config"})," trait and\nthe ",(0,n.jsxs)(t.a,{href:"https://docs.substrate.io/reference/frame-macros/#palletconfig",children:[(0,n.jsx)(t.code,{children:"#[pallet::config]"})," attribute macro"]}),".\nAdditionally, generic types are used extensively when defining other entities, including in the ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/build/origins/",children:"Origin"})," parameter for\n",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/reference/frame-macros/#palletcall",children:"dispatchable functions/extrinsics"}),", which is typically declared as a generic associated type\n",(0,n.jsx)(t.a,{href:"https://docs.rs/frame-system/latest/frame_system/pallet_prelude/type.OriginFor.html",children:(0,n.jsx)(t.code,{children:"origin: OriginFor<T>"})}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["This presents a challenge when performing analysis with MIRAI, because ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#entry-points",children:'"it is not possible for a generic or\nhigher order function to serve as an entry point"'}),". This is because\n",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#entry-points",children:'"it is necessary for MIRAI to resolve and analyze all functions that can be reached from an entry point"'}),"."]}),"\n",(0,n.jsx)(t.h6,{id:"too-many-macro-generated-entry-points",children:"Too many macro-generated entry points"}),"\n",(0,n.jsxs)(t.p,{children:["Another challenge is the fact that when MIRAI is invoked with its default configuration using ",(0,n.jsx)(t.code,{children:"cargo mirai"}),",\nit will attempt to analyze all entry points\n(i.e. ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#entry-points",children:'"[all] function[s] that can be called externally [... e.g.] public function[s] of a library crate"'}),").\nIn the context of a FRAME pallet, this essentially means MIRAI with attempt to analyze all functions with\n",(0,n.jsxs)(t.a,{href:"https://doc.rust-lang.org/reference/visibility-and-privacy.html",children:[(0,n.jsx)(t.code,{children:"pub"})," visibility"]}),". This ends up being a significant challenge for efficiency, and a cause of timeouts,\nbecause even a relatively ",(0,n.jsx)(t.a,{href:"https://github.com/scs/MIRAI/blob/Milestone1_Research/substrate-examples/pallet_template/src/lib.rs",children:"simple example pallet definition"})," like the one used by the\n",(0,n.jsx)(t.a,{href:"https://github.com/w3f/Grants-Program/blob/master/applications/sarp-basic-functionality.md",children:"Supercomputing Systems AG (SCS) team"})," in the\n",(0,n.jsx)(t.a,{href:"https://github.com/w3f/Grant-Milestone-Delivery/blob/master/deliveries/sarp-basic-functionality-milestone-1.md",children:"previously completed research grant"})," yields about ~300 entry points (i.e. public functions)\nafter macro expansion (you can inspect the list of entry points by running\n",(0,n.jsx)(t.code,{children:'cargo clean && MIRAI_FLAGS="--print_function_names" cargo mirai'}),")."]}),"\n",(0,n.jsxs)(t.h6,{id:"the-testexternalities-and-substratehostfunctions-challenge",children:["The ",(0,n.jsx)(t.code,{children:"TestExternalities"})," and ",(0,n.jsx)(t.code,{children:"SubstrateHostFunctions"})," challenge"]}),"\n",(0,n.jsxs)(t.p,{children:["A typical solution to the above two challenges is to ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#entry-points",children:"analyze using only unit tests as entry points"}),"\nby running ",(0,n.jsx)(t.code,{children:"cargo mirai --tests"}),". This is because ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/test/unit-testing/",children:"unit tests"})," provide concrete types for\nall generic types and traits, and will typically be a manageable number for a single crate.\nThis seems like a viable solution for our use case, since it's a standard best-practice for Substrate/FRAME developers\nto write ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/test/unit-testing/",children:"unit tests"})," for all dispatchable functions/extrinsics."]}),"\n",(0,n.jsxs)(t.p,{children:["However, here too we run into some challenges, presumably because the ",(0,n.jsx)(t.a,{href:"https://docs.rs/sp-io/latest/sp_io/type.SubstrateHostFunctions.html",children:(0,n.jsx)(t.code,{children:"SubstrateHostFunctions"})}),"\nand ",(0,n.jsx)(t.a,{href:"https://docs.rs/sp-io/latest/sp_io/type.TestExternalities.html",children:(0,n.jsx)(t.code,{children:"TestExternalities"})})," implementation needed to run ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/test/unit-testing/",children:"unit tests"}),"\nintroduces too much complexity in the form ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#foreign-functions",children:"foreign functions"})," for which MIRAI can't access MIR,\ncombined with some ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#call-resolution",children:"complex indirection"}),", and so the analysis either aborts or timeouts."]}),"\n",(0,n.jsx)(t.p,{children:"Another efficiency concern for this approach is the fact that it's quite common for a unit test to exercise a\nsingle target function multiple times, or even for multiple unit tests to be written for a single function.\nHowever, while this is perfectly reasonable for unit testing, it's quite wasteful in an entry point for\nabstract interpretation."}),"\n",(0,n.jsx)(t.h6,{id:"finding-tractable-entry-points",children:"Finding tractable entry points"}),"\n",(0,n.jsxs)(t.p,{children:["Since what prevents us from directly using ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/reference/frame-macros/#palletcall",children:"dispatchable function/extrinsic"})," definitions as\nentry points is the fact that they're ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/book/ch10-00-generics.html",children:"generic"}),", while unit tests provide concrete implementations\nof the required generic types and traits, but introduce too much complexity presumably because of\n",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#foreign-functions",children:"foreign functions"})," and ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#call-resolution",children:"complex indirection"})," related to\n",(0,n.jsx)(t.a,{href:"https://docs.rs/sp-io/latest/sp_io/type.SubstrateHostFunctions.html",children:(0,n.jsx)(t.code,{children:"SubstrateHostFunctions"})})," and ",(0,n.jsx)(t.a,{href:"https://docs.rs/sp-io/latest/sp_io/type.TestExternalities.html",children:(0,n.jsx)(t.code,{children:"TestExternalities"})}),' implementations.\nA hybrid solution that uses the concrete types and arguments from unit tests to "specialize" direct calls to the\n',(0,n.jsx)(t.a,{href:"https://docs.substrate.io/reference/frame-macros/#palletcall",children:"dispatchable functions/extrinsics"})," (i.e. bypassing calls to\n",(0,n.jsx)(t.a,{href:"https://paritytech.github.io/polkadot-sdk/master/sp_io/type.TestExternalities.html#method.execute_with",children:(0,n.jsx)(t.code,{children:"sp_io::TestExternalities::new(..).execute_with(|| { .. })"})}),",\n",(0,n.jsx)(t.a,{href:"https://docs.rs/frame-system/latest/frame_system/pallet/struct.GenesisConfig.html#method.build_storage",children:(0,n.jsx)(t.code,{children:"frame_system::GenesisConfig::default().build_storage()"})})," e.t.c) seems viable."]}),"\n",(0,n.jsxs)(t.p,{children:["In fact, the viability of such a hybrid solution has already been successfully demonstrated in the\n",(0,n.jsx)(t.a,{href:"https://github.com/w3f/Grant-Milestone-Delivery/blob/master/deliveries/sarp-basic-functionality-milestone-1.md",children:"previously completed research grant delivery"})," in which such a ",(0,n.jsx)(t.a,{href:"https://github.com/scs/MIRAI/blob/Milestone1_Research/substrate-examples/pallet_template/src/mirai.rs",children:'"hybrid" entry point'}),"\nwas manually implemented, and ",(0,n.jsx)(t.a,{href:"https://github.com/scs/MIRAI/blob/Milestone1_Research/substrate-examples/pallet_template/.cargo/config.toml#L2",children:"configuring MIRAI to only analyze this entry point"})," eliminated the\ntimeouts and aborts that were otherwise experienced when MIRAI attempted to analyze all entry points as detailed\n",(0,n.jsx)(t.a,{href:"https://github.com/scs/MIRAI/blob/Milestone1_Research/substrate-examples/pallet_template/README.md",children:"here"}),"."]}),"\n",(0,n.jsx)(t.p,{children:'However, manually implementing these "hybrid" entry points is not scalable, so pallet-verifier will need to generate\nthem automatically.'}),"\n",(0,n.jsx)(t.h6,{id:"generating-tractable-entry-points-automatically",children:"Generating tractable entry points automatically"}),"\n",(0,n.jsxs)(t.p,{children:["The first step of this process is finding a function call for each ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/reference/frame-macros/#palletcall",children:"dispatchable function/extrinsic"}),'\n(i.e. presumably via "specialized" calls of dispatchable functions in ',(0,n.jsx)(t.a,{href:"https://docs.substrate.io/test/unit-testing/",children:"unit tests"}),").\nThis will be done by ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.body_owners",children:"retrieving"})," the ",(0,n.jsxs)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/def_id/struct.DefId.html",children:[(0,n.jsx)(t.code,{children:"DefId"}),"s"]})," for all dispatchable functions,\nand then implementing a ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/mir/visitor.html",children:"MIR visitor"})," that finds ",(0,n.jsxs)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/terminator/struct.Terminator.html",children:[(0,n.jsx)(t.code,{children:"Terminator"}),"s"]})," of the\n",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/syntax/enum.TerminatorKind.html#variant.Call",children:(0,n.jsx)(t.code,{children:"TerminatorKind::Call { func, args, .. }"})})," variant whose ",(0,n.jsx)(t.code,{children:"func"})," operand matches/wraps\nthe ",(0,n.jsx)(t.code,{children:"DefId"})," of a dispatchable function."]}),"\n",(0,n.jsxs)(t.p,{children:['Then, the concrete types and argument values used in the discovered "specialized" dispatchable function calls\nwill be used to construct/generate tractable entry points (i.e. definitions of minimal public functions that\nmake dispatchable calls similar to ',(0,n.jsx)(t.a,{href:"https://github.com/scs/MIRAI/blob/Milestone1_Research/substrate-examples/pallet_template/src/mirai.rs",children:'this "hybrid" entry point from the previous research deliverable'}),")."]}),"\n",(0,n.jsx)(t.p,{children:'Note that, at this point we can emit a warning for any dispatchable functions for which no "specialized" call\ncould be found (i.e. presumably because no unit tests are defined for it), or even abort with an error message,\nif no "specialized" calls are found for any of the dispatchable functions.'}),"\n",(0,n.jsxs)(t.p,{children:["Switching our focus back to the generated tractable entry points, one challenge here is that we'll need ",(0,n.jsxs)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/def_id/struct.DefId.html",children:[(0,n.jsx)(t.code,{children:"DefId"}),"s"]}),"\nfor these generated tractable entry points (inorder to pass them to MIRAI for analysis), but ",(0,n.jsx)(t.code,{children:"DefId"}),"s are created\nduring ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/hir.html",children:"HIR (High-Level Intermediate Representation)"})," lowering (",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/lowering.html",children:"see also"}),")."]}),"\n",(0,n.jsxs)(t.p,{children:["Fortunately, rustc's ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/query.html",children:"query-based and demand-driven compilation model"})," means it has excellent support for\n",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/queries/incremental-compilation-in-detail.html",children:"incremental compilation/analysis"})," (",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/queries/incremental-compilation.html",children:"see also"}),'), this allows us to\n(strategically) add our generated entry points to the target FRAME pallet\'s "virtual" source code without needing to\nrecompile any unrelated code.']}),"\n",(0,n.jsxs)(t.p,{children:["Lastly, while adding our generated entry points, we'd prefer ",(0,n.jsx)(t.em,{children:"not"}),' to edit the target FRAME pallet\'s\n"actual" source code (i.e. no changes on disk), so our ',(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/rustc-driver.html",children:"custom rustc driver"})," will use rustc's\n",(0,n.jsxs)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_span/source_map/trait.FileLoader.html",children:[(0,n.jsx)(t.code,{children:"FileLoader"})," API"]})," to ",(0,n.jsxs)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_interface/interface/struct.Config.html#structfield.file_loader",children:["provide a custom ",(0,n.jsx)(t.code,{children:"FileLoader"})]}),' that feeds\nour generated entry points directly into the compiler (i.e. without modifying the FRAME pallet\'s\n"actual" source code on disk - hence the "virtual" phrasing in the last paragraph).']}),"\n",(0,n.jsx)(t.h5,{id:"using-mirai-as-a-library",children:"Using MIRAI as a library"}),"\n",(0,n.jsxs)(t.p,{children:["At this point, we've already detailed how we'll use ",(0,n.jsx)(t.a,{href:"https://github.com/rust-lang/rust",children:"rustc"})," as a library via our custom ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/rustc-driver.html",children:"rustc driver"}),",\nin order to customize compilation and analysis to our target domain (i.e. analyzing ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/runtime-development/#frame",children:"FRAME pallets"}),").\nSimilarly, a few considerations mean we'll need to use MIRAI as a library as well, to give us more flexibility\nin resolving a few domain-specific challenges related to analyzing ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/runtime-development/#frame",children:"FRAME pallets"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["It was noted in the ",(0,n.jsx)(t.a,{href:"https://github.com/w3f/Grant-Milestone-Delivery/blob/master/deliveries/sarp-basic-functionality-milestone-1.md",children:"previously completed research grant delivery"})," that the diagnostic level\nhad to be set to ",(0,n.jsx)(t.code,{children:"paranoid"})," (i.e. ",(0,n.jsx)(t.code,{children:"--diag=paranoid"}),") for MIRAI to emit some expected warnings.\nHowever, the ",(0,n.jsx)(t.code,{children:"paranoid"})," diagnostic level produces a lot of warnings (",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/options.rs#L32",children:"by design"}),"),\nsince it's maximally strict and so warns about ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/README.md#how-to-use-mirai",children:'"any issue that may be an error"'}),', by essentially disabling\nsome of MIRAI\'s "normal" mechanisms for ',(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#reducing-false-positives",children:"reducing false positives"}),", like\n",(0,n.jsxs)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#reducing-false-positives",children:['"suppressing any diagnostics that ',(0,n.jsx)(t.em,{children:"arise"}),' within the standard library or third party code\n[... i.e. diagnostics that are [not] tied to source locations within the [current] crate]"']}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["However, by examining the reported diagnostic from ",(0,n.jsx)(t.a,{href:"https://github.com/w3f/Grant-Milestone-Delivery/blob/master/deliveries/sarp-basic-functionality-milestone-1.md",children:"the previous research delivery"}),"\n(see image below), we can make a few important observations:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["The primary span/location for the diagnostic is pointing to the ",(0,n.jsxs)(t.a,{href:"https://docs.rs/frame-support/latest/frame_support/",children:[(0,n.jsx)(t.code,{children:"frame_support"})," pallet"]}),",\nand specifically the ",(0,n.jsxs)(t.a,{href:"https://github.com/paritytech/polkadot-sdk/blob/6c5a42a690f96d59dbdf94640188f5d5b5cc47e2/substrate/frame/support/src/storage/transactional.rs#L178",children:[(0,n.jsx)(t.code,{children:"frame_support::storage::with_storage_layer"})," function"]}),",\nwhich explains why this diagnostic is only emitted at the ",(0,n.jsx)(t.code,{children:"paranoid"})," level (i.e. it's arising from a\nthird-party library as far as MIRAI is concerned)."]}),"\n",(0,n.jsxs)(t.li,{children:["There are still some sub-diagnostics relating the primary diagnostic to the current crate\n(i.e. the ",(0,n.jsx)(t.code,{children:"note: related location ..."})," lines)."]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:"https://raw.githubusercontent.com/scs/MIRAI/Milestone1_Research/substrate-examples/pallet_template/UnsatisfiedPrecondition.png",alt:"SCS Research Warning"})}),"\n",(0,n.jsxs)(t.p,{children:["Armed with this information, we can use ",(0,n.jsx)(t.a,{href:"https://crates.io/crates/cargo-expand",children:"cargo expand"})," to have a look at the final code (i.e. after macro expansion)\nfor the target dispatchable function (i.e. the ",(0,n.jsxs)(t.a,{href:"https://github.com/scs/MIRAI/blob/Milestone1_Research/substrate-examples/pallet_template/src/lib.rs#L100-L109",children:[(0,n.jsx)(t.code,{children:"do_something"})," function"]}),") below:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-rust",children:"impl<T: Config> Pallet<T> {\n    /// ...\n    pub fn do_something(origin: OriginFor<T>, something: u32) -> DispatchResult {\n        frame_support::storage::with_storage_layer(|| {\n            let who = ensure_signed(origin.clone())?;\n            Self::sarp_put_sensitive_value(&origin, something)?;\n            Self::deposit_event(Event::SomethingStored {\n                something,\n                who,\n            });\n            Ok(())\n        })\n    }\n    \n    /// ..\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Notice that ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/runtime-development/#frame",children:"FRAME"})," wraps the user written body of the dispatchable function, with a call to\n",(0,n.jsx)(t.a,{href:"https://docs.rs/frame-support/latest/frame_support/storage/transactional/fn.with_storage_layer.html",children:(0,n.jsx)(t.code,{children:"frame_support::storage::with_storage_layer"})}),", and presumably the ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Indirection",children:"indirection"}),"\nintroduced by this ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/book/ch13-01-closures.html",children:"closure"}),"-based invocation, combined with the complexity introduced by the way\n",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/proc_macro/struct.Span.html#method.call_site",children:"procedural macros report call-site information"})," leads to MIRAI reporting the\n",(0,n.jsxs)(t.a,{href:"https://github.com/paritytech/polkadot-sdk/blob/6c5a42a690f96d59dbdf94640188f5d5b5cc47e2/substrate/frame/support/src/storage/transactional.rs#L178",children:["closure call inside the ",(0,n.jsx)(t.code,{children:"frame_support::storage::with_storage_layer"})," function"]})," as the\nprimary source location for the diagnostic."]}),"\n",(0,n.jsxs)(t.p,{children:['Presumably, we can find ways of "fixing" this in MIRAI, while taking care ',(0,n.jsx)(t.em,{children:"not"})," to introduce false positives in\nother adjacent cases, but such a generic fix will likely be ",(0,n.jsx)(t.em,{children:"non"}),"-trivial.\nNevertheless, such efforts will be pursued, but not as part of the scope of this grant application."]}),"\n",(0,n.jsxs)(t.p,{children:['However, an alternative approach is to use our domain-specific knowledge to determine which diagnostics to\neither "suppress" or "promote", because, being a domain-specific tool, pallet-verifier will always "know" more\nabout the analysis context than MIRAI. Therefore, our approach will be to integrate with MIRAI as a library.\nThis will allow us to access ',(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/checker/src/crate_visitor.rs#L50",children:"MIRAI's diagnostics buffer"})," directly, and use our own custom filters\nto determine which diagnostics to emit based on: the reported primary location, reported related locations,\nand taking into account the behavior of FRAME macro generated code."]}),"\n",(0,n.jsxs)(t.p,{children:["Another benefit of this approach is it can lead to some efficiency gains by bypassing some redundant work in MIRAI\n(e.g. ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/crate_visitor.rs#L84-L132",children:"iterating over all body owners"})," to find the ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/def_id/struct.DefId.html",children:(0,n.jsx)(t.code,{children:"DefId"})})," of the target function,\nwhen pallet-verifier already knows the relevant ",(0,n.jsx)(t.code,{children:"DefId"})," and so can just call\n",(0,n.jsxs)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/checker/src/crate_visitor.rs#L174",children:["the ",(0,n.jsx)(t.code,{children:"analyze_body"})," function"]})," directly e.t.c)."]}),"\n",(0,n.jsxs)(t.p,{children:["Lastly, another lever for reducing false positives (i.e. irrelevant warnings) related to\n",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#incomplete-analysis",children:"incomplete analysis due to missing MIR bodies"})," for ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#foreign-functions",children:'"foreign functions"'}),"\n(e.g. standard library functions that aren't inlined, and system calls), is to add\n",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/standard_contracts/src/foreign_contracts.rs",children:'"summaries/foreign contracts"'})," for these ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#foreign-functions",children:'"foreign functions"'}),",\nthus making the analysis more precise. While this part of MIRAI is not that well documented,\nit's not that hard to figure out how to add these ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/standard_contracts/src/foreign_contracts.rs",children:'"summaries/foreign contracts"'}),"\nfrom the ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/standard_contracts/src/foreign_contracts.rs",children:"existing examples"})," and ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/checker/src/utils.rs#L402-L413",children:"related utilities"}),",\nwhich actually show that these ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/checker/src/utils.rs#L373-L376",children:'"summaries/foreign contracts" can be defined outside MIRAI'}),",\nwhich certainly gives us more flexibility without having to modify MIRAI itself."]}),"\n",(0,n.jsx)(t.h5,{id:"benchmarking-performance-and-accuracy",children:"Benchmarking performance and accuracy"}),"\n",(0,n.jsxs)(t.p,{children:["This stage of the project will create a simple benchmark to showcase the performance and accuracy metrics of\npallet-verifier on a few production pallets (e.g. 3-5 pallets from ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/reference/frame-pallets/",children:"this list"}),").\nFor each pallet in the benchmark suite, we'll add ",(0,n.jsx)(t.em,{children:"bad"})," variants of dispatchable functions by\nreplacing proper error handling and safe arithmetic constructs with panicking and overflow/underflow-ing equivalents,\nwhile also keeping the ",(0,n.jsx)(t.em,{children:"good"})," variants unedited. The benchmarks will then report execution time and ratio of\ntrue vs false positives for each dispatchable function, as well as aggregates for these metrics for\nthe target pallets and the entire benchmark suite."]}),"\n",(0,n.jsxs)(t.p,{children:["In general, we'll be motivated to reduce the amount of false positives (if any), and that could be viewed as\n",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Gaming_the_system",children:'"gaming the benchmark"'}),". However, for our use case, this will be desirable behavior as long as\nthe fixes applied to remove/reduce the false positives are generic in nature\n(i.e. the fixes are applicable to any pallet, and ",(0,n.jsx)(t.em,{children:"don't"})," just simply detect the presence of a specific pallet and\nadjust the behavior of the tool based on this knowledge)."]}),"\n",(0,n.jsx)(t.h5,{id:"other-considerations",children:"Other considerations"}),"\n",(0,n.jsxs)(t.p,{children:["Finally, an important consideration to keep in mind is that MIRAI\n",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/README.md#mirai--",children:'"is intended to become a widely used static analysis tool for Rust"'}),", and in the wider Rust ecosystem,\nit's quite common (and sometimes even reasonable) for functions to panic in cases when they're called with\n\"problematic\" arguments."]}),"\n",(0,n.jsxs)(t.p,{children:["Because of this, MIRAI makes a lot of effort to try to\n",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#reducing-false-positives",children:"suppress warnings that would be perceived as false positives"})," in the context of the wider Rust ecosystem.\nHowever, some of these warnings are legitimate bugs in the context of a blockchain runtime.\nA notable example of this is MIRAI's ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Decisions.md#precondition-inference",children:"precondition inference"})," which has the effect of\nsuppressing warnings about possible panics if the panic is conditional on a parameter of the entry point e.g.\nMIRAI will not report a panic from the code snippet below, even at the ",(0,n.jsx)(t.code,{children:"paranoid"})," diagnostic level,\nif it's analyzed as an entry point."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-rust",children:'pub fn hates_zeros(val: u8) {\n    if val == 0 {\n        panic!("I hate zeros!");\n    }\n}\n'})}),"\n",(0,n.jsxs)(t.p,{children:["Note however, that this is only problematic for our use case if it happens in an entry point.\nThis is because when ",(0,n.jsx)(t.code,{children:"hates_zeros"})," is not an entry point, the inferred precondition (i.e. ",(0,n.jsx)(t.code,{children:"verify!(val != 0)"}),"),\nwill need to be satisfied by the function's callers."]}),"\n",(0,n.jsx)(t.p,{children:"This particular behavior ends up not being an issue for our proposed architecture, because our entry points\nwill be simple and artificially constructed with no parameters and no branching."}),"\n",(0,n.jsx)(t.h4,{id:"technology-stack",children:"Technology Stack"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://www.rust-lang.org/",children:"Rust"})," - will be used for implementing all components of pallet-verifier."]}),"\n",(0,n.jsx)(t.h3,{id:"ecosystem-fit",children:"Ecosystem Fit"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/runtime-development/#frame",children:"FRAME pallets"})," are an ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/architecture/#frame-libraries-for-the-runtime",children:"essential building block for composing Substrate-based blockchain runtimes"}),",\ntherefore, as rightfully identified by the ",(0,n.jsx)(t.a,{href:"https://github.com/w3f/Grants-Program/blob/master/docs/RFPs/Static-Analysis-for-Runtime-Pallets.md",children:"RFP for Static Analysis for Runtime Pallets"}),", tools like\npallet-verifier that integrate directly into developer workflows, and detect and warn developers about potential\nsecurity vulnerabilities in pallets are essential for improving security in the Polkadot/Substrate/Kusama ecosystem."]}),"\n",(0,n.jsxs)(t.h2,{id:"team-busts_in_silhouette",children:["Team ","\ud83d\udc65"]}),"\n",(0,n.jsx)(t.h3,{id:"team-members",children:"Team members"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["David Semakula ",(0,n.jsx)(t.a,{href:"https://github.com/davidsemakula",children:"davidsemakula"})]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"contact",children:"Contact"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Contact Name:"})," David Semakula"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Contact Email:"})," ",(0,n.jsx)(t.a,{href:"mailto:hello@davidsemakula.com",children:"hello@davidsemakula.com"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Website:"})," ",(0,n.jsx)(t.a,{href:"https://davidsemakula.com",children:"https://davidsemakula.com"})]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"legal-structure",children:"Legal Structure"}),"\n",(0,n.jsx)(t.p,{children:"I'll be working as an individual."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Registered Address:"})," N/A"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Registered Legal Entity:"})," N/A"]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"teams-experience",children:"Team's experience"}),"\n",(0,n.jsx)(t.p,{children:"I'm an independent Software Engineer & Systems Architect with over 10 years of experience."}),"\n",(0,n.jsxs)(t.p,{children:["I'm the creator of ",(0,n.jsx)(t.a,{href:"https://github.com/ink-analyzer",children:"ink! analyzer"})," (a collection of modular and reusable libraries and tools for\nsemantic analysis of ",(0,n.jsx)(t.a,{href:"https://use.ink/",children:"ink!"})," smart contracts). Notably, like ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/runtime-development/#frame",children:"FRAME"}),", ",(0,n.jsx)(t.a,{href:"https://use.ink/",children:"ink!"})," is also a Rust ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/rust-by-example/macros/dsl.html",children:"DSL"}),".\nI also ",(0,n.jsx)(t.a,{href:"https://github.com/rust-lang/rust-analyzer/pulls?q=is%3Apr+author%3Adavidsemakula",children:"independently contribute"})," to ",(0,n.jsx)(t.a,{href:"https://github.com/rust-lang/rust-analyzer",children:"rust-analyzer"})," (a Rust ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Compiler#Front_end",children:"compiler front-end"})," for IDEs)."]}),"\n",(0,n.jsxs)(t.p,{children:["I've previously worked as a technical lead on projects for ",(0,n.jsx)(t.a,{href:"https://www.hubspot.com/",children:"HubSpot"}),", ",(0,n.jsx)(t.a,{href:"https://www.permobil.com/",children:"Permobil"}),", ",(0,n.jsx)(t.a,{href:"https://www.pressboardmedia.com/",children:"Pressboard"}),", ",(0,n.jsx)(t.a,{href:"https://www.grindery.io/",children:"Grindery"}),",\n",(0,n.jsx)(t.a,{href:"https://w.inboundlabs.co/",children:"InboundLabs"}),", ",(0,n.jsx)(t.a,{href:"https://tunga.io/",children:"Tunga"}),", ",(0,n.jsx)(t.a,{href:"https://www.butterflyworks.org/",children:"ButterflyWorks"}),", ",(0,n.jsx)(t.a,{href:"https://www.telegraaf.nl/",children:"Telegraaf Media Groep (TMG)"})," and many more companies."]}),"\n",(0,n.jsxs)(t.p,{children:["I hold a Bachelor of Science in Computer Science degree from ",(0,n.jsx)(t.a,{href:"https://cis.mak.ac.ug/",children:"Makerere University, Kampala, Uganda"}),".\nYou can find my full profile at ",(0,n.jsx)(t.a,{href:"https://davidsemakula.com",children:"https://davidsemakula.com"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://github.com/ink-analyzer",children:"ink! analyzer"})," was previously funded by two Web3 Foundation grants (see ",(0,n.jsx)(t.a,{href:"https://github.com/w3f/Grants-Program/blob/master/applications/ink-analyzer.md",children:"this"})," and ",(0,n.jsx)(t.a,{href:"https://github.com/w3f/Grants-Program/blob/master/applications/ink-analyzer-phase-2.md",children:"this"}),")."]}),"\n",(0,n.jsx)(t.h3,{id:"team-code-repos",children:"Team Code Repos"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/davidsemakula",children:"https://github.com/davidsemakula"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/ink-analyzer/ink-analyzer",children:"https://github.com/ink-analyzer/ink-analyzer"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/ink-analyzer/ink-vscode",children:"https://github.com/ink-analyzer/ink-vscode"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/wamutech/wamu-rs",children:"https://github.com/wamutech/wamu-rs"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/wamutech/wamu-spec",children:"https://github.com/wamutech/wamu-spec"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/davidsemakula/substrate-vault",children:"https://github.com/davidsemakula/substrate-vault"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/mukutu-tech/mukutu-safe",children:"https://github.com/mukutu-tech/mukutu-safe"})}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"team-linkedin-profiles-if-available",children:"Team LinkedIn Profiles (if available)"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"https://davidsemakula.com",children:"https://davidsemakula.com"})," (I use my own website for my profile)"]}),"\n"]}),"\n",(0,n.jsxs)(t.h2,{id:"development-status-open_book",children:["Development Status ","\ud83d\udcd6"]}),"\n",(0,n.jsxs)(t.p,{children:["A significant amount of research of internals of the related tools (i.e. ",(0,n.jsx)(t.a,{href:"https://github.com/rust-lang/rust",children:"rustc"})," and ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI",children:"MIRAI"}),"), as well as a review\nof the ",(0,n.jsx)(t.a,{href:"https://github.com/w3f/Grant-Milestone-Delivery/blob/master/deliveries/sarp-basic-functionality-milestone-1.md",children:"previously completed research delivery by Supercomputing Systems AG (SCS)"}),",\nhas been done to inform the proposed architecture of pallet-verifier, as described in detail in the\n",(0,n.jsx)(t.a,{href:"#project-details",children:"Project Details"})," section above.\nBeyond this, no meaningful development has started for this project."]}),"\n",(0,n.jsxs)(t.h2,{id:"development-roadmap-nut_and_bolt",children:["Development Roadmap ","\ud83d\udd29"]}),"\n",(0,n.jsx)(t.h3,{id:"overview-1",children:"Overview"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Total Estimated Duration:"})," ~4 months"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Full-Time Equivalent (FTE):"}),"  1"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Total Costs:"})," 30,000 USD"]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"milestone-1--rustc-driver-cargo-subcommand-basic-mirai-integration-and-automatic-tractable-entry-point-generation",children:"Milestone 1 \u2014 rustc driver, cargo subcommand, basic MIRAI integration, and automatic tractable entry point generation"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Estimated duration:"})," ~7-8 weeks"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"FTE:"}),"  1"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Costs:"})," 15,000 USD"]}),"\n"]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"Number"}),(0,n.jsx)(t.th,{children:"Deliverable"}),(0,n.jsx)(t.th,{children:"Specification"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:(0,n.jsx)(t.strong,{children:"0a."})}),(0,n.jsx)(t.td,{children:"License"}),(0,n.jsx)(t.td,{children:"MIT or Apache 2.0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:(0,n.jsx)(t.strong,{children:"0b."})}),(0,n.jsx)(t.td,{children:"Documentation"}),(0,n.jsxs)(t.td,{children:["I will provide detailed source documentation including ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/rustdoc/what-is-rustdoc.html",children:"rustdoc"})," documentation, a document describing the design and high-level architecture of pallet-verifier (i.e. similar to the ",(0,n.jsx)(t.a,{href:"#project-details",children:"project details"})," section of this document), and a README file providing general information about the tool, installation and usage instructions, and links to other documentation and resources related to the tool."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:(0,n.jsx)(t.strong,{children:"0c."})}),(0,n.jsx)(t.td,{children:"Testing and Testing Guide"}),(0,n.jsxs)(t.td,{children:["Core functions will be fully covered by comprehensive ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/tests/ui.html#introduction",children:"UI tests"})," to ensure functionality and robustness. Additionally, a ",(0,n.jsx)(t.a,{href:"#benchmarking-performance-and-accuracy",children:"benchmark suite that showcases the performance and accuracy metrics of the tool on 3-5 production pallets"})," will be implemented. In the guide, I will describe how to run these tests and benchmarks."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:(0,n.jsx)(t.strong,{children:"0d."})}),(0,n.jsx)(t.td,{children:"Docker"}),(0,n.jsx)(t.td,{children:"N/A"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"1."}),(0,n.jsx)(t.td,{children:"Rust binary crate"}),(0,n.jsxs)(t.td,{children:["I will create a Rust binary crate that implements a custom ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/rustc-driver.html",children:"rustc driver"}),", ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/cargo/reference/external-tools.html#custom-subcommands",children:"custom cargo subcommand"}),", basic ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI",children:"MIRAI"})," integration (i.e. excluding ",(0,n.jsx)(t.a,{href:"#adding-mirai-annotations-automatically",children:"automatic annotation capabilities"}),"), and ",(0,n.jsx)(t.a,{href:"#generating-tractable-entry-points-automatically",children:"automatic tractable entry point generation"})," which will enable invoking pallet-verifier as a cargo subcommand (e.g. ",(0,n.jsx)(t.code,{children:"cargo verify-pallet"}),") on ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/runtime-development/#frame",children:"FRAME pallets"})," to detect potential ",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/dont_panic/",children:"panics"})," and ",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/arithmetic_overflow/",children:"arithmetic overflow/underflow"})," due to arithmetic operations (i.e. excluding ",(0,n.jsxs)(t.a,{href:"https://doc.rust-lang.org/reference/expressions/operator-expr.html#type-cast-expressions",children:[(0,n.jsx)(t.code,{children:"as"})," conversions/ type cast operations"]}),")."]})]})]})]}),"\n",(0,n.jsxs)(t.h3,{id:"milestone-2--mir-annotation-capabilities-and-detecting-arithmetic-overflowunderflow-and-lossy-integer-conversions-due-to-as-conversions",children:["Milestone 2 \u2014 MIR annotation capabilities and detecting arithmetic overflow/underflow (and lossy integer conversions) due to ",(0,n.jsx)(t.code,{children:"as"})," conversions"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Estimated duration:"})," ~7-8 weeks"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"FTE:"}),"  1"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Costs:"})," 15,000 USD"]}),"\n"]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"Number"}),(0,n.jsx)(t.th,{children:"Deliverable"}),(0,n.jsx)(t.th,{children:"Specification"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:(0,n.jsx)(t.strong,{children:"0a."})}),(0,n.jsx)(t.td,{children:"License"}),(0,n.jsx)(t.td,{children:"MIT or Apache 2.0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:(0,n.jsx)(t.strong,{children:"0b."})}),(0,n.jsx)(t.td,{children:"Documentation"}),(0,n.jsxs)(t.td,{children:["I will provide detailed source documentation including ",(0,n.jsx)(t.a,{href:"https://doc.rust-lang.org/rustdoc/what-is-rustdoc.html",children:"rustdoc"})," documentation, a document describing the design and high-level architecture of pallet-verifier (i.e. similar to the ",(0,n.jsx)(t.a,{href:"#project-details",children:"project details"})," section of this document), and a README file providing general information about the tool, installation and usage instructions, and links to other documentation and resources related to the tool."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:(0,n.jsx)(t.strong,{children:"0c."})}),(0,n.jsx)(t.td,{children:"Testing and Testing Guide"}),(0,n.jsxs)(t.td,{children:["Core functions will be fully covered by comprehensive ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/tests/ui.html#introduction",children:"UI tests"})," to ensure functionality and robustness. Additionally, a ",(0,n.jsx)(t.a,{href:"#benchmarking-performance-and-accuracy",children:"benchmark suite that showcases the performance and accuracy metrics of the tool on 3-5 production pallets"})," will be implemented. In the guide, I will describe how to run these tests and benchmarks."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:(0,n.jsx)(t.strong,{children:"0d."})}),(0,n.jsx)(t.td,{children:"Docker"}),(0,n.jsx)(t.td,{children:"N/A"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0e."}),(0,n.jsx)(t.td,{children:"Article"}),(0,n.jsxs)(t.td,{children:["I will publish an ",(0,n.jsx)(t.strong,{children:"article"})," that explains how pallet-verifier works, the security vulnerabilities it can detect, and how to use it to analyze ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/learn/runtime-development/#frame",children:"FRAME pallets"}),"."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"1."}),(0,n.jsx)(t.td,{children:"Rust binary crate update"}),(0,n.jsxs)(t.td,{children:["I will update the Rust binary that implements pallet-verifier to support ",(0,n.jsxs)(t.a,{href:"#adding-the-mirai-annotations-crate-as-a-dependency",children:["adding the ",(0,n.jsx)(t.code,{children:"mirai-annotations"})," crate as a dependency to FRAME pallets without editing ",(0,n.jsx)(t.code,{children:"Cargo.toml"})]}),", ",(0,n.jsx)(t.a,{href:"#adding-mirai-annotations-to-mir",children:"adding MIRAI annotations to MIR"}),", and more specifically to support ",(0,n.jsxs)(t.a,{href:"#adding-mirai-annotations-automatically",children:["automatically adding annotations for verifying that integer ",(0,n.jsx)(t.code,{children:"as"})," conversions don't overflow/underflow nor lose precision"]}),"."]})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"future-plans",children:"Future Plans"}),"\n",(0,n.jsx)(t.p,{children:"In the short term, I will likely apply for follow-up funding for:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["improving or widening the scope of existing analyses e.g. detecting panics in ",(0,n.jsx)(t.a,{href:"https://paritytech.github.io/polkadot-sdk/master/frame_support/traits/trait.Hooks.html",children:"pallet/runtime hooks"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["adding analyses for more ",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/",children:"vulnerability classes"})," and ",(0,n.jsx)(t.a,{href:"https://docs.substrate.io/build/troubleshoot-your-code/#unsafe-or-insecure-patterns",children:"insecure patterns"}),"\n(e.g. ",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/origins/",children:"insufficient or missing origin checks"}),", ",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/randomness/",children:"bad randomness"}),",\n",(0,n.jsx)(t.a,{href:"https://secure-contracts.com/not-so-smart-contracts/substrate/validate_unsigned/",children:"insufficient unsigned transaction validation"})," e.t.c)."]}),"\n",(0,n.jsxs)(t.li,{children:["adding support for using other specialized static analysis tools as backends for specific analyses\n(e.g. ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Symbolic_execution",children:"symbolic execution engines"}),")."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["Additionally, an often noted disadvantage of building Rust static analysis tools based on ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/mir/",children:"MIR"})," (and indeed plugging into the\nrust compiler in general), is the fact that rustc's APIs for ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/mir/",children:"MIR"})," (or more generally rustc's internal APIs)\nare ",(0,n.jsx)(t.a,{href:"https://rustc-dev-guide.rust-lang.org/rustc-driver.html",children:"unstable"}),".\nThere's an ongoing effort to address some of these issues in the form of the official\n",(0,n.jsx)(t.a,{href:"https://github.com/rust-lang/project-stable-mir",children:"Stable MIR Librarification Project"}),", however, this project is still relatively early, and at the moment,\nalso still ",(0,n.jsx)(t.a,{href:"https://hackmd.io/XhnYHKKuR6-LChhobvlT-g?view#Requirements",children:"unstable (i.e. pre-1.0)"}),".\nNevertheless, migrating pallet-verifier (and related tools like ",(0,n.jsx)(t.a,{href:"https://github.com/facebookexperimental/MIRAI",children:"MIRAI"}),") to the ",(0,n.jsx)(t.a,{href:"https://github.com/rust-lang/project-stable-mir",children:"stable MIR API"}),",\nwhenever it's ready, should be considered a long-term goal for the project."]}),"\n",(0,n.jsxs)(t.p,{children:["Another related area of interest would be either extending the scope of the tool,\nor creating a similar tool, to analyze ",(0,n.jsx)(t.a,{href:"https://use.ink/",children:"ink!"})," smart contracts using similar static analysis tools and techniques."]}),"\n",(0,n.jsx)(t.p,{children:"Finally, as the project is a public good, ultimately, the long term goal is to create a community of users,\ncontributors and ecosystem partners who are invested in the project's long-term success because of its utility."}),"\n",(0,n.jsxs)(t.h2,{id:"referral-program-optional-moneybag",children:["Referral Program (optional) ","\ud83d\udcb0"]}),"\n",(0,n.jsx)(t.p,{children:"N/A"}),"\n",(0,n.jsxs)(t.h2,{id:"additional-information-heavy_plus_sign",children:["Additional Information ","\u2795"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"How did you hear about the Grants Program?"})}),"\n",(0,n.jsx)(t.p,{children:"Web3 Foundation Website."}),"\n",(0,n.jsxs)(t.p,{children:["I have also previously successfully applied for and completed two Web3 Foundation grants\n(see ",(0,n.jsx)(t.a,{href:"https://github.com/w3f/Grants-Program/blob/master/applications/ink-analyzer.md",children:"this"})," and ",(0,n.jsx)(t.a,{href:"https://github.com/w3f/Grants-Program/blob/master/applications/ink-analyzer-phase-2.md",children:"this"}),") for ",(0,n.jsx)(t.a,{href:"https://github.com/ink-analyzer",children:"ink! analyzer"}),"\n(a collection of modular and reusable libraries and tools for semantic analysis of ",(0,n.jsx)(t.a,{href:"https://use.ink/",children:"ink!"})," smart contracts)."]})]})}function d(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},28453:(e,t,i)=>{i.d(t,{R:()=>a,x:()=>o});var n=i(96540);const s={},r=n.createContext(s);function a(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);