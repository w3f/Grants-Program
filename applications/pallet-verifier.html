<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-applications/pallet-verifier" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Pallet Verifier | Web3 Foundation Grants</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://grants.web3.foundation/applications/pallet-verifier"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Pallet Verifier | Web3 Foundation Grants"><meta data-rh="true" name="description" content="- Team Name: David Semakula"><meta data-rh="true" property="og:description" content="- Team Name: David Semakula"><link data-rh="true" rel="icon" href="/img/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://grants.web3.foundation/applications/pallet-verifier"><link data-rh="true" rel="alternate" href="https://grants.web3.foundation/applications/pallet-verifier" hreflang="en"><link data-rh="true" rel="alternate" href="https://grants.web3.foundation/applications/pallet-verifier" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9VKKGZO0U1-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Web3 Foundation Grants" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.d1d1d476.css">
<script src="/assets/js/runtime~main.25d688b6.js" defer="defer"></script>
<script src="/assets/js/main.6cceddc5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#000;color:#ffffff" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Looking for advice on how to fund your project? Apply for Office Hours <a href="https://grants.web3.foundation/docs/office-hours">here!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/w3f_logo.svg" alt="W3F Grants Program" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/w3f_logo.svg" alt="W3F Grants Program" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Grants Program</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/applications">List of Grants</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/docs/Process/how-to-apply">Apply</a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Pallet Verifier</h1></header>
<ul>
<li><strong>Team Name:</strong> David Semakula</li>
<li><strong>Payment Address:</strong> 16AExTwdZnzJ4UDM1MeQ3cNuetTtFz1yrpYTaVqCNJtmeppK (AssetHub USDT)</li>
<li><strong><a href="https://github.com/w3f/Grants-Program/tree/master#level_slider-levels" target="_blank" rel="noopener noreferrer">Level</a>:</strong> 2</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-overview-page_facing_up">Project Overview <!-- -->ðŸ“„<a href="#project-overview-page_facing_up" class="hash-link" aria-label="Direct link to project-overview-page_facing_up" title="Direct link to project-overview-page_facing_up">â€‹</a></h2>
<p>This application is a response to the <a href="https://github.com/w3f/Grants-Program/blob/master/docs/RFPs/Static-Analysis-for-Runtime-Pallets.md" target="_blank" rel="noopener noreferrer">RFP for Static Analysis for Runtime Pallets</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">â€‹</a></h3>
<p>pallet-verifier is a tool for static analysis of <a href="https://docs.substrate.io/learn/runtime-development/#frame" target="_blank" rel="noopener noreferrer">FRAME runtime pallets</a> that are used for
building <a href="https://docs.substrate.io/" target="_blank" rel="noopener noreferrer">Substrate</a>-based blockchains.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a href="#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">â€‹</a></h4>
<p><a href="https://docs.substrate.io/learn/runtime-development/#frame" target="_blank" rel="noopener noreferrer">FRAME pallets</a> are modules that implement the business logic for the different use cases and features
that you might want to include in a blockchain <a href="https://docs.substrate.io/reference/glossary/#runtime" target="_blank" rel="noopener noreferrer">runtime</a>.
This enables developers to easily create application-specific <a href="https://docs.substrate.io/" target="_blank" rel="noopener noreferrer">Substrate</a>-based blockchain <a href="https://docs.substrate.io/reference/glossary/#runtime" target="_blank" rel="noopener noreferrer">runtime</a> environments
from a modular set of components.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="objective">Objective<a href="#objective" class="hash-link" aria-label="Direct link to Objective" title="Direct link to Objective">â€‹</a></h4>
<p>pallet-verifier aims to detect <a href="https://secure-contracts.com/not-so-smart-contracts/substrate/" target="_blank" rel="noopener noreferrer">common security vulnerabilities</a> found in FRAME pallets using
<a href="https://en.wikipedia.org/wiki/Static_program_analysis" target="_blank" rel="noopener noreferrer">static program analysis</a> techniques like <a href="https://en.wikipedia.org/wiki/Data-flow_analysis" target="_blank" rel="noopener noreferrer">data-flow analysis</a>,
<a href="https://en.wikipedia.org/wiki/Abstract_interpretation" target="_blank" rel="noopener noreferrer">abstract interpretation</a> and <a href="https://en.wikipedia.org/wiki/Symbolic_execution" target="_blank" rel="noopener noreferrer">symbolic execution</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="project-details">Project Details<a href="#project-details" class="hash-link" aria-label="Direct link to Project Details" title="Direct link to Project Details">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">â€‹</a></h4>
<p>This stage of the project will focus on detecting <a href="https://secure-contracts.com/not-so-smart-contracts/substrate/dont_panic/" target="_blank" rel="noopener noreferrer">panics</a> and <a href="https://secure-contracts.com/not-so-smart-contracts/substrate/arithmetic_overflow/" target="_blank" rel="noopener noreferrer">arithmetic overflow/underflow</a>
(and <a href="https://doc.rust-lang.org/reference/expressions/operator-expr.html#semantics" target="_blank" rel="noopener noreferrer">lossy integer conversions</a>) in <a href="https://docs.rs/frame-support/latest/frame_support/pallet_macros/attr.call.html" target="_blank" rel="noopener noreferrer">dispatchable functions/extrinsics</a> of <a href="https://docs.substrate.io/learn/runtime-development/#frame" target="_blank" rel="noopener noreferrer">FRAME pallets</a>.
However, other classes of security vulnerabilities (e.g. <a href="https://secure-contracts.com/not-so-smart-contracts/substrate/origins/" target="_blank" rel="noopener noreferrer">insufficient or missing origin checks</a>,
<a href="https://secure-contracts.com/not-so-smart-contracts/substrate/randomness/" target="_blank" rel="noopener noreferrer">bad randomness</a>, <a href="https://secure-contracts.com/not-so-smart-contracts/substrate/validate_unsigned/" target="_blank" rel="noopener noreferrer">insufficient unsigned transaction validation</a> e.t.c)
will also be targeted in the future.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="architecture">Architecture<a href="#architecture" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture">â€‹</a></h4>
<p><a href="https://docs.substrate.io/learn/runtime-development/#frame" target="_blank" rel="noopener noreferrer">FRAME</a> is a <a href="https://www.rust-lang.org/" target="_blank" rel="noopener noreferrer">Rust</a>-based <a href="https://doc.rust-lang.org/rust-by-example/macros/dsl.html" target="_blank" rel="noopener noreferrer">DSL (Domain Specific Language)</a>, therefore, the source code representation that
pallet-verifier will analyze is Rust&#x27;s <a href="https://rustc-dev-guide.rust-lang.org/mir/" target="_blank" rel="noopener noreferrer">MIR (Mid-level Intermediate Representation)</a>. This is because MIR is
<a href="https://rustc-dev-guide.rust-lang.org/mir/" target="_blank" rel="noopener noreferrer">&quot;a radically simplified form of Rust that is [ideal] for certain flow-sensitive [analysis]&quot;</a>
(see also <a href="https://blog.rust-lang.org/2016/04/19/MIR.html#reducing-rust-to-a-simple-core" target="_blank" rel="noopener noreferrer">this</a> and <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/WhyMir.md" target="_blank" rel="noopener noreferrer">this</a>).</p>
<p>As such, pallet-verifier will be built as a custom <a href="https://rustc-dev-guide.rust-lang.org/rustc-driver.html" target="_blank" rel="noopener noreferrer">rust compiler (rustc) driver</a> which will use
<a href="https://github.com/facebookexperimental/MIRAI" target="_blank" rel="noopener noreferrer">MIRAI</a> as a backend for <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#abstract-interpretation" target="_blank" rel="noopener noreferrer">abstract interpretation</a> (and in the future, also as a
<a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/TagAnalysis.md" target="_blank" rel="noopener noreferrer">tag and taint analysis</a> engine).</p>
<p>Additionally, our custom rustc driver will be distributed as a <a href="https://doc.rust-lang.org/cargo/reference/external-tools.html#custom-subcommands" target="_blank" rel="noopener noreferrer">custom cargo sub-command</a>
(e.g. <code>cargo verify-pallet</code>) to allow for a seamless and familiar developer experience.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mirai-integration">MIRAI Integration<a href="#mirai-integration" class="hash-link" aria-label="Direct link to MIRAI Integration" title="Direct link to MIRAI Integration">â€‹</a></h4>
<p><a href="https://github.com/facebookexperimental/MIRAI" target="_blank" rel="noopener noreferrer">&quot;MIRAI is an abstract interpreter for the Rust compiler&#x27;s mid-level intermediate representation (MIR)&quot;</a>.</p>
<p>At this stage of the project, we&#x27;ll use MIRAI to detect <a href="https://secure-contracts.com/not-so-smart-contracts/substrate/dont_panic/" target="_blank" rel="noopener noreferrer">panics</a> and <a href="https://secure-contracts.com/not-so-smart-contracts/substrate/arithmetic_overflow/" target="_blank" rel="noopener noreferrer">arithmetic overflow/underflow</a>
(and <a href="https://doc.rust-lang.org/reference/expressions/operator-expr.html#semantics" target="_blank" rel="noopener noreferrer">lossy integer conversions</a>).
However, as noted before, MIRAI also includes a <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/TagAnalysis.md" target="_blank" rel="noopener noreferrer">tag and taint analysis framework</a> that can be used for
applicable analyses in the future.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="panics">Panics<a href="#panics" class="hash-link" aria-label="Direct link to Panics" title="Direct link to Panics">â€‹</a></h5>
<p>Finding potential panics (abrupt terminations) is one of <a href="https://github.com/facebookexperimental/MIRAI/blob/main/README.md#who-should-use-mirai" target="_blank" rel="noopener noreferrer">MIRAI&#x27;s primary use cases</a>.
MIRAI does this by performing a <a href="https://en.wikipedia.org/wiki/Data-flow_analysis#Sensitivities" target="_blank" rel="noopener noreferrer">path-sensitive</a> analysis.
This means that given an <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#entry-points" target="_blank" rel="noopener noreferrer">entry point</a>, MIRAI <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md" target="_blank" rel="noopener noreferrer">&quot;will analyze all possible code paths that
start from that entry point and determine if any of them can reach a program point where an abrupt runtime termination
will happen&quot;</a>. Notably, <a href="https://github.com/facebookexperimental/MIRAI/blob/main/README.md#who-should-use-mirai" target="_blank" rel="noopener noreferrer">&quot;[this] use case generally requires no annotations&quot;</a>.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="arithmetic-overflowunderflow-and-lossy-integer-conversions">Arithmetic overflow/underflow (and lossy integer conversions)<a href="#arithmetic-overflowunderflow-and-lossy-integer-conversions" class="hash-link" aria-label="Direct link to Arithmetic overflow/underflow (and lossy integer conversions)" title="Direct link to Arithmetic overflow/underflow (and lossy integer conversions)">â€‹</a></h5>
<p>MIRAI can detect potential <a href="https://doc.rust-lang.org/reference/expressions/operator-expr.html#overflow" target="_blank" rel="noopener noreferrer">arithmetic overflow/underflow due to arithmetic operations</a>,
if its <a href="https://github.com/facebookexperimental/MIRAI/blob/main/README.md#how-to-use-mirai" target="_blank" rel="noopener noreferrer">diagnostic level</a> is set to <code>library</code> or <code>paranoid</code> (i.e. <code>--diag=library|paranoid</code>),
and either the rustc <a href="https://doc.rust-lang.org/rustc/codegen-options/index.html#overflow-checks" target="_blank" rel="noopener noreferrer">&quot;overflow-checks&quot;</a> (i.e. <code>-C overflow-checks=true|on|yes|y</code>) or
<a href="https://doc.rust-lang.org/rustc/codegen-options/index.html#debug-assertions" target="_blank" rel="noopener noreferrer">&quot;debug-assertions&quot;</a> (i.e. <code>-C debug-assertions=true|on|yes|y</code>) flag is enabled.
This use case also generally requires no annotations, because when the aforementioned rustc flags are enabled,
rustc automatically adds instructions for <a href="https://rust-lang.github.io/rfcs/0560-integer-overflow.html" target="_blank" rel="noopener noreferrer">dynamic overflow checking</a>, which MIRAI can use
to detect potential arithmetic overflow/underflow.</p>
<p>However, there&#x27;s one exception, because <a href="https://rust-lang.github.io/rfcs/0560-integer-overflow.html#detailed-design" target="_blank" rel="noopener noreferrer">dynamic overflow checks are <em>not</em> added</a>
(<a href="https://github.com/rust-lang/rfcs/pull/1019#issuecomment-88277675" target="_blank" rel="noopener noreferrer">see also</a>) for <a href="https://doc.rust-lang.org/reference/expressions/operator-expr.html#type-cast-expressions" target="_blank" rel="noopener noreferrer"><code>as</code> conversions (i.e. type cast operations)</a> e.g.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">convert_with_overflow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u8</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Therefore, MIRAI <em>cannot</em> automatically detect arithmetic overflow/underflow (and <a href="https://doc.rust-lang.org/reference/expressions/operator-expr.html#semantics" target="_blank" rel="noopener noreferrer">lossy conversions</a>)
due to explicit <a href="https://doc.rust-lang.org/reference/expressions/operator-expr.html#type-cast-expressions" target="_blank" rel="noopener noreferrer"><code>as</code> conversions</a>, even when the aforementioned MIRAI options and rustc flags are enabled.</p>
<p>As such, pallet-verifier will need to automatically add <a href="https://crates.io/crates/mirai-annotations" target="_blank" rel="noopener noreferrer">annotations</a> that allow MIRAI to verify that all reachable
<code>as</code> conversions are safe/lossless (or emit a warning otherwise).</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="adding-mirai-annotations-automatically">Adding MIRAI annotations automatically<a href="#adding-mirai-annotations-automatically" class="hash-link" aria-label="Direct link to Adding MIRAI annotations automatically" title="Direct link to Adding MIRAI annotations automatically">â€‹</a></h5>
<p>At this stage of the project, pallet-verifier will only add <a href="https://crates.io/crates/mirai-annotations" target="_blank" rel="noopener noreferrer">annotations</a> for verifying that integer <code>as</code> conversions
don&#x27;t overflow/underflow nor lose precision.</p>
<p>The first step of this process is finding all integer <code>as</code> conversions that are either narrowing or lossy conversions
(i.e. the range of the source type is not a subset of that of the final type e.g. an <code>as</code> conversion from <code>u16</code> to <code>u8</code>
or <code>u8</code> to <code>i8</code>). This will be done by implementing a <a href="https://rustc-dev-guide.rust-lang.org/mir/visitor.html" target="_blank" rel="noopener noreferrer">MIR visitor</a> that finds <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/enum.Rvalue.html" target="_blank" rel="noopener noreferrer"><code>Rvalue</code>s</a> of
the <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/enum.Rvalue.html#variant.Cast" target="_blank" rel="noopener noreferrer"><code>Rvalue::Cast(CastKind, Operand&lt;&#x27;tcx&gt;, Ty&lt;&#x27;tcx&gt;)</code></a> variant, and cast kind of
<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/syntax/enum.CastKind.html" target="_blank" rel="noopener noreferrer"><code>CastKind::IntToInt</code></a>, and comparing the source type to the final type.</p>
<p>Then, for the identified narrowing and lossy conversions, pallet-verifier will add <a href="https://docs.rs/mirai-annotations/1.12.0/mirai_annotations/macro.verify.html" target="_blank" rel="noopener noreferrer">MIRAI <code>verify!</code></a>
annotations with predicates that bound the operand within the range of the final type of the cast expression
(e.g. for a <code>u16</code> to <code>u8</code> conversion, the predicate would be <a href="https://doc.rust-lang.org/std/primitive.u8.html#associatedconstant.MAX" target="_blank" rel="noopener noreferrer"><code>val &lt;= u8::MAX</code></a> where <code>val</code> represents
the operand of the type cast operation).</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="adding-mirai-annotations-to-mir">Adding MIRAI annotations to MIR<a href="#adding-mirai-annotations-to-mir" class="hash-link" aria-label="Direct link to Adding MIRAI annotations to MIR" title="Direct link to Adding MIRAI annotations to MIR">â€‹</a></h6>
<p>pallet-verifier will add <a href="https://crates.io/crates/mirai-annotations" target="_blank" rel="noopener noreferrer">MIRAI annotations</a> by <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_interface/interface/struct.Config.html#structfield.override_queries" target="_blank" rel="noopener noreferrer">overriding</a> rustc&#x27;s
<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/struct.TyCtxt.html#method.optimized_mir" target="_blank" rel="noopener noreferrer"><code>optimized_mir</code> query</a> (see also <a href="https://rustc-dev-guide.rust-lang.org/mir/optimizations.html" target="_blank" rel="noopener noreferrer">this</a> and <a href="https://rustc-dev-guide.rust-lang.org/query.html" target="_blank" rel="noopener noreferrer">this</a>).
This is notably <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/struct.TyCtxt.html#method.optimized_mir" target="_blank" rel="noopener noreferrer">&quot;the only query that can fetch non-local MIR&quot;</a> which will allow us to
detect potentially lossy and overflowing/underflowing <code>as</code> conversions introduced by calls to third-party code/ dependencies.
It&#x27;s also notably the rustc query that MIRAI uses to get the MIR that it interprets (see <a href="https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/call_visitor.rs#L278" target="_blank" rel="noopener noreferrer">here</a> and
<a href="https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/call_visitor.rs#L278" target="_blank" rel="noopener noreferrer">here</a>) for <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/WhyMir.md" target="_blank" rel="noopener noreferrer">similar reasons</a>.</p>
<p>However, this presents a challenge because MIRAI annotations are ordinarily exposed as <a href="https://doc.rust-lang.org/book/ch19-06-macros.html" target="_blank" rel="noopener noreferrer">Rust declarative macros</a>
(e.g. <a href="https://docs.rs/mirai-annotations/1.12.0/mirai_annotations/macro.verify.html" target="_blank" rel="noopener noreferrer"><code>verify!</code></a>), but <a href="https://rustc-dev-guide.rust-lang.org/macro-expansion.html" target="_blank" rel="noopener noreferrer">macro expansion</a> has already been completed (i.e. during <a href="https://rustc-dev-guide.rust-lang.org/overview.html#lexing-and-parsing" target="_blank" rel="noopener noreferrer">lexing and parsing</a>)
by this stage of the compilation pipeline (i.e. <a href="https://rustc-dev-guide.rust-lang.org/overview.html#code-generation" target="_blank" rel="noopener noreferrer">code generation</a>).
So pallet-verifier will need to add <a href="https://crates.io/crates/mirai-annotations" target="_blank" rel="noopener noreferrer">MIRAI annotations</a> using their equivalent MIR instructions
as opposed to the typical declarative macros.</p>
<p>Fortunately, MIRAI&#x27;s declarative macros expand to relatively straight-forward calls to simple functions with
<a href="https://en.wikipedia.org/wiki/NOP_(code)" target="_blank" rel="noopener noreferrer">noop</a> bodies, that MIRAI treats as special <a href="https://en.wikipedia.org/wiki/Intrinsic_function" target="_blank" rel="noopener noreferrer">intrinsic/built-in</a> instructions during abstract interpretation
(see <a href="https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/known_names.rs#L18-L30" target="_blank" rel="noopener noreferrer">this</a>, <a href="https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/known_names.rs#L463-L475" target="_blank" rel="noopener noreferrer">this</a> and <a href="https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/call_visitor.rs#L476-L659" target="_blank" rel="noopener noreferrer">this</a>).
For example, the <a href="https://docs.rs/mirai-annotations/1.12.0/mirai_annotations/macro.verify.html" target="_blank" rel="noopener noreferrer"><code>verify!</code></a> macro <a href="https://github.com/facebookexperimental/MIRAI/blob/main/annotations/src/lib.rs#L845-L855" target="_blank" rel="noopener noreferrer">expands to</a> a call to the
<a href="https://github.com/facebookexperimental/MIRAI/blob/main/annotations/src/lib.rs#L1179" target="_blank" rel="noopener noreferrer"><code>mirai_verify</code> function</a> which is defined as follows in the <a href="https://crates.io/crates/mirai-annotations" target="_blank" rel="noopener noreferrer">MIRAI annotations crate</a>:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">mirai_verify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This makes it relatively straight-forward to retrieve the <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/def_id/struct.DefId.html" target="_blank" rel="noopener noreferrer"><code>DefId</code></a> of the target function
(e.g. <a href="https://github.com/facebookexperimental/MIRAI/blob/main/annotations/src/lib.rs#L1179" target="_blank" rel="noopener noreferrer"><code>mirai_verify</code></a>) and <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/syntax/enum.Operand.html#method.function_handle" target="_blank" rel="noopener noreferrer">use it to construct MIR for calling the function</a>,
thus adding a MIR instruction equivalent to using the corresponding declarative macro (e.g. <a href="https://docs.rs/mirai-annotations/1.12.0/mirai_annotations/macro.verify.html" target="_blank" rel="noopener noreferrer"><code>verify!</code></a>).</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="adding-the-mirai-annotations-crate-as-a-dependency">Adding the MIRAI-annotations crate as a dependency<a href="#adding-the-mirai-annotations-crate-as-a-dependency" class="hash-link" aria-label="Direct link to Adding the MIRAI-annotations crate as a dependency" title="Direct link to Adding the MIRAI-annotations crate as a dependency">â€‹</a></h6>
<p>It&#x27;s improbable that any of the FRAME pallets that pallet-verifier will be invoked on will include the
<a href="https://crates.io/crates/mirai-annotations" target="_blank" rel="noopener noreferrer">mirai-annotations crate</a> as a dependency, but we&#x27;ll need it included as a dependency to allow us
(and MIRAI) to use/access <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/def_id/struct.DefId.html" target="_blank" rel="noopener noreferrer"><code>DefId</code>s</a> (and <a href="https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/known_names.rs#L485-L487" target="_blank" rel="noopener noreferrer">related definition information</a>) when
adding (and interpreting) annotations as described in the previous section.</p>
<p>The process for <em>&quot;silently&quot;</em> adding the <a href="https://crates.io/crates/mirai-annotations" target="_blank" rel="noopener noreferrer">mirai-annotations crate</a> (i.e. without modifying target
FRAME pallet crates) will actually be relatively straight-forward, because:</p>
<ul>
<li>the <a href="https://crates.io/crates/mirai-annotations" target="_blank" rel="noopener noreferrer">mirai-annotations crate</a> is essentially just a single relatively small
<a href="https://github.com/facebookexperimental/MIRAI/blob/main/annotations/src/lib.rs" target="_blank" rel="noopener noreferrer"><code>lib.rs</code></a> file with <a href="https://github.com/facebookexperimental/MIRAI/blob/main/annotations/Cargo.toml#L16" target="_blank" rel="noopener noreferrer">no dependencies</a></li>
<li>pallet-verifier will be built as a custom <a href="https://rustc-dev-guide.rust-lang.org/rustc-driver.html" target="_blank" rel="noopener noreferrer">rustc driver</a> and <a href="https://doc.rust-lang.org/cargo/reference/external-tools.html#custom-subcommands" target="_blank" rel="noopener noreferrer">cargo subcommand</a> that
will also set itself as the <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-reads" target="_blank" rel="noopener noreferrer"><code>RUSTC_WRAPPER</code></a> when it&#x27;s invoked by <a href="https://doc.rust-lang.org/cargo/" target="_blank" rel="noopener noreferrer">cargo</a>.</li>
</ul>
<p>The process, in more detail, will work as follows:</p>
<ul>
<li>first we&#x27;ll compile the <a href="https://github.com/facebookexperimental/MIRAI/blob/main/annotations/src/lib.rs" target="_blank" rel="noopener noreferrer"><code>lib.rs</code></a> file (or just its relevant content) as a library by
invoking <code>rustc</code> directly.</li>
<li>then, because pallet-verifier will be the <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-reads" target="_blank" rel="noopener noreferrer"><code>RUSTC_WRAPPER</code></a> when it&#x27;s invoked, we can simply add an additional
<a href="https://doc.rust-lang.org/rustc/command-line-arguments.html#--extern-specify-where-an-external-library-is-located" target="_blank" rel="noopener noreferrer"><code>--extern mirai_annotations=/path/to/compiled-artifact.rlib</code> argument</a> to the arguments received
from <a href="https://doc.rust-lang.org/cargo/" target="_blank" rel="noopener noreferrer">cargo</a> when invoking rustc on the target FRAME pallet.</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="identifying-and-generating-tractable-entry-points">Identifying (and generating) tractable entry points<a href="#identifying-and-generating-tractable-entry-points" class="hash-link" aria-label="Direct link to Identifying (and generating) tractable entry points" title="Direct link to Identifying (and generating) tractable entry points">â€‹</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="the-generics-challenge">The generics challenge<a href="#the-generics-challenge" class="hash-link" aria-label="Direct link to The generics challenge" title="Direct link to The generics challenge">â€‹</a></h6>
<p><a href="https://docs.substrate.io/learn/runtime-development/#frame" target="_blank" rel="noopener noreferrer">FRAME</a> is inherently a <a href="https://en.wikipedia.org/wiki/Generic_programming" target="_blank" rel="noopener noreferrer">generic</a> framework because it makes extensive use of <a href="https://doc.rust-lang.org/book/ch10-00-generics.html" target="_blank" rel="noopener noreferrer">Rust generic types and traits</a>,
most notably for <a href="https://docs.substrate.io/learn/rust-basics/#generics-and-configuration-traits" target="_blank" rel="noopener noreferrer">defining the configuration and &quot;dependencies&quot;</a> of pallets using a <code>Config</code> trait and
the <a href="https://docs.substrate.io/reference/frame-macros/#palletconfig" target="_blank" rel="noopener noreferrer"><code>#[pallet::config]</code> attribute macro</a>.
Additionally, generic types are used extensively when defining other entities, including in the <a href="https://docs.substrate.io/build/origins/" target="_blank" rel="noopener noreferrer">Origin</a> parameter for
<a href="https://docs.substrate.io/reference/frame-macros/#palletcall" target="_blank" rel="noopener noreferrer">dispatchable functions/extrinsics</a>, which is typically declared as a generic associated type
<a href="https://docs.rs/frame-system/latest/frame_system/pallet_prelude/type.OriginFor.html" target="_blank" rel="noopener noreferrer"><code>origin: OriginFor&lt;T&gt;</code></a>.</p>
<p>This presents a challenge when performing analysis with MIRAI, because <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#entry-points" target="_blank" rel="noopener noreferrer">&quot;it is not possible for a generic or
higher order function to serve as an entry point&quot;</a>. This is because
<a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#entry-points" target="_blank" rel="noopener noreferrer">&quot;it is necessary for MIRAI to resolve and analyze all functions that can be reached from an entry point&quot;</a>.</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="too-many-macro-generated-entry-points">Too many macro-generated entry points<a href="#too-many-macro-generated-entry-points" class="hash-link" aria-label="Direct link to Too many macro-generated entry points" title="Direct link to Too many macro-generated entry points">â€‹</a></h6>
<p>Another challenge is the fact that when MIRAI is invoked with its default configuration using <code>cargo mirai</code>,
it will attempt to analyze all entry points
(i.e. <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#entry-points" target="_blank" rel="noopener noreferrer">&quot;[all] function[s] that can be called externally [... e.g.] public function[s] of a library crate&quot;</a>).
In the context of a FRAME pallet, this essentially means MIRAI with attempt to analyze all functions with
<a href="https://doc.rust-lang.org/reference/visibility-and-privacy.html" target="_blank" rel="noopener noreferrer"><code>pub</code> visibility</a>. This ends up being a significant challenge for efficiency, and a cause of timeouts,
because even a relatively <a href="https://github.com/scs/MIRAI/blob/Milestone1_Research/substrate-examples/pallet_template/src/lib.rs" target="_blank" rel="noopener noreferrer">simple example pallet definition</a> like the one used by the
<a href="https://github.com/w3f/Grants-Program/blob/master/applications/sarp-basic-functionality.md" target="_blank" rel="noopener noreferrer">Supercomputing Systems AG (SCS) team</a> in the
<a href="https://github.com/w3f/Grant-Milestone-Delivery/blob/master/deliveries/sarp-basic-functionality-milestone-1.md" target="_blank" rel="noopener noreferrer">previously completed research grant</a> yields about ~300 entry points (i.e. public functions)
after macro expansion (you can inspect the list of entry points by running
<code>cargo clean &amp;&amp; MIRAI_FLAGS=&quot;--print_function_names&quot; cargo mirai</code>).</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="the-testexternalities-and-substratehostfunctions-challenge">The <code>TestExternalities</code> and <code>SubstrateHostFunctions</code> challenge<a href="#the-testexternalities-and-substratehostfunctions-challenge" class="hash-link" aria-label="Direct link to the-testexternalities-and-substratehostfunctions-challenge" title="Direct link to the-testexternalities-and-substratehostfunctions-challenge">â€‹</a></h6>
<p>A typical solution to the above two challenges is to <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#entry-points" target="_blank" rel="noopener noreferrer">analyze using only unit tests as entry points</a>
by running <code>cargo mirai --tests</code>. This is because <a href="https://docs.substrate.io/test/unit-testing/" target="_blank" rel="noopener noreferrer">unit tests</a> provide concrete types for
all generic types and traits, and will typically be a manageable number for a single crate.
This seems like a viable solution for our use case, since it&#x27;s a standard best-practice for Substrate/FRAME developers
to write <a href="https://docs.substrate.io/test/unit-testing/" target="_blank" rel="noopener noreferrer">unit tests</a> for all dispatchable functions/extrinsics.</p>
<p>However, here too we run into some challenges, presumably because the <a href="https://docs.rs/sp-io/latest/sp_io/type.SubstrateHostFunctions.html" target="_blank" rel="noopener noreferrer"><code>SubstrateHostFunctions</code></a>
and <a href="https://docs.rs/sp-io/latest/sp_io/type.TestExternalities.html" target="_blank" rel="noopener noreferrer"><code>TestExternalities</code></a> implementation needed to run <a href="https://docs.substrate.io/test/unit-testing/" target="_blank" rel="noopener noreferrer">unit tests</a>
introduces too much complexity in the form <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#foreign-functions" target="_blank" rel="noopener noreferrer">foreign functions</a> for which MIRAI can&#x27;t access MIR,
combined with some <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#call-resolution" target="_blank" rel="noopener noreferrer">complex indirection</a>, and so the analysis either aborts or timeouts.</p>
<p>Another efficiency concern for this approach is the fact that it&#x27;s quite common for a unit test to exercise a
single target function multiple times, or even for multiple unit tests to be written for a single function.
However, while this is perfectly reasonable for unit testing, it&#x27;s quite wasteful in an entry point for
abstract interpretation.</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="finding-tractable-entry-points">Finding tractable entry points<a href="#finding-tractable-entry-points" class="hash-link" aria-label="Direct link to Finding tractable entry points" title="Direct link to Finding tractable entry points">â€‹</a></h6>
<p>Since what prevents us from directly using <a href="https://docs.substrate.io/reference/frame-macros/#palletcall" target="_blank" rel="noopener noreferrer">dispatchable function/extrinsic</a> definitions as
entry points is the fact that they&#x27;re <a href="https://doc.rust-lang.org/book/ch10-00-generics.html" target="_blank" rel="noopener noreferrer">generic</a>, while unit tests provide concrete implementations
of the required generic types and traits, but introduce too much complexity presumably because of
<a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#foreign-functions" target="_blank" rel="noopener noreferrer">foreign functions</a> and <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#call-resolution" target="_blank" rel="noopener noreferrer">complex indirection</a> related to
<a href="https://docs.rs/sp-io/latest/sp_io/type.SubstrateHostFunctions.html" target="_blank" rel="noopener noreferrer"><code>SubstrateHostFunctions</code></a> and <a href="https://docs.rs/sp-io/latest/sp_io/type.TestExternalities.html" target="_blank" rel="noopener noreferrer"><code>TestExternalities</code></a> implementations.
A hybrid solution that uses the concrete types and arguments from unit tests to &quot;specialize&quot; direct calls to the
<a href="https://docs.substrate.io/reference/frame-macros/#palletcall" target="_blank" rel="noopener noreferrer">dispatchable functions/extrinsics</a> (i.e. bypassing calls to
<a href="https://paritytech.github.io/polkadot-sdk/master/sp_io/type.TestExternalities.html#method.execute_with" target="_blank" rel="noopener noreferrer"><code>sp_io::TestExternalities::new(..).execute_with(|| { .. })</code></a>,
<a href="https://docs.rs/frame-system/latest/frame_system/pallet/struct.GenesisConfig.html#method.build_storage" target="_blank" rel="noopener noreferrer"><code>frame_system::GenesisConfig::default().build_storage()</code></a> e.t.c) seems viable.</p>
<p>In fact, the viability of such a hybrid solution has already been successfully demonstrated in the
<a href="https://github.com/w3f/Grant-Milestone-Delivery/blob/master/deliveries/sarp-basic-functionality-milestone-1.md" target="_blank" rel="noopener noreferrer">previously completed research grant delivery</a> in which such a <a href="https://github.com/scs/MIRAI/blob/Milestone1_Research/substrate-examples/pallet_template/src/mirai.rs" target="_blank" rel="noopener noreferrer">&quot;hybrid&quot; entry point</a>
was manually implemented, and <a href="https://github.com/scs/MIRAI/blob/Milestone1_Research/substrate-examples/pallet_template/.cargo/config.toml#L2" target="_blank" rel="noopener noreferrer">configuring MIRAI to only analyze this entry point</a> eliminated the
timeouts and aborts that were otherwise experienced when MIRAI attempted to analyze all entry points as detailed
<a href="https://github.com/scs/MIRAI/blob/Milestone1_Research/substrate-examples/pallet_template/README.md" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>However, manually implementing these &quot;hybrid&quot; entry points is not scalable, so pallet-verifier will need to generate
them automatically.</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="generating-tractable-entry-points-automatically">Generating tractable entry points automatically<a href="#generating-tractable-entry-points-automatically" class="hash-link" aria-label="Direct link to Generating tractable entry points automatically" title="Direct link to Generating tractable entry points automatically">â€‹</a></h6>
<p>The first step of this process is finding a function call for each <a href="https://docs.substrate.io/reference/frame-macros/#palletcall" target="_blank" rel="noopener noreferrer">dispatchable function/extrinsic</a>
(i.e. presumably via &quot;specialized&quot; calls of dispatchable functions in <a href="https://docs.substrate.io/test/unit-testing/" target="_blank" rel="noopener noreferrer">unit tests</a>).
This will be done by <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.body_owners" target="_blank" rel="noopener noreferrer">retrieving</a> the <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/def_id/struct.DefId.html" target="_blank" rel="noopener noreferrer"><code>DefId</code>s</a> for all dispatchable functions,
and then implementing a <a href="https://rustc-dev-guide.rust-lang.org/mir/visitor.html" target="_blank" rel="noopener noreferrer">MIR visitor</a> that finds <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/terminator/struct.Terminator.html" target="_blank" rel="noopener noreferrer"><code>Terminator</code>s</a> of the
<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/syntax/enum.TerminatorKind.html#variant.Call" target="_blank" rel="noopener noreferrer"><code>TerminatorKind::Call { func, args, .. }</code></a> variant whose <code>func</code> operand matches/wraps
the <code>DefId</code> of a dispatchable function.</p>
<p>Then, the concrete types and argument values used in the discovered &quot;specialized&quot; dispatchable function calls
will be used to construct/generate tractable entry points (i.e. definitions of minimal public functions that
make dispatchable calls similar to <a href="https://github.com/scs/MIRAI/blob/Milestone1_Research/substrate-examples/pallet_template/src/mirai.rs" target="_blank" rel="noopener noreferrer">this &quot;hybrid&quot; entry point from the previous research deliverable</a>).</p>
<p>Note that, at this point we can emit a warning for any dispatchable functions for which no &quot;specialized&quot; call
could be found (i.e. presumably because no unit tests are defined for it), or even abort with an error message,
if no &quot;specialized&quot; calls are found for any of the dispatchable functions.</p>
<p>Switching our focus back to the generated tractable entry points, one challenge here is that we&#x27;ll need <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/def_id/struct.DefId.html" target="_blank" rel="noopener noreferrer"><code>DefId</code>s</a>
for these generated tractable entry points (inorder to pass them to MIRAI for analysis), but <code>DefId</code>s are created
during <a href="https://rustc-dev-guide.rust-lang.org/hir.html" target="_blank" rel="noopener noreferrer">HIR (High-Level Intermediate Representation)</a> lowering (<a href="https://rustc-dev-guide.rust-lang.org/lowering.html" target="_blank" rel="noopener noreferrer">see also</a>).</p>
<p>Fortunately, rustc&#x27;s <a href="https://rustc-dev-guide.rust-lang.org/query.html" target="_blank" rel="noopener noreferrer">query-based and demand-driven compilation model</a> means it has excellent support for
<a href="https://rustc-dev-guide.rust-lang.org/queries/incremental-compilation-in-detail.html" target="_blank" rel="noopener noreferrer">incremental compilation/analysis</a> (<a href="https://rustc-dev-guide.rust-lang.org/queries/incremental-compilation.html" target="_blank" rel="noopener noreferrer">see also</a>), this allows us to
(strategically) add our generated entry points to the target FRAME pallet&#x27;s &quot;virtual&quot; source code without needing to
recompile any unrelated code.</p>
<p>Lastly, while adding our generated entry points, we&#x27;d prefer <em>not</em> to edit the target FRAME pallet&#x27;s
&quot;actual&quot; source code (i.e. no changes on disk), so our <a href="https://rustc-dev-guide.rust-lang.org/rustc-driver.html" target="_blank" rel="noopener noreferrer">custom rustc driver</a> will use rustc&#x27;s
<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_span/source_map/trait.FileLoader.html" target="_blank" rel="noopener noreferrer"><code>FileLoader</code> API</a> to <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_interface/interface/struct.Config.html#structfield.file_loader" target="_blank" rel="noopener noreferrer">provide a custom <code>FileLoader</code></a> that feeds
our generated entry points directly into the compiler (i.e. without modifying the FRAME pallet&#x27;s
&quot;actual&quot; source code on disk - hence the &quot;virtual&quot; phrasing in the last paragraph).</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="using-mirai-as-a-library">Using MIRAI as a library<a href="#using-mirai-as-a-library" class="hash-link" aria-label="Direct link to Using MIRAI as a library" title="Direct link to Using MIRAI as a library">â€‹</a></h5>
<p>At this point, we&#x27;ve already detailed how we&#x27;ll use <a href="https://github.com/rust-lang/rust" target="_blank" rel="noopener noreferrer">rustc</a> as a library via our custom <a href="https://rustc-dev-guide.rust-lang.org/rustc-driver.html" target="_blank" rel="noopener noreferrer">rustc driver</a>,
in order to customize compilation and analysis to our target domain (i.e. analyzing <a href="https://docs.substrate.io/learn/runtime-development/#frame" target="_blank" rel="noopener noreferrer">FRAME pallets</a>).
Similarly, a few considerations mean we&#x27;ll need to use MIRAI as a library as well, to give us more flexibility
in resolving a few domain-specific challenges related to analyzing <a href="https://docs.substrate.io/learn/runtime-development/#frame" target="_blank" rel="noopener noreferrer">FRAME pallets</a>.</p>
<p>It was noted in the <a href="https://github.com/w3f/Grant-Milestone-Delivery/blob/master/deliveries/sarp-basic-functionality-milestone-1.md" target="_blank" rel="noopener noreferrer">previously completed research grant delivery</a> that the diagnostic level
had to be set to <code>paranoid</code> (i.e. <code>--diag=paranoid</code>) for MIRAI to emit some expected warnings.
However, the <code>paranoid</code> diagnostic level produces a lot of warnings (<a href="https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/options.rs#L32" target="_blank" rel="noopener noreferrer">by design</a>),
since it&#x27;s maximally strict and so warns about <a href="https://github.com/facebookexperimental/MIRAI/blob/main/README.md#how-to-use-mirai" target="_blank" rel="noopener noreferrer">&quot;any issue that may be an error&quot;</a>, by essentially disabling
some of MIRAI&#x27;s &quot;normal&quot; mechanisms for <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#reducing-false-positives" target="_blank" rel="noopener noreferrer">reducing false positives</a>, like
<a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#reducing-false-positives" target="_blank" rel="noopener noreferrer">&quot;suppressing any diagnostics that <em>arise</em> within the standard library or third party code
[... i.e. diagnostics that are [not] tied to source locations within the [current] crate]&quot;</a>.</p>
<p>However, by examining the reported diagnostic from <a href="https://github.com/w3f/Grant-Milestone-Delivery/blob/master/deliveries/sarp-basic-functionality-milestone-1.md" target="_blank" rel="noopener noreferrer">the previous research delivery</a>
(see image below), we can make a few important observations:</p>
<ul>
<li>The primary span/location for the diagnostic is pointing to the <a href="https://docs.rs/frame-support/latest/frame_support/" target="_blank" rel="noopener noreferrer"><code>frame_support</code> pallet</a>,
and specifically the <a href="https://github.com/paritytech/polkadot-sdk/blob/6c5a42a690f96d59dbdf94640188f5d5b5cc47e2/substrate/frame/support/src/storage/transactional.rs#L178" target="_blank" rel="noopener noreferrer"><code>frame_support::storage::with_storage_layer</code> function</a>,
which explains why this diagnostic is only emitted at the <code>paranoid</code> level (i.e. it&#x27;s arising from a
third-party library as far as MIRAI is concerned).</li>
<li>There are still some sub-diagnostics relating the primary diagnostic to the current crate
(i.e. the <code>note: related location ...</code> lines).</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://raw.githubusercontent.com/scs/MIRAI/Milestone1_Research/substrate-examples/pallet_template/UnsatisfiedPrecondition.png" alt="SCS Research Warning" class="img_ev3q"></p>
<p>Armed with this information, we can use <a href="https://crates.io/crates/cargo-expand" target="_blank" rel="noopener noreferrer">cargo expand</a> to have a look at the final code (i.e. after macro expansion)
for the target dispatchable function (i.e. the <a href="https://github.com/scs/MIRAI/blob/Milestone1_Research/substrate-examples/pallet_template/src/lib.rs#L100-L109" target="_blank" rel="noopener noreferrer"><code>do_something</code> function</a>) below:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">impl</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Config</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token class-name">Pallet</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">do_something</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">origin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">OriginFor</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> something</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">DispatchResult</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token namespace" style="opacity:0.7">frame_support</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">storage</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">with_storage_layer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> who </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ensure_signed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">origin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">clone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">Self</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">sarp_put_sensitive_value</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">origin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> something</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">Self</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">deposit_event</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Event</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">SomethingStored</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                something</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                who</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// ..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Notice that <a href="https://docs.substrate.io/learn/runtime-development/#frame" target="_blank" rel="noopener noreferrer">FRAME</a> wraps the user written body of the dispatchable function, with a call to
<a href="https://docs.rs/frame-support/latest/frame_support/storage/transactional/fn.with_storage_layer.html" target="_blank" rel="noopener noreferrer"><code>frame_support::storage::with_storage_layer</code></a>, and presumably the <a href="https://en.wikipedia.org/wiki/Indirection" target="_blank" rel="noopener noreferrer">indirection</a>
introduced by this <a href="https://doc.rust-lang.org/book/ch13-01-closures.html" target="_blank" rel="noopener noreferrer">closure</a>-based invocation, combined with the complexity introduced by the way
<a href="https://doc.rust-lang.org/proc_macro/struct.Span.html#method.call_site" target="_blank" rel="noopener noreferrer">procedural macros report call-site information</a> leads to MIRAI reporting the
<a href="https://github.com/paritytech/polkadot-sdk/blob/6c5a42a690f96d59dbdf94640188f5d5b5cc47e2/substrate/frame/support/src/storage/transactional.rs#L178" target="_blank" rel="noopener noreferrer">closure call inside the <code>frame_support::storage::with_storage_layer</code> function</a> as the
primary source location for the diagnostic.</p>
<p>Presumably, we can find ways of &quot;fixing&quot; this in MIRAI, while taking care <em>not</em> to introduce false positives in
other adjacent cases, but such a generic fix will likely be <em>non</em>-trivial.
Nevertheless, such efforts will be pursued, but not as part of the scope of this grant application.</p>
<p>However, an alternative approach is to use our domain-specific knowledge to determine which diagnostics to
either &quot;suppress&quot; or &quot;promote&quot;, because, being a domain-specific tool, pallet-verifier will always &quot;know&quot; more
about the analysis context than MIRAI. Therefore, our approach will be to integrate with MIRAI as a library.
This will allow us to access <a href="https://github.com/facebookexperimental/MIRAI/blob/main/checker/src/crate_visitor.rs#L50" target="_blank" rel="noopener noreferrer">MIRAI&#x27;s diagnostics buffer</a> directly, and use our own custom filters
to determine which diagnostics to emit based on: the reported primary location, reported related locations,
and taking into account the behavior of FRAME macro generated code.</p>
<p>Another benefit of this approach is it can lead to some efficiency gains by bypassing some redundant work in MIRAI
(e.g. <a href="https://github.com/facebookexperimental/MIRAI/blob/a94a8c77a453e1d2365b39aa638a4f5e6b1d4dc3/checker/src/crate_visitor.rs#L84-L132" target="_blank" rel="noopener noreferrer">iterating over all body owners</a> to find the <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/def_id/struct.DefId.html" target="_blank" rel="noopener noreferrer"><code>DefId</code></a> of the target function,
when pallet-verifier already knows the relevant <code>DefId</code> and so can just call
<a href="https://github.com/facebookexperimental/MIRAI/blob/main/checker/src/crate_visitor.rs#L174" target="_blank" rel="noopener noreferrer">the <code>analyze_body</code> function</a> directly e.t.c).</p>
<p>Lastly, another lever for reducing false positives (i.e. irrelevant warnings) related to
<a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#incomplete-analysis" target="_blank" rel="noopener noreferrer">incomplete analysis due to missing MIR bodies</a> for <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#foreign-functions" target="_blank" rel="noopener noreferrer">&quot;foreign functions&quot;</a>
(e.g. standard library functions that aren&#x27;t inlined, and system calls), is to add
<a href="https://github.com/facebookexperimental/MIRAI/blob/main/standard_contracts/src/foreign_contracts.rs" target="_blank" rel="noopener noreferrer">&quot;summaries/foreign contracts&quot;</a> for these <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#foreign-functions" target="_blank" rel="noopener noreferrer">&quot;foreign functions&quot;</a>,
thus making the analysis more precise. While this part of MIRAI is not that well documented,
it&#x27;s not that hard to figure out how to add these <a href="https://github.com/facebookexperimental/MIRAI/blob/main/standard_contracts/src/foreign_contracts.rs" target="_blank" rel="noopener noreferrer">&quot;summaries/foreign contracts&quot;</a>
from the <a href="https://github.com/facebookexperimental/MIRAI/blob/main/standard_contracts/src/foreign_contracts.rs" target="_blank" rel="noopener noreferrer">existing examples</a> and <a href="https://github.com/facebookexperimental/MIRAI/blob/main/checker/src/utils.rs#L402-L413" target="_blank" rel="noopener noreferrer">related utilities</a>,
which actually show that these <a href="https://github.com/facebookexperimental/MIRAI/blob/main/checker/src/utils.rs#L373-L376" target="_blank" rel="noopener noreferrer">&quot;summaries/foreign contracts&quot; can be defined outside MIRAI</a>,
which certainly gives us more flexibility without having to modify MIRAI itself.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking-performance-and-accuracy">Benchmarking performance and accuracy<a href="#benchmarking-performance-and-accuracy" class="hash-link" aria-label="Direct link to Benchmarking performance and accuracy" title="Direct link to Benchmarking performance and accuracy">â€‹</a></h5>
<p>This stage of the project will create a simple benchmark to showcase the performance and accuracy metrics of
pallet-verifier on a few production pallets (e.g. 3-5 pallets from <a href="https://docs.substrate.io/reference/frame-pallets/" target="_blank" rel="noopener noreferrer">this list</a>).
For each pallet in the benchmark suite, we&#x27;ll add <em>bad</em> variants of dispatchable functions by
replacing proper error handling and safe arithmetic constructs with panicking and overflow/underflow-ing equivalents,
while also keeping the <em>good</em> variants unedited. The benchmarks will then report execution time and ratio of
true vs false positives for each dispatchable function, as well as aggregates for these metrics for
the target pallets and the entire benchmark suite.</p>
<p>In general, we&#x27;ll be motivated to reduce the amount of false positives (if any), and that could be viewed as
<a href="https://en.wikipedia.org/wiki/Gaming_the_system" target="_blank" rel="noopener noreferrer">&quot;gaming the benchmark&quot;</a>. However, for our use case, this will be desirable behavior as long as
the fixes applied to remove/reduce the false positives are generic in nature
(i.e. the fixes are applicable to any pallet, and <em>don&#x27;t</em> just simply detect the presence of a specific pallet and
adjust the behavior of the tool based on this knowledge).</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="other-considerations">Other considerations<a href="#other-considerations" class="hash-link" aria-label="Direct link to Other considerations" title="Direct link to Other considerations">â€‹</a></h5>
<p>Finally, an important consideration to keep in mind is that MIRAI
<a href="https://github.com/facebookexperimental/MIRAI/blob/main/README.md#mirai--" target="_blank" rel="noopener noreferrer">&quot;is intended to become a widely used static analysis tool for Rust&quot;</a>, and in the wider Rust ecosystem,
it&#x27;s quite common (and sometimes even reasonable) for functions to panic in cases when they&#x27;re called with
&quot;problematic&quot; arguments.</p>
<p>Because of this, MIRAI makes a lot of effort to try to
<a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Overview.md#reducing-false-positives" target="_blank" rel="noopener noreferrer">suppress warnings that would be perceived as false positives</a> in the context of the wider Rust ecosystem.
However, some of these warnings are legitimate bugs in the context of a blockchain runtime.
A notable example of this is MIRAI&#x27;s <a href="https://github.com/facebookexperimental/MIRAI/blob/main/documentation/Decisions.md#precondition-inference" target="_blank" rel="noopener noreferrer">precondition inference</a> which has the effect of
suppressing warnings about possible panics if the panic is conditional on a parameter of the entry point e.g.
MIRAI will not report a panic from the code snippet below, even at the <code>paranoid</code> diagnostic level,
if it&#x27;s analyzed as an entry point.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">hates_zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> val </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property" style="color:#36acaa">panic!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;I hate zeros!&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note however, that this is only problematic for our use case if it happens in an entry point.
This is because when <code>hates_zeros</code> is not an entry point, the inferred precondition (i.e. <code>verify!(val != 0)</code>),
will need to be satisfied by the function&#x27;s callers.</p>
<p>This particular behavior ends up not being an issue for our proposed architecture, because our entry points
will be simple and artificially constructed with no parameters and no branching.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="technology-stack">Technology Stack<a href="#technology-stack" class="hash-link" aria-label="Direct link to Technology Stack" title="Direct link to Technology Stack">â€‹</a></h4>
<p><a href="https://www.rust-lang.org/" target="_blank" rel="noopener noreferrer">Rust</a> - will be used for implementing all components of pallet-verifier.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ecosystem-fit">Ecosystem Fit<a href="#ecosystem-fit" class="hash-link" aria-label="Direct link to Ecosystem Fit" title="Direct link to Ecosystem Fit">â€‹</a></h3>
<p><a href="https://docs.substrate.io/learn/runtime-development/#frame" target="_blank" rel="noopener noreferrer">FRAME pallets</a> are an <a href="https://docs.substrate.io/learn/architecture/#frame-libraries-for-the-runtime" target="_blank" rel="noopener noreferrer">essential building block for composing Substrate-based blockchain runtimes</a>,
therefore, as rightfully identified by the <a href="https://github.com/w3f/Grants-Program/blob/master/docs/RFPs/Static-Analysis-for-Runtime-Pallets.md" target="_blank" rel="noopener noreferrer">RFP for Static Analysis for Runtime Pallets</a>, tools like
pallet-verifier that integrate directly into developer workflows, and detect and warn developers about potential
security vulnerabilities in pallets are essential for improving security in the Polkadot/Substrate/Kusama ecosystem.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="team-busts_in_silhouette">Team <!-- -->ðŸ‘¥<a href="#team-busts_in_silhouette" class="hash-link" aria-label="Direct link to team-busts_in_silhouette" title="Direct link to team-busts_in_silhouette">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="team-members">Team members<a href="#team-members" class="hash-link" aria-label="Direct link to Team members" title="Direct link to Team members">â€‹</a></h3>
<ul>
<li>David Semakula <a href="https://github.com/davidsemakula" target="_blank" rel="noopener noreferrer">davidsemakula</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="contact">Contact<a href="#contact" class="hash-link" aria-label="Direct link to Contact" title="Direct link to Contact">â€‹</a></h3>
<ul>
<li><strong>Contact Name:</strong> David Semakula</li>
<li><strong>Contact Email:</strong> <a href="mailto:hello@davidsemakula.com" target="_blank" rel="noopener noreferrer">hello@davidsemakula.com</a></li>
<li><strong>Website:</strong> <a href="https://davidsemakula.com" target="_blank" rel="noopener noreferrer">https://davidsemakula.com</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="legal-structure">Legal Structure<a href="#legal-structure" class="hash-link" aria-label="Direct link to Legal Structure" title="Direct link to Legal Structure">â€‹</a></h3>
<p>I&#x27;ll be working as an individual.</p>
<ul>
<li><strong>Registered Address:</strong> N/A</li>
<li><strong>Registered Legal Entity:</strong> N/A</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="teams-experience">Team&#x27;s experience<a href="#teams-experience" class="hash-link" aria-label="Direct link to Team&#x27;s experience" title="Direct link to Team&#x27;s experience">â€‹</a></h3>
<p>I&#x27;m an independent Software Engineer &amp; Systems Architect with over 10 years of experience.</p>
<p>I&#x27;m the creator of <a href="https://github.com/ink-analyzer" target="_blank" rel="noopener noreferrer">ink! analyzer</a> (a collection of modular and reusable libraries and tools for
semantic analysis of <a href="https://use.ink/" target="_blank" rel="noopener noreferrer">ink!</a> smart contracts). Notably, like <a href="https://docs.substrate.io/learn/runtime-development/#frame" target="_blank" rel="noopener noreferrer">FRAME</a>, <a href="https://use.ink/" target="_blank" rel="noopener noreferrer">ink!</a> is also a Rust <a href="https://doc.rust-lang.org/rust-by-example/macros/dsl.html" target="_blank" rel="noopener noreferrer">DSL</a>.
I also <a href="https://github.com/rust-lang/rust-analyzer/pulls?q=is%3Apr+author%3Adavidsemakula" target="_blank" rel="noopener noreferrer">independently contribute</a> to <a href="https://github.com/rust-lang/rust-analyzer" target="_blank" rel="noopener noreferrer">rust-analyzer</a> (a Rust <a href="https://en.wikipedia.org/wiki/Compiler#Front_end" target="_blank" rel="noopener noreferrer">compiler front-end</a> for IDEs).</p>
<p>I&#x27;ve previously worked as a technical lead on projects for <a href="https://www.hubspot.com/" target="_blank" rel="noopener noreferrer">HubSpot</a>, <a href="https://www.permobil.com/" target="_blank" rel="noopener noreferrer">Permobil</a>, <a href="https://www.pressboardmedia.com/" target="_blank" rel="noopener noreferrer">Pressboard</a>, <a href="https://www.grindery.io/" target="_blank" rel="noopener noreferrer">Grindery</a>,
<a href="https://w.inboundlabs.co/" target="_blank" rel="noopener noreferrer">InboundLabs</a>, <a href="https://tunga.io/" target="_blank" rel="noopener noreferrer">Tunga</a>, <a href="https://www.butterflyworks.org/" target="_blank" rel="noopener noreferrer">ButterflyWorks</a>, <a href="https://www.telegraaf.nl/" target="_blank" rel="noopener noreferrer">Telegraaf Media Groep (TMG)</a> and many more companies.</p>
<p>I hold a Bachelor of Science in Computer Science degree from <a href="https://cis.mak.ac.ug/" target="_blank" rel="noopener noreferrer">Makerere University, Kampala, Uganda</a>.
You can find my full profile at <a href="https://davidsemakula.com" target="_blank" rel="noopener noreferrer">https://davidsemakula.com</a>.</p>
<p><a href="https://github.com/ink-analyzer" target="_blank" rel="noopener noreferrer">ink! analyzer</a> was previously funded by two Web3 Foundation grants (see <a href="https://github.com/w3f/Grants-Program/blob/master/applications/ink-analyzer.md" target="_blank" rel="noopener noreferrer">this</a> and <a href="https://github.com/w3f/Grants-Program/blob/master/applications/ink-analyzer-phase-2.md" target="_blank" rel="noopener noreferrer">this</a>).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="team-code-repos">Team Code Repos<a href="#team-code-repos" class="hash-link" aria-label="Direct link to Team Code Repos" title="Direct link to Team Code Repos">â€‹</a></h3>
<ul>
<li><a href="https://github.com/davidsemakula" target="_blank" rel="noopener noreferrer">https://github.com/davidsemakula</a></li>
<li><a href="https://github.com/ink-analyzer/ink-analyzer" target="_blank" rel="noopener noreferrer">https://github.com/ink-analyzer/ink-analyzer</a></li>
<li><a href="https://github.com/ink-analyzer/ink-vscode" target="_blank" rel="noopener noreferrer">https://github.com/ink-analyzer/ink-vscode</a></li>
<li><a href="https://github.com/wamutech/wamu-rs" target="_blank" rel="noopener noreferrer">https://github.com/wamutech/wamu-rs</a></li>
<li><a href="https://github.com/wamutech/wamu-spec" target="_blank" rel="noopener noreferrer">https://github.com/wamutech/wamu-spec</a></li>
<li><a href="https://github.com/davidsemakula/substrate-vault" target="_blank" rel="noopener noreferrer">https://github.com/davidsemakula/substrate-vault</a></li>
<li><a href="https://github.com/mukutu-tech/mukutu-safe" target="_blank" rel="noopener noreferrer">https://github.com/mukutu-tech/mukutu-safe</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="team-linkedin-profiles-if-available">Team LinkedIn Profiles (if available)<a href="#team-linkedin-profiles-if-available" class="hash-link" aria-label="Direct link to Team LinkedIn Profiles (if available)" title="Direct link to Team LinkedIn Profiles (if available)">â€‹</a></h3>
<ul>
<li><a href="https://davidsemakula.com" target="_blank" rel="noopener noreferrer">https://davidsemakula.com</a> (I use my own website for my profile)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="development-status-open_book">Development Status <!-- -->ðŸ“–<a href="#development-status-open_book" class="hash-link" aria-label="Direct link to development-status-open_book" title="Direct link to development-status-open_book">â€‹</a></h2>
<p>A significant amount of research of internals of the related tools (i.e. <a href="https://github.com/rust-lang/rust" target="_blank" rel="noopener noreferrer">rustc</a> and <a href="https://github.com/facebookexperimental/MIRAI" target="_blank" rel="noopener noreferrer">MIRAI</a>), as well as a review
of the <a href="https://github.com/w3f/Grant-Milestone-Delivery/blob/master/deliveries/sarp-basic-functionality-milestone-1.md" target="_blank" rel="noopener noreferrer">previously completed research delivery by Supercomputing Systems AG (SCS)</a>,
has been done to inform the proposed architecture of pallet-verifier, as described in detail in the
<a href="#project-details">Project Details</a> section above.
Beyond this, no meaningful development has started for this project.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="development-roadmap-nut_and_bolt">Development Roadmap <!-- -->ðŸ”©<a href="#development-roadmap-nut_and_bolt" class="hash-link" aria-label="Direct link to development-roadmap-nut_and_bolt" title="Direct link to development-roadmap-nut_and_bolt">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview-1">Overview<a href="#overview-1" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">â€‹</a></h3>
<ul>
<li><strong>Total Estimated Duration:</strong> ~4 months</li>
<li><strong>Full-Time Equivalent (FTE):</strong>  1</li>
<li><strong>Total Costs:</strong> 30,000 USD</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="milestone-1--rustc-driver-cargo-subcommand-basic-mirai-integration-and-automatic-tractable-entry-point-generation">Milestone 1 â€” rustc driver, cargo subcommand, basic MIRAI integration, and automatic tractable entry point generation<a href="#milestone-1--rustc-driver-cargo-subcommand-basic-mirai-integration-and-automatic-tractable-entry-point-generation" class="hash-link" aria-label="Direct link to Milestone 1 â€” rustc driver, cargo subcommand, basic MIRAI integration, and automatic tractable entry point generation" title="Direct link to Milestone 1 â€” rustc driver, cargo subcommand, basic MIRAI integration, and automatic tractable entry point generation">â€‹</a></h3>
<ul>
<li><strong>Estimated duration:</strong> ~7-8 weeks</li>
<li><strong>FTE:</strong>  1</li>
<li><strong>Costs:</strong> 15,000 USD</li>
</ul>
<table><thead><tr><th style="text-align:right">Number</th><th>Deliverable</th><th>Specification</th></tr></thead><tbody><tr><td style="text-align:right"><strong>0a.</strong></td><td>License</td><td>MIT or Apache 2.0</td></tr><tr><td style="text-align:right"><strong>0b.</strong></td><td>Documentation</td><td>I will provide detailed source documentation including <a href="https://doc.rust-lang.org/rustdoc/what-is-rustdoc.html" target="_blank" rel="noopener noreferrer">rustdoc</a> documentation, a document describing the design and high-level architecture of pallet-verifier (i.e. similar to the <a href="#project-details">project details</a> section of this document), and a README file providing general information about the tool, installation and usage instructions, and links to other documentation and resources related to the tool.</td></tr><tr><td style="text-align:right"><strong>0c.</strong></td><td>Testing and Testing Guide</td><td>Core functions will be fully covered by comprehensive <a href="https://rustc-dev-guide.rust-lang.org/tests/ui.html#introduction" target="_blank" rel="noopener noreferrer">UI tests</a> to ensure functionality and robustness. Additionally, a <a href="#benchmarking-performance-and-accuracy">benchmark suite that showcases the performance and accuracy metrics of the tool on 3-5 production pallets</a> will be implemented. In the guide, I will describe how to run these tests and benchmarks.</td></tr><tr><td style="text-align:right"><strong>0d.</strong></td><td>Docker</td><td>N/A</td></tr><tr><td style="text-align:right">1.</td><td>Rust binary crate</td><td>I will create a Rust binary crate that implements a custom <a href="https://rustc-dev-guide.rust-lang.org/rustc-driver.html" target="_blank" rel="noopener noreferrer">rustc driver</a>, <a href="https://doc.rust-lang.org/cargo/reference/external-tools.html#custom-subcommands" target="_blank" rel="noopener noreferrer">custom cargo subcommand</a>, basic <a href="https://github.com/facebookexperimental/MIRAI" target="_blank" rel="noopener noreferrer">MIRAI</a> integration (i.e. excluding <a href="#adding-mirai-annotations-automatically">automatic annotation capabilities</a>), and <a href="#generating-tractable-entry-points-automatically">automatic tractable entry point generation</a> which will enable invoking pallet-verifier as a cargo subcommand (e.g. <code>cargo verify-pallet</code>) on <a href="https://docs.substrate.io/learn/runtime-development/#frame" target="_blank" rel="noopener noreferrer">FRAME pallets</a> to detect potential <a href="https://secure-contracts.com/not-so-smart-contracts/substrate/dont_panic/" target="_blank" rel="noopener noreferrer">panics</a> and <a href="https://secure-contracts.com/not-so-smart-contracts/substrate/arithmetic_overflow/" target="_blank" rel="noopener noreferrer">arithmetic overflow/underflow</a> due to arithmetic operations (i.e. excluding <a href="https://doc.rust-lang.org/reference/expressions/operator-expr.html#type-cast-expressions" target="_blank" rel="noopener noreferrer"><code>as</code> conversions/ type cast operations</a>).</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="milestone-2--mir-annotation-capabilities-and-detecting-arithmetic-overflowunderflow-and-lossy-integer-conversions-due-to-as-conversions">Milestone 2 â€” MIR annotation capabilities and detecting arithmetic overflow/underflow (and lossy integer conversions) due to <code>as</code> conversions<a href="#milestone-2--mir-annotation-capabilities-and-detecting-arithmetic-overflowunderflow-and-lossy-integer-conversions-due-to-as-conversions" class="hash-link" aria-label="Direct link to milestone-2--mir-annotation-capabilities-and-detecting-arithmetic-overflowunderflow-and-lossy-integer-conversions-due-to-as-conversions" title="Direct link to milestone-2--mir-annotation-capabilities-and-detecting-arithmetic-overflowunderflow-and-lossy-integer-conversions-due-to-as-conversions">â€‹</a></h3>
<ul>
<li><strong>Estimated duration:</strong> ~7-8 weeks</li>
<li><strong>FTE:</strong>  1</li>
<li><strong>Costs:</strong> 15,000 USD</li>
</ul>
<table><thead><tr><th style="text-align:right">Number</th><th>Deliverable</th><th>Specification</th></tr></thead><tbody><tr><td style="text-align:right"><strong>0a.</strong></td><td>License</td><td>MIT or Apache 2.0</td></tr><tr><td style="text-align:right"><strong>0b.</strong></td><td>Documentation</td><td>I will provide detailed source documentation including <a href="https://doc.rust-lang.org/rustdoc/what-is-rustdoc.html" target="_blank" rel="noopener noreferrer">rustdoc</a> documentation, a document describing the design and high-level architecture of pallet-verifier (i.e. similar to the <a href="#project-details">project details</a> section of this document), and a README file providing general information about the tool, installation and usage instructions, and links to other documentation and resources related to the tool.</td></tr><tr><td style="text-align:right"><strong>0c.</strong></td><td>Testing and Testing Guide</td><td>Core functions will be fully covered by comprehensive <a href="https://rustc-dev-guide.rust-lang.org/tests/ui.html#introduction" target="_blank" rel="noopener noreferrer">UI tests</a> to ensure functionality and robustness. Additionally, a <a href="#benchmarking-performance-and-accuracy">benchmark suite that showcases the performance and accuracy metrics of the tool on 3-5 production pallets</a> will be implemented. In the guide, I will describe how to run these tests and benchmarks.</td></tr><tr><td style="text-align:right"><strong>0d.</strong></td><td>Docker</td><td>N/A</td></tr><tr><td style="text-align:right">0e.</td><td>Article</td><td>I will publish an <strong>article</strong> that explains how pallet-verifier works, the security vulnerabilities it can detect, and how to use it to analyze <a href="https://docs.substrate.io/learn/runtime-development/#frame" target="_blank" rel="noopener noreferrer">FRAME pallets</a>.</td></tr><tr><td style="text-align:right">1.</td><td>Rust binary crate update</td><td>I will update the Rust binary that implements pallet-verifier to support <a href="#adding-the-mirai-annotations-crate-as-a-dependency">adding the <code>mirai-annotations</code> crate as a dependency to FRAME pallets without editing <code>Cargo.toml</code></a>, <a href="#adding-mirai-annotations-to-mir">adding MIRAI annotations to MIR</a>, and more specifically to support <a href="#adding-mirai-annotations-automatically">automatically adding annotations for verifying that integer <code>as</code> conversions don&#x27;t overflow/underflow nor lose precision</a>.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-plans">Future Plans<a href="#future-plans" class="hash-link" aria-label="Direct link to Future Plans" title="Direct link to Future Plans">â€‹</a></h2>
<p>In the short term, I will likely apply for follow-up funding for:</p>
<ul>
<li>improving or widening the scope of existing analyses e.g. detecting panics in <a href="https://paritytech.github.io/polkadot-sdk/master/frame_support/traits/trait.Hooks.html" target="_blank" rel="noopener noreferrer">pallet/runtime hooks</a>.</li>
<li>adding analyses for more <a href="https://secure-contracts.com/not-so-smart-contracts/substrate/" target="_blank" rel="noopener noreferrer">vulnerability classes</a> and <a href="https://docs.substrate.io/build/troubleshoot-your-code/#unsafe-or-insecure-patterns" target="_blank" rel="noopener noreferrer">insecure patterns</a>
(e.g. <a href="https://secure-contracts.com/not-so-smart-contracts/substrate/origins/" target="_blank" rel="noopener noreferrer">insufficient or missing origin checks</a>, <a href="https://secure-contracts.com/not-so-smart-contracts/substrate/randomness/" target="_blank" rel="noopener noreferrer">bad randomness</a>,
<a href="https://secure-contracts.com/not-so-smart-contracts/substrate/validate_unsigned/" target="_blank" rel="noopener noreferrer">insufficient unsigned transaction validation</a> e.t.c).</li>
<li>adding support for using other specialized static analysis tools as backends for specific analyses
(e.g. <a href="https://en.wikipedia.org/wiki/Symbolic_execution" target="_blank" rel="noopener noreferrer">symbolic execution engines</a>).</li>
</ul>
<p>Additionally, an often noted disadvantage of building Rust static analysis tools based on <a href="https://rustc-dev-guide.rust-lang.org/mir/" target="_blank" rel="noopener noreferrer">MIR</a> (and indeed plugging into the
rust compiler in general), is the fact that rustc&#x27;s APIs for <a href="https://rustc-dev-guide.rust-lang.org/mir/" target="_blank" rel="noopener noreferrer">MIR</a> (or more generally rustc&#x27;s internal APIs)
are <a href="https://rustc-dev-guide.rust-lang.org/rustc-driver.html" target="_blank" rel="noopener noreferrer">unstable</a>.
There&#x27;s an ongoing effort to address some of these issues in the form of the official
<a href="https://github.com/rust-lang/project-stable-mir" target="_blank" rel="noopener noreferrer">Stable MIR Librarification Project</a>, however, this project is still relatively early, and at the moment,
also still <a href="https://hackmd.io/XhnYHKKuR6-LChhobvlT-g?view#Requirements" target="_blank" rel="noopener noreferrer">unstable (i.e. pre-1.0)</a>.
Nevertheless, migrating pallet-verifier (and related tools like <a href="https://github.com/facebookexperimental/MIRAI" target="_blank" rel="noopener noreferrer">MIRAI</a>) to the <a href="https://github.com/rust-lang/project-stable-mir" target="_blank" rel="noopener noreferrer">stable MIR API</a>,
whenever it&#x27;s ready, should be considered a long-term goal for the project.</p>
<p>Another related area of interest would be either extending the scope of the tool,
or creating a similar tool, to analyze <a href="https://use.ink/" target="_blank" rel="noopener noreferrer">ink!</a> smart contracts using similar static analysis tools and techniques.</p>
<p>Finally, as the project is a public good, ultimately, the long term goal is to create a community of users,
contributors and ecosystem partners who are invested in the project&#x27;s long-term success because of its utility.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="referral-program-optional-moneybag">Referral Program (optional) <!-- -->ðŸ’°<a href="#referral-program-optional-moneybag" class="hash-link" aria-label="Direct link to referral-program-optional-moneybag" title="Direct link to referral-program-optional-moneybag">â€‹</a></h2>
<p>N/A</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-information-heavy_plus_sign">Additional Information <!-- -->âž•<a href="#additional-information-heavy_plus_sign" class="hash-link" aria-label="Direct link to additional-information-heavy_plus_sign" title="Direct link to additional-information-heavy_plus_sign">â€‹</a></h2>
<p><strong>How did you hear about the Grants Program?</strong></p>
<p>Web3 Foundation Website.</p>
<p>I have also previously successfully applied for and completed two Web3 Foundation grants
(see <a href="https://github.com/w3f/Grants-Program/blob/master/applications/ink-analyzer.md" target="_blank" rel="noopener noreferrer">this</a> and <a href="https://github.com/w3f/Grants-Program/blob/master/applications/ink-analyzer-phase-2.md" target="_blank" rel="noopener noreferrer">this</a>) for <a href="https://github.com/ink-analyzer" target="_blank" rel="noopener noreferrer">ink! analyzer</a>
(a collection of modular and reusable libraries and tools for semantic analysis of <a href="https://use.ink/" target="_blank" rel="noopener noreferrer">ink!</a> smart contracts).</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/w3f/Grants-Program/edit/master/applications/pallet-verifier.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-overview-page_facing_up" class="table-of-contents__link toc-highlight">Project Overview ðŸ“„</a><ul><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#project-details" class="table-of-contents__link toc-highlight">Project Details</a></li><li><a href="#ecosystem-fit" class="table-of-contents__link toc-highlight">Ecosystem Fit</a></li></ul></li><li><a href="#team-busts_in_silhouette" class="table-of-contents__link toc-highlight">Team ðŸ‘¥</a><ul><li><a href="#team-members" class="table-of-contents__link toc-highlight">Team members</a></li><li><a href="#contact" class="table-of-contents__link toc-highlight">Contact</a></li><li><a href="#legal-structure" class="table-of-contents__link toc-highlight">Legal Structure</a></li><li><a href="#teams-experience" class="table-of-contents__link toc-highlight">Team&#39;s experience</a></li><li><a href="#team-code-repos" class="table-of-contents__link toc-highlight">Team Code Repos</a></li><li><a href="#team-linkedin-profiles-if-available" class="table-of-contents__link toc-highlight">Team LinkedIn Profiles (if available)</a></li></ul></li><li><a href="#development-status-open_book" class="table-of-contents__link toc-highlight">Development Status ðŸ“–</a></li><li><a href="#development-roadmap-nut_and_bolt" class="table-of-contents__link toc-highlight">Development Roadmap ðŸ”©</a><ul><li><a href="#overview-1" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#milestone-1--rustc-driver-cargo-subcommand-basic-mirai-integration-and-automatic-tractable-entry-point-generation" class="table-of-contents__link toc-highlight">Milestone 1 â€” rustc driver, cargo subcommand, basic MIRAI integration, and automatic tractable entry point generation</a></li><li><a href="#milestone-2--mir-annotation-capabilities-and-detecting-arithmetic-overflowunderflow-and-lossy-integer-conversions-due-to-as-conversions" class="table-of-contents__link toc-highlight">Milestone 2 â€” MIR annotation capabilities and detecting arithmetic overflow/underflow (and lossy integer conversions) due to <code>as</code> conversions</a></li></ul></li><li><a href="#future-plans" class="table-of-contents__link toc-highlight">Future Plans</a></li><li><a href="#referral-program-optional-moneybag" class="table-of-contents__link toc-highlight">Referral Program (optional) ðŸ’°</a></li><li><a href="#additional-information-heavy_plus_sign" class="table-of-contents__link toc-highlight">Additional Information âž•</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More Info</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/w3f/Grants-Program" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://web3.foundation/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Support Docs/privacy_policy">Privacy Policy</a></li><li class="footer__item"><a href="https://web3.foundation/legal-disclosures/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Legal Disclosures</a></li></ul></div><div class="col footer__col"><div class="footer__title">Connect</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/Web3foundation" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://matrix.to/#/!XpynPDLusWUWfDpaqr:matrix.org?via=web3.foundation&amp;via=matrix.org&amp;via=matrix.parity.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Grants Community Matrix Channel<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Â© 2025 Web3 Foundation</div></div></div></footer></div>
</body>
</html>