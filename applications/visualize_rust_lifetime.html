<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-applications/visualize_rust_lifetime" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Avoiding Rust Deadlocks via Visualizing Lifetime | Web3 Foundation Grants</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://grants.web3.foundation/applications/visualize_rust_lifetime"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Avoiding Rust Deadlocks via Visualizing Lifetime | Web3 Foundation Grants"><meta data-rh="true" name="description" content="- Team Name: Song&#x27;s research group at Pennsylvania State University"><meta data-rh="true" property="og:description" content="- Team Name: Song&#x27;s research group at Pennsylvania State University"><link data-rh="true" rel="icon" href="/img/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://grants.web3.foundation/applications/visualize_rust_lifetime"><link data-rh="true" rel="alternate" href="https://grants.web3.foundation/applications/visualize_rust_lifetime" hreflang="en"><link data-rh="true" rel="alternate" href="https://grants.web3.foundation/applications/visualize_rust_lifetime" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9VKKGZO0U1-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Web3 Foundation Grants" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.f3a7e75f.css">
<script src="/assets/js/runtime~main.acd63dc8.js" defer="defer"></script>
<script src="/assets/js/main.f737dd4d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#000;color:#ffffff" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><a target="_blank" rel="noopener noreferrer" href="https://medium.com/web3foundation/web3-foundation-ecodev-wave-26-7f145c39c2ef">Our blog post on Ecosystem Development Wave 26 is now online!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/w3f_logo.svg" alt="W3F Grants Program" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/w3f_logo.svg" alt="W3F Grants Program" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Grants Program</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/applications">List of Grants</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/docs/Process/how-to-apply">Apply</a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Avoiding Rust Deadlocks via Visualizing Lifetime</h1></header>
<ul>
<li><strong>Team Name:</strong> Song&#x27;s research group at Pennsylvania State University</li>
<li><strong>Payment Address:</strong> TBD</li>
<li><strong><a href="https://github.com/w3f/Grants-Program/tree/master#level_slider-levels" target="_blank" rel="noopener noreferrer">Level</a>:</strong> 3</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-overview-page_facing_up">Project Overview <!-- -->📄<a href="#project-overview-page_facing_up" class="hash-link" aria-label="Direct link to project-overview-page_facing_up" title="Direct link to project-overview-page_facing_up">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<p>Rust is a new programming language designed to provide both safety guarantees that are like high-level languages and performance guarantees that are like low-level languages. To achieve this design purpose, Rust leverages static compiler checks to rule out severe memory and thread safety issues at the compilation time. At runtime, Rust behaves like C/C++ and could deliver performance that is as good as C/C++. Due to its safety and performance benefits, Rust has seen increasing adoption in building low-level systems software, such as OSs and browsers. Rust is also used to implement many software systems in the Web3 technology stack (e.g., substrate, polkadot, ink!).</p>
<p>Rust&#x27;s compiler checks are based on a suite of ownership and lifetime rules. The basic rule allows one value to only have one owner variable, and the value is dropped (freed) when its owner variable ends its lifetime. Rust extends the basic rule to allow ownership to be moved and borrowed, while still guaranteeing all accesses to a value to be within its owner variable&#x27;s lifetime scope. Besides safety checks, lifetime is also used for automated resource management. For example, there is no explicit Unlock() in Rust. A Lock() function call returns a reference to the protected variable, and when the reference ends its lifetime, Rust automatically releases the acquired lock (by implicitly calling Unlock()).</p>
<p>Rust&#x27;s lifetime rules are complex and different from all other existing languages. It is challenging for Rust programmers to infer where a variable&#x27;s lifetime ends. As a result, it is not uncommon for programmers to incorrectly identify the location where an implicit unlock is called. When a lock is held longer than programmers&#x27; expectation, the same lock may be acquired again or a different lock may be acquired before releasing the acquired lock, leading to a double-lock error or a lock-in-conflicting-orders error.</p>
<p>In our previous work [1], we conducted an empirical study on real-world Rust concurrency bugs. We inspected GitHub commit logs for five Rust applications and five Rust libraries to collect previously fixed concurrency bugs. In total, we found 37 deadlocks due to the misunderstanding of where the implicit Unlock() is called, including 30 double locks and seven locks acquired in conflicting orders. These deadlocks constitute almost all lock-related concurrency bugs (37/38) in our collection. They are all from popular Rust software systems (e.g., Servo, Parity-Ethereum, TiKV, Redox) and have severely hurt the reliability of those systems before they were fixed.</p>
<p><ins>A brief description of the project.</ins>
We propose to build an IDE tool for visualizing the lifetime scope of a user-selected Rust variable. We believe our tool can help Rust programmers avoid deadlocks at the development stage. After writing a piece of code involving a mutex, a programmer can select the return value of a locking operation or the locking operation itself (when the return is not saved to a variable). Our tool will visualize the lifetime scope of the return value (i.e., the critical section). The programmer can then inspect whether the end of the critical section is expected. In addition, our tool will conduct deadlock detection for the selected critical section and provide detailed debugging information for identified bugs, such as highlighting blocking operations or function calls leading to blocking operations.</p>
<p><ins>How our tool will be integrated into Substrate/Polkadot?</ins>
Both Substrate and Polkadot are implemented in Rust. Previously, double locks or locks in conflicting orders were fixed in Substrate [2, 3]. After applying our prototype, we identified four previously unknown double locks in Substrate or the dependent libraries of Substrate/Polkadot. We reported detected bugs. All of them were confirmed and fixed by developers [4, 5, 6]. We believe our tool will effectively prevent Substrate/Polkadot programmers from making similar mistakes and other types of mistakes our tool will reveal.</p>
<p><ins>Why are we interested in creating this project?</ins>
We are interested in building the tool due to three reasons. First, our previous empirical study shows that deadlocks due to the misunderstanding of Rust&#x27;s lifetime rules are common in Rust programs. Visualizing lifetime can avoid these bugs during the development stage, benefiting the whole Rust community. Second, the misunderstanding of Rust&#x27;s lifetime rules can also cause memory bugs such as use-after-free and double free. Thus, the proposed tool has the potential to combat memory bugs. Third, the experience of building the proposed tool can inspire similar tools for other programming languages featuring lifetime (e.g., Kotlin).</p>
<p>[1] Boqin Qin, Yilun Chen, Zeming Yu, Linhai Song, and Yiying Zhang. “Understanding Memory and Thread Safety Practices and Issues in Real-World Rust Programs.” In PLDI&#x27;2020.</p>
<p>[2] <a href="https://github.com/paritytech/substrate/pull/197" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/substrate/pull/197</a></p>
<p>[3] <a href="https://github.com/paritytech/substrate/pull/6225/commits/61e3b8d53674687790d2b30bc450cd59e09f563d" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/substrate/pull/6225/commits/61e3b8d53674687790d2b30bc450cd59e09f563d</a></p>
<p>[4] <a href="https://github.com/paritytech/parity-db/pull/8" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/parity-db/pull/8</a></p>
<p>[5] <a href="https://github.com/paritytech/substrate/pull/6277" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/substrate/pull/6277</a></p>
<p>[6] <a href="https://github.com/paritytech/parity-common/pull/396" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/parity-common/pull/396</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="project-details">Project Details<a href="#project-details" class="hash-link" aria-label="Direct link to Project Details" title="Direct link to Project Details">​</a></h3>
<p><ins>What have we already done?</ins>
We have built a prototype of the proposed tool. Our prototype can visualize a selected variable and conduct double-lock detection. We published a demonstration paper at CCS&#x27;2020 to describe the prototype. The paper can be found here: <a href="https://songlh.github.io/paper/vr.pdf" target="_blank" rel="noopener noreferrer">https://songlh.github.io/paper/vr.pdf</a>. We also recorded a video to explain the prototype, and the video can be found here: <a href="https://youtu.be/L5F_XCOrJTQ" target="_blank" rel="noopener noreferrer">https://youtu.be/L5F_XCOrJTQ</a>.</p>
<p>We applied the double-lock detection component to Substrate, Polkadot, and ink!. We found four previously unknown deadlocks. One is in Substrate. The other three are in the dependent libraries of Substrate or Polkadot. We reported all the detected bugs. All of them were fixed by developers based on our reporting. The information of the detected bugs is listed as follows:</p>
<p>[PR-1] <a href="https://github.com/paritytech/parity-db/pull/8" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/parity-db/pull/8</a></p>
<p>[PR-2] <a href="https://github.com/paritytech/substrate/pull/6277" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/substrate/pull/6277</a></p>
<p>[PR-3] <a href="https://github.com/paritytech/parity-common/pull/396" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/parity-common/pull/396</a></p>
<p><ins>What are we going to do?</ins>
We propose to extend the prototype along four directions:</p>
<p>First, we will integrate our existing implementation of lifetime computation and deadlock detection to rust-analyzer, so that our proposed technique can easily cooperate with different text editors.</p>
<p>Second, we will detect more types of deadlock bugs. Specifically, we will add the detection of locks with conflicting orders and misuse of mutex and non-mutex synchronization primitives (e.g., channel, conditional variable).</p>
<p>Third, we will identify and visualize more blocking operations that can potentially lead to deadlocks in a selected critical section such as receiving from a channel and waiting on a conditional variable.</p>
<p>Fourth, we will implement the visualization functionality by parsing the analysis results generated by rust-analyzer in a text editor (i.e., VS Code) and document our tool.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ecosystem-fit">Ecosystem Fit<a href="#ecosystem-fit" class="hash-link" aria-label="Direct link to Ecosystem Fit" title="Direct link to Ecosystem Fit">​</a></h3>
<p>There is no existing project similar to ours.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="team-busts_in_silhouette">Team <!-- -->👥<a href="#team-busts_in_silhouette" class="hash-link" aria-label="Direct link to team-busts_in_silhouette" title="Direct link to team-busts_in_silhouette">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="team-members">Team members<a href="#team-members" class="hash-link" aria-label="Direct link to Team members" title="Direct link to Team members">​</a></h3>
<ul>
<li>Name of team leader: Linhai Song</li>
<li>Names of team members: Linhai Song, Yiying Zhang, Ziyi Zhang</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="contact">Contact<a href="#contact" class="hash-link" aria-label="Direct link to Contact" title="Direct link to Contact">​</a></h3>
<ul>
<li><strong>Contact Name:</strong> Linhai Song</li>
<li><strong>Contact Email:</strong> <a href="mailto:songlh@ist.psu.edu" target="_blank" rel="noopener noreferrer">songlh@ist.psu.edu</a></li>
<li><strong>Website:</strong> <a href="https://songlh.github.io/" target="_blank" rel="noopener noreferrer">https://songlh.github.io/</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="legal-structure">Legal Structure<a href="#legal-structure" class="hash-link" aria-label="Direct link to Legal Structure" title="Direct link to Legal Structure">​</a></h3>
<ul>
<li><strong>Registered Address:</strong> Information of our legal structure will be disclosed privately.</li>
<li><strong>Registered Legal Entity:</strong> Pennsylvania State University</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="teams-experience">Team&#x27;s experience<a href="#teams-experience" class="hash-link" aria-label="Direct link to Team&#x27;s experience" title="Direct link to Team&#x27;s experience">​</a></h3>
<p>The team conducted an empirical study on memory bugs and concurrency bugs in real-world Rust programs. The study was published in PLDI&#x27;2020. Through this project, the team has built a comprehensive understanding of common errors made by programmers when coding Rust.</p>
<p>The team built a prototype for the proposed tool. The prototype was published in the demonstration track of CCS&#x27;2020, demonstrating the team&#x27;s capability to build the proposed technique.</p>
<p>The team has another research paper on understanding concurrency bugs in Go published in ASPLOS&#x27;2019. The team has more than three years&#x27; research experience on concurrency bugs.</p>
<p>Team member Linhai Song has 10 years of expertise in programming analysis, and has published at top programming languages and software engineering conferences (e.g., PLDI, ICSE, FSE, OOPSLA).</p>
<p>Team member Yiying Zhang has conducted various systems research with papers published at OSDI and SOSP.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="team-code-repos">Team Code Repos<a href="#team-code-repos" class="hash-link" aria-label="Direct link to Team Code Repos" title="Direct link to Team Code Repos">​</a></h3>
<ul>
<li><a href="https://github.com/songlh/LDoctor" target="_blank" rel="noopener noreferrer">LDoctor (ICSE &#x27;17)</a></li>
<li><a href="https://github.com/system-pclub/rust-study" target="_blank" rel="noopener noreferrer">Rust-Study (PLDI &#x27;20)</a></li>
<li><a href="https://github.com/WukLab/LegoOS" target="_blank" rel="noopener noreferrer">LegoOS (OSDI &#x27;18)</a></li>
<li><a href="https://github.com/WukLab/pDPM" target="_blank" rel="noopener noreferrer">pDPM (ATC &#x27;20)</a></li>
<li><a href="https://github.com/WukLab/Pythia" target="_blank" rel="noopener noreferrer">Pythia (USENIX SEC &#x27;20)</a></li>
<li><a href="https://github.com/WukLab/LITE" target="_blank" rel="noopener noreferrer">LITE (SOSP &#x27;17)</a></li>
<li><a href="https://github.com/WukLab/Hotpot" target="_blank" rel="noopener noreferrer">Hotpot (SoCC &#x27;17)</a></li>
</ul>
<p>Please also provide the GitHub accounts of all team members. If they contain no activity, references to projects hosted elsewhere or live are also fine.</p>
<ul>
<li><a href="https://github.com/songlh" target="_blank" rel="noopener noreferrer">https://github.com/songlh</a></li>
<li><a href="https://github.com/system-pclub" target="_blank" rel="noopener noreferrer">https://github.com/system-pclub</a></li>
<li><a href="https://github.com/WukLab" target="_blank" rel="noopener noreferrer">https://github.com/WukLab</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="team-linkedin-profiles-if-available">Team LinkedIn Profiles (if available)<a href="#team-linkedin-profiles-if-available" class="hash-link" aria-label="Direct link to Team LinkedIn Profiles (if available)" title="Direct link to Team LinkedIn Profiles (if available)">​</a></h3>
<ul>
<li><a href="https://www.linkedin.com/in/linhai-song-7a3b12120/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/linhai-song-7a3b12120/</a></li>
<li><a href="https://www.linkedin.com/in/yiyingzhang/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/yiyingzhang/</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="development-status-open_book">Development Status <!-- -->📖<a href="#development-status-open_book" class="hash-link" aria-label="Direct link to development-status-open_book" title="Direct link to development-status-open_book">​</a></h2>
<p>We have built a prototype of the proposed tool. We wrote <a href="https://songlh.github.io/paper/vr.pdf" target="_blank" rel="noopener noreferrer">one paper</a> and recorded <a href="https://youtu.be/L5F_XCOrJTQ" target="_blank" rel="noopener noreferrer">one video</a> to describe the prototype.</p>
<p>We applied the bug detection component of the prototype to Substrate, Polkadot, and ink!. We found four previously unknown deadlocks. We reported all the detected bugs and all of them were fixed based on our reporting [PR-1, PR-2, PR-3].</p>
<p>[PR-1] <a href="https://github.com/paritytech/parity-db/pull/8" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/parity-db/pull/8</a></p>
<p>[PR-2] <a href="https://github.com/paritytech/substrate/pull/6277" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/substrate/pull/6277</a></p>
<p>[PR-3] <a href="https://github.com/paritytech/parity-common/pull/396" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/parity-common/pull/396</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="development-roadmap-nut_and_bolt">Development Roadmap <!-- -->🔩<a href="#development-roadmap-nut_and_bolt" class="hash-link" aria-label="Direct link to development-roadmap-nut_and_bolt" title="Direct link to development-roadmap-nut_and_bolt">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview-1">Overview<a href="#overview-1" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">  ​</a></h3>
<p>We will integrate the proposed tool into rust-analyzer and demonstrate the virtualization functionality in <a href="https://github.com/microsoft/vscode" target="_blank" rel="noopener noreferrer">VSCode</a>, which is an open-source IDE project. We will implement the proposed program analysis by analyzing Rust&#x27;s MIR.</p>
<p>We divide the project into three milestones. We aim to finish the whole project in three months and achieve a milestone in each month.</p>
<ul>
<li><strong>Total Estimated Duration:</strong> 3 months</li>
<li><strong>Full-Time Equivalent (FTE):</strong>  3</li>
<li><strong>Total Costs:</strong> financial information will be disclosed privately.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="milestone-1--implement-the-bug-detection-component">Milestone 1 — Implement the bug detection component<a href="#milestone-1--implement-the-bug-detection-component" class="hash-link" aria-label="Direct link to Milestone 1 — Implement the bug detection component" title="Direct link to Milestone 1 — Implement the bug detection component">​</a></h3>
<ul>
<li><strong>Estimated duration:</strong> 1 month</li>
<li><strong>FTE:</strong>  3</li>
<li><strong>Costs:</strong> financial information will be disclosed privately.</li>
</ul>
<table><thead><tr><th>Number</th><th>Deliverable</th><th>Specification</th></tr></thead><tbody><tr><td>0a.</td><td>License</td><td>BSD</td></tr><tr><td>0b.</td><td>Documentation</td><td>We will provide both inline documentation of the code and a basic tutorial that explains how to run the bug detection component as a standalone tool on terminal.</td></tr><tr><td>0c.</td><td>Testing Guide</td><td>We will include unit tests to ensure the functionality and robustness of our code. We will also include 10 toy programs containing different types of deadlocks to demonstrate the bug detection capability. We will also run this component on the latest version of Substrate, Polkadot, and ink!. We will manually inspect all reported results to count the number of bugs and the number of false positives.</td></tr><tr><td>1.</td><td>Detecting Conflicting Locks</td><td>We will implement a detector that can identify deadlocks due to locks in conflicting orders through analyzing the MIR of Rust programs.</td></tr><tr><td>2.</td><td>Detecting Misuse of Mutex and Channel</td><td>We will implement a detector to identify deadlocks due to errors when using a mutex together with a channel.</td></tr><tr><td>3.</td><td>Detecting Misuse of Mutex and Conditional Variable</td><td>We will implement a detector to identify deadlocks due to mistakes when using a mutex together with a conditional variable.</td></tr><tr><td>4.</td><td>Docker</td><td>We will provide a dockerfile to demonstrate the full functionality of this component.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="milestone-2--integrate-the-bug-detection-functionalities-into-rust-analyzer">Milestone 2 — Integrate the bug detection functionalities into rust-analyzer<a href="#milestone-2--integrate-the-bug-detection-functionalities-into-rust-analyzer" class="hash-link" aria-label="Direct link to Milestone 2 — Integrate the bug detection functionalities into rust-analyzer" title="Direct link to Milestone 2 — Integrate the bug detection functionalities into rust-analyzer">​</a></h3>
<ul>
<li><strong>Estimated Duration:</strong> 1 month</li>
<li><strong>FTE:</strong>  3</li>
<li><strong>Costs:</strong> financial information will be disclosed privately.</li>
</ul>
<table><thead><tr><th>Number</th><th>Deliverable</th><th>Specification</th></tr></thead><tbody><tr><td>0a.</td><td>License</td><td>BSD</td></tr><tr><td>0b.</td><td>Documentation</td><td>We will provide both inline documentation of the code and a basic tutorial that explains how to install and use the changed rust-analyzer.</td></tr><tr><td>0c.</td><td>Testing Guide</td><td>We will also use the 10 toy programs designed in the last milestone to test whether the bug detection capability is successfully integrated into rust-analyzer.</td></tr><tr><td>1.</td><td>Extend Language Server Protocol (LSP)</td><td>We will extend LSP to contain the key information related to deadlocks (e.g., the start and the end of a critical section, blocking operations in a critical section).</td></tr><tr><td>2.</td><td>Change rust-analyzer to emit MIR</td><td>We will change the build module of rust-analyzer to emit MIR for our bug detection functionalities.</td></tr><tr><td>3.</td><td>Conduct bug detection in rust-analyzer</td><td>We will change the analysis crate of rust-analyzer to execute the code for bug detection and change the server module to send the detection results out.</td></tr><tr><td>4.</td><td>Docker</td><td>We will provide a dockerfile to demonstrate the full functionality of this component.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="milestone-3--implement-the-visualization-component">Milestone 3 — Implement the visualization component<a href="#milestone-3--implement-the-visualization-component" class="hash-link" aria-label="Direct link to Milestone 3 — Implement the visualization component" title="Direct link to Milestone 3 — Implement the visualization component">​</a></h3>
<ul>
<li><strong>Estimated Duration:</strong> 1 month</li>
<li><strong>FTE:</strong>  3</li>
<li><strong>Costs:</strong> financial information will be disclosed privately.</li>
</ul>
<table><thead><tr><th>Number</th><th>Deliverable</th><th>Specification</th></tr></thead><tbody><tr><td>0a.</td><td>License</td><td>BSD</td></tr><tr><td>0b.</td><td>Documentation</td><td>We will provide both inline documentation of the code and a basic tutorial that explains how to install and use the visualization component in VSCode.</td></tr><tr><td>0c.</td><td>Testing Guide</td><td>We will include unit tests to ensure the functionality and robustness of our code. We will also include 10 toy programs to test whether channel operations are correctly identified, whether channel operations are correctly visualized, whether operations on conditional variables are correctly identified, and whether operations on conditional variables are correctly highlighted.</td></tr><tr><td>1.</td><td>Parse the Extended LSP</td><td>We will implement a component to parse the extended LSP and get computed information, such as the scope of a critical section and identified blocking operations.</td></tr><tr><td>2.</td><td>Highlight Blocking Operations</td><td>If a selected variable is the return of a locking operation, besides visualizing the critical section, we will also highlight identified channel operations, conditional variable operations, and locking operations in the selected critical section.</td></tr><tr><td>3.</td><td>Tutorial Writing</td><td>We will write a tutorial and record a video to explain how to use our tool.</td></tr><tr><td>4.</td><td>Docker</td><td>We will provide a dockerfile to demonstrate the full functionality of this component.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-plans">Future Plans<a href="#future-plans" class="hash-link" aria-label="Direct link to Future Plans" title="Direct link to Future Plans">​</a></h2>
<p>In the future, we plan to extend the proposed tool along two directions.</p>
<p>First, we plan to extend the proposed tool to cover memory bugs. Our previous empirical study showed that there are also memory bugs due to misunderstanding Rust&#x27;s lifetime rules, such as use-after-free bugs and double-free bugs. The proposed tool has the potential to help Rust programmers avoid these bugs. Of course, we need to explore what program elements should be visualized for memory bugs.</p>
<p>Second, we plan to conduct a survey to understand what challenges programmers face when understanding Rust&#x27;s lifetime rules and whether the proposed tool can really help them avoid deadlocks. The survey results will guide us on improving the proposed tool, and broadly speaking, the evolution of Rust.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-information-heavy_plus_sign">Additional Information <!-- -->➕<a href="#additional-information-heavy_plus_sign" class="hash-link" aria-label="Direct link to additional-information-heavy_plus_sign" title="Direct link to additional-information-heavy_plus_sign">​</a></h2>
<p><strong>How did you hear about the Grants Program?</strong> Web3 Foundation Website</p>
<p>Here you can also add any additional information that you think is relevant to this application but isn&#x27;t part of it already, such as:</p>
<ul>
<li>Work you have already done.</li>
</ul>
<p>We have built a prototype of the proposed tool. We wrote <a href="https://songlh.github.io/paper/vr.pdf" target="_blank" rel="noopener noreferrer">one paper</a> and recorded <a href="https://youtu.be/L5F_XCOrJTQ" target="_blank" rel="noopener noreferrer">one video</a> to describe the prototype.</p>
<p>We applied the bug detection component of the prototype to Substrate, Polkadot, and ink!. We found four previously unknown deadlocks. We reported all the detected bugs and all of them were fixed based on our reporting [PR-1, PR-2, PR-3].</p>
<p>[PR-1] <a href="https://github.com/paritytech/parity-db/pull/8" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/parity-db/pull/8</a></p>
<p>[PR-2] <a href="https://github.com/paritytech/substrate/pull/6277" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/substrate/pull/6277</a></p>
<p>[PR-3] <a href="https://github.com/paritytech/parity-common/pull/396" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/parity-common/pull/396</a></p>
<ul>
<li>Wheter there are any other teams who have already contributed (financially) to the project.</li>
</ul>
<p>No</p>
<ul>
<li>Previous grants you may have applied for.</li>
</ul>
<p>No</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/w3f/Grants-Program/edit/master/applications/visualize_rust_lifetime.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-overview-page_facing_up" class="table-of-contents__link toc-highlight">Project Overview 📄</a><ul><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#project-details" class="table-of-contents__link toc-highlight">Project Details</a></li><li><a href="#ecosystem-fit" class="table-of-contents__link toc-highlight">Ecosystem Fit</a></li></ul></li><li><a href="#team-busts_in_silhouette" class="table-of-contents__link toc-highlight">Team 👥</a><ul><li><a href="#team-members" class="table-of-contents__link toc-highlight">Team members</a></li><li><a href="#contact" class="table-of-contents__link toc-highlight">Contact</a></li><li><a href="#legal-structure" class="table-of-contents__link toc-highlight">Legal Structure</a></li><li><a href="#teams-experience" class="table-of-contents__link toc-highlight">Team&#39;s experience</a></li><li><a href="#team-code-repos" class="table-of-contents__link toc-highlight">Team Code Repos</a></li><li><a href="#team-linkedin-profiles-if-available" class="table-of-contents__link toc-highlight">Team LinkedIn Profiles (if available)</a></li></ul></li><li><a href="#development-status-open_book" class="table-of-contents__link toc-highlight">Development Status 📖</a></li><li><a href="#development-roadmap-nut_and_bolt" class="table-of-contents__link toc-highlight">Development Roadmap 🔩</a><ul><li><a href="#overview-1" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#milestone-1--implement-the-bug-detection-component" class="table-of-contents__link toc-highlight">Milestone 1 — Implement the bug detection component</a></li><li><a href="#milestone-2--integrate-the-bug-detection-functionalities-into-rust-analyzer" class="table-of-contents__link toc-highlight">Milestone 2 — Integrate the bug detection functionalities into rust-analyzer</a></li><li><a href="#milestone-3--implement-the-visualization-component" class="table-of-contents__link toc-highlight">Milestone 3 — Implement the visualization component</a></li></ul></li><li><a href="#future-plans" class="table-of-contents__link toc-highlight">Future Plans</a></li><li><a href="#additional-information-heavy_plus_sign" class="table-of-contents__link toc-highlight">Additional Information ➕</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More Info</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/w3f/Grants-Program" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://web3.foundation/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Support Docs/privacy_policy">Privacy Policy</a></li><li class="footer__item"><a href="https://web3.foundation/legal-disclosures/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Legal Disclosures</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Connect</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/Web3foundation" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://matrix.to/#/!XpynPDLusWUWfDpaqr:matrix.org?via=web3.foundation&amp;via=matrix.org&amp;via=matrix.parity.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Grants Community Matrix Channel<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2025 Web3 Foundation</div></div></div></footer></div>
</body>
</html>