<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-applications/Standard_Protocol">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Standard Protocol | Web3 Foundation Grants</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://w3f.github.io/Grants-Program/applications/Standard_Protocol"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Standard Protocol | Web3 Foundation Grants"><meta data-rh="true" name="description" content="Project Overview"><meta data-rh="true" property="og:description" content="Project Overview"><link data-rh="true" rel="icon" href="/Grants-Program/img/Web3Foundation.png"><link data-rh="true" rel="canonical" href="https://w3f.github.io/Grants-Program/applications/Standard_Protocol"><link data-rh="true" rel="alternate" href="https://w3f.github.io/Grants-Program/applications/Standard_Protocol" hreflang="en"><link data-rh="true" rel="alternate" href="https://w3f.github.io/Grants-Program/applications/Standard_Protocol" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9VKKGZO0U1-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Web3 Foundation Grants" href="/Grants-Program/opensearch.xml"><link rel="stylesheet" href="/Grants-Program/assets/css/styles.acae8325.css">
<link rel="preload" href="/Grants-Program/assets/js/runtime~main.dded6a13.js" as="script">
<link rel="preload" href="/Grants-Program/assets/js/main.91520eab.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#000;color:#ffffff" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Check out <a target="_blank" rel="noopener noreferrer" href="https://web3.bamboohr.com/jobs/">our current job openings</a>!</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Grants-Program/"><div class="navbar__logo"><img src="/Grants-Program/img/Web3Foundation.png" alt="W3F Grants Program" class="themedImage_ToTc themedImage--light_HNdA"><img src="/Grants-Program/img/Web3Foundation.png" alt="W3F Grants Program" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">W3F Grants Program</b></a><a class="navbar__item navbar__link" href="/Grants-Program/docs/introduction">Introduction</a><a class="navbar__item navbar__link" href="/Grants-Program/applications">List of Grants</a><a class="navbar__item navbar__link" href="/Grants-Program/docs/faq">FAQ</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/Grants-Program/docs/Process/how-to-apply">Apply</a><a class="navbar__item navbar__link" href="/Grants-Program/docs/contribute">Contribute</a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Standard Protocol</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-overview-">Project Overview ðŸ“„<a href="#project-overview-" class="hash-link" aria-label="Direct link to Project Overview ðŸ“„" title="Direct link to Project Overview ðŸ“„">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">â€‹</a></h3><p>Standard Protocol is a collaterized algorithmic stablecoin protocol for synthetic assets.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="problems-of-current-algorithmic-stablecoins">Problems of current algorithmic stablecoins<a href="#problems-of-current-algorithmic-stablecoins" class="hash-link" aria-label="Direct link to Problems of current algorithmic stablecoins" title="Direct link to Problems of current algorithmic stablecoins">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-too-much-focus-on-price-stability-no-sustainable-use-case-for-interoperability">1. Too much focus on price stability, no sustainable use case for interoperability<a href="#1-too-much-focus-on-price-stability-no-sustainable-use-case-for-interoperability" class="hash-link" aria-label="Direct link to 1. Too much focus on price stability, no sustainable use case for interoperability" title="Direct link to 1. Too much focus on price stability, no sustainable use case for interoperability">â€‹</a></h4><p>Current algorithmic stablecoins focus only on automated price stability. Although they provide some interoperability between tokens with initial distribution in yield farming, but currently there is no sustainable way for them to interoperate with financial activities without the reward. Also, other algorithmic stablecoins which uses incentives in cases regarding circulating supply(e.g. contractionary, expansionary cases) are not showing sustainability to preserve 1 dollar peg.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-oracles-are-centralized-and-there-is-no-decentralized-ecosystem-to-reward-them">2. Oracles are centralized, and there is no decentralized ecosystem to reward them<a href="#2-oracles-are-centralized-and-there-is-no-decentralized-ecosystem-to-reward-them" class="hash-link" aria-label="Direct link to 2. Oracles are centralized, and there is no decentralized ecosystem to reward them" title="Direct link to 2. Oracles are centralized, and there is no decentralized ecosystem to reward them">â€‹</a></h4><p>One can be dependant to dexes, but they are prone to flash loans, making arbitrage data compared to centralized exchange. In order to provide aggregated and balanced data, oracle providers must be rewarded.  </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-auctions-are-hard-to-track-and-centralized">3. Auctions are hard to track and centralized<a href="#3-auctions-are-hard-to-track-and-centralized" class="hash-link" aria-label="Direct link to 3. Auctions are hard to track and centralized" title="Direct link to 3. Auctions are hard to track and centralized">â€‹</a></h4><p>Auctions after liquidation are hard to track and participate, leaving only hardcore traders to take advantage of arbitrage. More decentralized way to provide liquidation must be considered. Auction orders come in high volume of collateral, and this can lead to plutocracy.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solutions">Solutions<a href="#solutions" class="hash-link" aria-label="Direct link to Solutions" title="Direct link to Solutions">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-elastic-supply">1. Elastic supply<a href="#1-elastic-supply" class="hash-link" aria-label="Direct link to 1. Elastic supply" title="Direct link to 1. Elastic supply">â€‹</a></h4><p>As Amplforth(AMPL) used elastic supply to rebase its total supply of stablecoin, Standard rebases its stablecoin supply in each era, and it uses overcollaterization to mint its stablecoin, meter(MTR).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-decentralized-oracles">2. Decentralized oracles<a href="#2-decentralized-oracles" class="hash-link" aria-label="Direct link to 2. Decentralized oracles" title="Direct link to 2. Decentralized oracles">â€‹</a></h4><p>Oracle client from various sources  (e.g. binance, coinbase, hydra dx, etc) can provide aggregated price information so that the price cannot be manipulated from one source.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-democratization-of-auction-via-automated-market-maker">3. Democratization of auction via automated market maker<a href="#3-democratization-of-auction-via-automated-market-maker" class="hash-link" aria-label="Direct link to 3. Democratization of auction via automated market maker" title="Direct link to 3. Democratization of auction via automated market maker">â€‹</a></h4><p>Instead of hosting an auction for liquidating collaterals, Standard protocol deposits liquidated collateral to its amm pair so that meter(MTR) holders can purchase other digital assets from liquidation.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="documentation">Documentation<a href="#documentation" class="hash-link" aria-label="Direct link to Documentation" title="Direct link to Documentation">â€‹</a></h3><p><a href="https://docs.standardprotocol.org" target="_blank" rel="noopener noreferrer">https://docs.standardprotocol.org</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="core-runtime-modules">Core Runtime Modules<a href="#core-runtime-modules" class="hash-link" aria-label="Direct link to Core Runtime Modules" title="Direct link to Core Runtime Modules">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="token-regisrty-token">token regisrty <code>/token</code><a href="#token-regisrty-token" class="hash-link" aria-label="Direct link to token-regisrty-token" title="Direct link to token-regisrty-token">â€‹</a></h4><p>Token manages asset that flows in and out with xcmp in polkadot ecosystem. assets are managed with unique identifier.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="oracle-reward-module-oracle">oracle reward module <code>/oracle</code><a href="#oracle-reward-module-oracle" class="hash-link" aria-label="Direct link to oracle-reward-module-oracle" title="Direct link to oracle-reward-module-oracle">â€‹</a></h4><p>Oracles in standard protocol are rewarded in each era on each block reward.
prices are stored in the state, and oracle providers are updated in each era.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="market-module-market">market module <code>/market</code><a href="#market-module-market" class="hash-link" aria-label="Direct link to market-module-market" title="Direct link to market-module-market">â€‹</a></h4><p>Market module in standard protocol manages pair for automated market maker(AMM) between collateral and its stablecoin meter(MTR).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="vault-module-vault">vault module <code>/vault</code><a href="#vault-module-vault" class="hash-link" aria-label="Direct link to vault-module-vault" title="Direct link to vault-module-vault">â€‹</a></h4><p>Vault module in standard protocol is a collateral debt position engine where</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ecosystem-fit">Ecosystem Fit<a href="#ecosystem-fit" class="hash-link" aria-label="Direct link to Ecosystem Fit" title="Direct link to Ecosystem Fit">â€‹</a></h3><p>Standard protocol will act as the catalyst for other parachain&#x27;s financial activities for enabling leverage trading and Arbitrage in AMM created from liquidation. It will also open a protocol for synthetic asset market with decentralized oracle ecosystem.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="team-">Team ðŸ‘¥<a href="#team-" class="hash-link" aria-label="Direct link to Team ðŸ‘¥" title="Direct link to Team ðŸ‘¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="team-members">Team members<a href="#team-members" class="hash-link" aria-label="Direct link to Team members" title="Direct link to Team members">â€‹</a></h3><p>Hyungsuk Kang, team leader</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="legal-structure">Legal Structure<a href="#legal-structure" class="hash-link" aria-label="Direct link to Legal Structure" title="Direct link to Legal Structure">â€‹</a></h3><p>Standard protocol is being made with Apache 2.0 license. Legal entity is being built in Singapore right now.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="teams-experience">Team&#x27;s experience<a href="#teams-experience" class="hash-link" aria-label="Direct link to Team&#x27;s experience" title="Direct link to Team&#x27;s experience">â€‹</a></h3><p>Hyungsuk is Plasm network&#x27;s core developer. He developed Subswap, AMM in substrate, and he wants to extend it to make the next finance in Polkadot ecosytem using XCM module and collateral debt position. He is also kernel and tendermint fellow.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="team-code-repos">Team Code Repos<a href="#team-code-repos" class="hash-link" aria-label="Direct link to Team Code Repos" title="Direct link to Team Code Repos">â€‹</a></h3><ul><li><a href="https://github.com/digitalnativeinc/standard-substrate" target="_blank" rel="noopener noreferrer">https://github.com/digitalnativeinc/standard-substrate</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="team-linkedin-profiles">Team LinkedIn Profiles<a href="#team-linkedin-profiles" class="hash-link" aria-label="Direct link to Team LinkedIn Profiles" title="Direct link to Team LinkedIn Profiles">â€‹</a></h3><ul><li><a href="https://www.linkedin.com/in/hyungsukkang" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/hyungsukkang</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="development-roadmap-">Development Roadmap ðŸ”©<a href="#development-roadmap-" class="hash-link" aria-label="Direct link to Development Roadmap ðŸ”©" title="Direct link to Development Roadmap ðŸ”©">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview-1">Overview<a href="#overview-1" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">â€‹</a></h3><p>As a synthetic asset protocol,Standard protocol heavily depends on the oracle for maintaining the system. Oracles should be formed in a sustainable way to be motivated for people to provide computing power.
To reward the network participant, Standard protocol proposes new PoS reward system by splitting block rewards from block validators to oracle providers.</p><ul><li><strong>Total Estimated Duration:</strong> 2 months</li><li><strong>Full-time equivalent (FTE):</strong>  1</li><li><strong>Total Costs:</strong> 1000DAI</li><li><strong>Payment Address:</strong> <code>0xd2234E506862991ADA75f930c6D79B4236e3E265</code></li><li><strong>Status:</strong> <a href="https://github.com/w3f/Grants-Program/pull/244#issuecomment-1014764739" target="_blank" rel="noopener noreferrer">Terminated</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="milestone-1---middleware-for-data-submission-and-runtime-integration">Milestone 1 - Middleware for data submission and runtime integration<a href="#milestone-1---middleware-for-data-submission-and-runtime-integration" class="hash-link" aria-label="Direct link to Milestone 1 - Middleware for data submission and runtime integration" title="Direct link to Milestone 1 - Middleware for data submission and runtime integration">â€‹</a></h3><ul><li><strong>Estimated Duration:</strong> 1 month</li><li><strong>FTE:</strong>  1</li><li><strong>Costs:</strong> 500DAI</li></ul><p>This milestone focuses on building a oracle provider client middleware which submits off-chain data to the blockchain. An authoritive module for testing connection between oracle provider and the protocol is provided in this phase. Then, Standard will extend the oracle module to distribute reward from session callback connected between <code>pallet_session</code> and <code>pallet_staking</code>. When oracle provider submits outliers or does not submit values that are out of sync from other oracle providers, a slash can be applied from anyone to report. Outliers are detected with <a href="https://online.stat.psu.edu/stat200/lesson/3/3.2" target="_blank" rel="noopener noreferrer">IQR method</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="oracle-provider-client">Oracle provider client<a href="#oracle-provider-client" class="hash-link" aria-label="Direct link to Oracle provider client" title="Direct link to Oracle provider client">â€‹</a></h3><p>As chainlink and other oracle solution has a middleware or submitting client from off-chain, Standard also has its oracle client. Oracle provider client is actually a bot that uses <a href="https://github.com/scs/substrate-api-client/blob/master/tutorials/api-client-tutorial/src/main.rs" target="_blank" rel="noopener noreferrer">polkadot-js api</a> to submit information in oracle module in a certain periods(e.g. 2 hour, 4 hour). For example, to send an oracle xt from an oracle client,</p><div class="language-javascript= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Loads config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import LumenConfig from &quot;@digitalnative/lumen-config&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Fetch functions for acquiring off-chain data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import fetchData from &quot;@digitalnative/lumen-fetch&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Submit function for submitting data to on-chain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import submitData from &quot;@digitalnative/lumen-submit&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Async Apis for polkadot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { ApiPromise, WsProvider } from &quot;@polkadot/api&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const runClient = async (dir) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const cron = require(&quot;node-cron&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const config = LumenConfig.default({ dir });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const { events } = config;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  events.emit(&quot;client:start&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const api = await polkadotApi(config);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // register cron job to execute in every minute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cron.schedule(&quot;*/90 * * * * *&quot;, async function() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    events.emit(&quot;client:next&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // fetch data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const data = await fetchData(false, config);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Submit data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    await submitData(data, config, api);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Declare cron job has been set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  events.emit(&quot;client:init&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export default runClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">async function polkadotApi(config: LumenConfig) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const provider = new WsProvider(config.rpc);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const definitions = require(&quot;@digitalnative/type-definitions/opportunity&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let types = definitions.types[0].types;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const api = await new ApiPromise({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    provider,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  await api.isReady;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return api;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is the overall workflow for the client operation, and add-ons and options are expected to be added in each function in the library.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="unit-tests">Unit tests<a href="#unit-tests" class="hash-link" aria-label="Direct link to Unit tests" title="Direct link to Unit tests">â€‹</a></h2><p>Standard protocol applies test driven development(TDD) on building runtime modules for the grant.
Here are unit tests that will be done along the development in the runtime module.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="oracle">Oracle<a href="#oracle" class="hash-link" aria-label="Direct link to Oracle" title="Direct link to Oracle">â€‹</a></h2><p>oracle in milestone 1 should achieve:</p><ul><li>Only Root account can register oracle providers for slots to submit off-chain data</li><li>If slots are not open for an entity in the storage, a new oracle provider initializes the slot with the oracle provider count.</li><li>When the provider is designated for a slot, it can only submit data for a designated slot</li><li>If one reports slashing for the slot, runtime validates the slot data with iqr rule and remove provider and set the value as zero if the value violates it.</li><li>zero values are excluded and the median is calculated in both even and odd cases</li></ul><p>To check this, oracle provider module should have these test functions:</p><ul><li><code>add_oracle_provider_works</code>: Oracle should be added by the root account for now until the module includes session callback between <code>pallet-staking</code> and <code>pallet-session</code> as a impl of <code>SessionManager</code>.  </li><li><code>oracle_report_works</code>: Oracle provider should only be able to submit data only in designated slot, and create new batch if the price data has not been reported yet.</li><li><code>oracle_slash_works</code>: when one reports slashing for oracle provider in a slot, the runtime should run iqr rule to find out whether the slot value violates the rule from the collected oracle data batch.</li><li><code>oracle_excludes_zeros_and_return_median</code>: Oracle runtime should exclude zero-values since it means the data is empty or not available due to violation. median should be returned from the remainder of filtered batch.</li><li><code>oracle_excludes_zeros_and_return_median_even</code>: the purpose is also same with the previous test function, but the batch length is even.</li></ul><table><thead><tr><th>Number</th><th>Deliverable</th><th>Specification</th></tr></thead><tbody><tr><td>0a.</td><td>License</td><td>Apache 2.0</td></tr><tr><td>0b.</td><td>Documentation</td><td>Documentation will introduce how to install the oracle and participate to get block reward</td></tr><tr><td>1.</td><td>Oracle client</td><td>Oracle client to receive information from external sources then submit information regularly to substrate runtime</td></tr><tr><td>2.</td><td>Modified Oracle module</td><td>Oracle module to register operators and batch</td></tr><tr><td>3.</td><td>Unit test codes</td><td>Unit test codes in <code>tests.rs</code> in each runtime module</td></tr><tr><td>4.</td><td>Npm binary</td><td>We will provide a npm binary for oracle providers to install and run an oracle client</td></tr><tr><td>5.</td><td>Dockerfile</td><td>Dockerfile for running Standard protocol binary will be provided</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="milestone-2---pos-oracle-reward-distribution">Milestone 2 - PoS oracle reward distribution<a href="#milestone-2---pos-oracle-reward-distribution" class="hash-link" aria-label="Direct link to Milestone 2 - PoS oracle reward distribution" title="Direct link to Milestone 2 - PoS oracle reward distribution">â€‹</a></h3><ul><li><strong>Estimated Duration:</strong> 1 month</li><li><strong>FTE:</strong>  1</li><li><strong>Costs:</strong> 500DAI</li></ul><p>This milestone focuses on including session callbacks related to sessions in implementations of <code>SessionManager</code> trait in <code>pallet-staking</code> module, and all related module will be tested with its separate implementation of <code>SessionManager</code> connected to <code>pallet-session</code> in a mock environment.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="vault">Vault<a href="#vault" class="hash-link" aria-label="Direct link to Vault" title="Direct link to Vault">â€‹</a></h2><p>Vault in milestone 2 should have a trait for dependency Injection:</p><div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub trait RebaseCallback {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn rebase(); // where it initiates rebase in the session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The dependency injection will take place in the <code>pallet-staking</code>&#x27;s config as well as the oracle</p><div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">impl pallet_custom_staking::Config for Runtime{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type Rebase = RebaseCallback; // for vault rebase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type Oracle = OracleCallback; // for oracle callback used as same as staking callbacks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where the it will be included in <code>pallet-staking</code> module&#x27;s <code>SessionManager</code> trait implementation in <code>end_session</code> function like:</p><div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// In this implementation `new_session(session)` must be called before `end_session(session-1)`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// i.e. the new session must be planned before the ending of the previous session.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">///</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Once the first new_session is planned, all session must start and then end in order, though</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// some session can lag in between the newest session planned and the latest session started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl&lt;T: Config&gt; pallet_session::SessionManager&lt;T::AccountId&gt; for Module&lt;T&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> fn new_session(new_index: SessionIndex) -&gt; Option&lt;Vec&lt;T::AccountId&gt;&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  frame_support::debug::native::trace!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   target: LOG_TARGET,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;[{}] planning new_session({})&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;frame_system::Module&lt;T&gt;&gt;::block_number(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   new_index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Self::new_session(new_index)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> fn start_session(start_index: SessionIndex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  frame_support::debug::native::trace!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   target: LOG_TARGET,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;[{}] starting start_session({})&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;frame_system::Module&lt;T&gt;&gt;::block_number(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   start_index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Self::start_session(start_index)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> fn end_session(end_index: SessionIndex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  frame_support::debug::native::trace!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   target: LOG_TARGET,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;[{}] ending end_session({}) with rebase&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;frame_system::Module&lt;T&gt;&gt;::block_number(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   end_index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                T::Rebase::rebase();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Self::end_session(end_index)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>vault in milestone 2 should achieve:</p><ul><li>In each era, vault module should bring registered stablecoin price from oracle module with its asset id (1) and rebase its total supply to <code>(circulating supply) / (oracle price)</code> in order to satisfy the ratio <code>(circulating supply) : (oracle price) = (total supply) : (1.0(USD) in decimal configured in the substrate chain)</code>.</li><li>Vault module should burn or mint stablecoin&#x27;s module account&#x27;s balance according to rebased balance</li><li>Alert community when total supply cannot be decreased anymore to keep the ratio(in case where decreased total supply exceeds circulating supply) in order to propose emergency shutdown or take further actions(e.g. issuing bonds, using community vault from stability fee to stabilize the ratio)</li></ul><p>To check this, vault module should have these test functions:</p><ul><li><code>supply_is_rebased_in_each_era</code>: Using an oracle module, set an oracle price and start an era so that the vault module can executes rebase mechanism. The total supply of the stablecoin is checked whether it changed to the right amount.</li><li><code>report_emergency</code>: check whether vault module reports when the rebased next total supply is less than the circulating supply.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="oracle-1">Oracle<a href="#oracle-1" class="hash-link" aria-label="Direct link to Oracle" title="Direct link to Oracle">â€‹</a></h2><p>oracle will replicate the <code>pallet-staking</code> module regarding election of the oracle provider and the reward logic. However, there will be difference in how the elected provider(or validator) is allocated to the slot. The module only accepts the stash account to submit oracle data once <code>validate()</code> tx has been finalized.</p><p>For example, there will be addition in the <code>select_and_update_validators</code> function code</p><div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// Select the new validator set at the end of the era.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ///</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// Runs [`try_do_phragmen`] and updates the following storage items:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// - [`EraElectionStatus`]: with `None`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// - [`ErasStakers`]: with the new staker set.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// - [`ErasStakersClipped`].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// - [`ErasValidatorPrefs`].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// - [`ErasTotalStake`]: with the new total stake.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// - [`SnapshotValidators`] and [`SnapshotNominators`] are both removed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ///</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// Internally, [`QueuedElected`], snapshots and [`QueuedScore`] are also consumed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ///</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// If the election has been successful, It passes the new set upwards.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ///</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// This should only be called at the end of an era.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> fn select_and_update_validators(current_era: EraIndex) -&gt; Option&lt;Vec&lt;T::AccountId&gt;&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if let Some(ElectionResult::&lt;T::AccountId, BalanceOf&lt;T&gt;&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   elected_stashes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   exposures,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   compute,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }) = Self::try_do_election() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   // Totally close the election round and data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Self::close_election_window();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   // Populate Stakers and write slot stake.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   let mut total_stake: BalanceOf&lt;T&gt; = Zero::zero();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   exposures.into_iter().for_each(|(stash, exposure)| {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total_stake = total_stake.saturating_add(exposure.total);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;ErasStakers&lt;T&gt;&gt;::insert(current_era, &amp;stash, &amp;exposure);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let mut exposure_clipped = exposure;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let clipped_max_len = T::MaxNominatorRewardedPerValidator::get() as usize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if exposure_clipped.others.len() &gt; clipped_max_len {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     exposure_clipped.others.sort_by(|a, b| a.value.cmp(&amp;b.value).reverse());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     exposure_clipped.others.truncate(clipped_max_len);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;ErasStakersClipped&lt;T&gt;&gt;::insert(&amp;current_era, &amp;stash, exposure_clipped);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   // Insert current era staking information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;ErasTotalStake&lt;T&gt;&gt;::insert(&amp;current_era, total_stake);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   // collect the pref of all winners</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   for (i, stash) in elected_stashes.iter().enumerate() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;Slots&lt;T&gt;&gt;::insert(i, stash.clone()); // allocating slots for elected oracle provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let pref = Self::validators(stash);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;ErasValidatorPrefs&lt;T&gt;&gt;::insert(&amp;current_era, stash, pref);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   // emit event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Self::deposit_event(RawEvent::StakingElection(compute));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   log!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    info,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ðŸ’¸ new validator set of size {:?} has been elected via {:?} for era {:?}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    elected_stashes.len(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compute,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    current_era,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Some(elected_stashes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, slash module function should include verifier from milestone 1.</p><div class="language-rust= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// Slash the validator for a given amount of balance. This can grow the value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// of the slash in the case that the validator has less than `minimum_balance`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// active funds. Returns the amount of funds actually slashed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ///</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// Slashes from `active` funds first, and then `unlocking`, starting with the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /// chunks that are closest to unlocking.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> fn slash(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &amp;mut self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mut value: Balance,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  minimum_balance: Balance,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        slot: SlotIndex,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ) -&gt; Balance {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let batch = Prices::get(_id).unwrap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let value = batch[_slot as usize];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let det = Self::determine_outlier(batch, value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ensure!(det, Error::&lt;T&gt;::NotOutlier);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let pre_total = self.total;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let total = &amp;mut self.total;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let active = &amp;mut self.active;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let slash_out_of = |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   total_remaining: &amp;mut Balance,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   target: &amp;mut Balance,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   value: &amp;mut Balance,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   let mut slash_from_target = (*value).min(*target);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   if !slash_from_target.is_zero() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    *target -= slash_from_target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // don&#x27;t leave a dust balance in the staking system.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if *target &lt;= minimum_balance {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     slash_from_target += *target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *value += sp_std::mem::replace(target, Zero::zero());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    *total_remaining = total_remaining.saturating_sub(slash_from_target);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    *value -= slash_from_target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  slash_out_of(total, active, &amp;mut value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let i = self.unlocking.iter_mut()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .map(|chunk| {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    slash_out_of(total, &amp;mut chunk.value, &amp;mut value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    chunk.value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .take_while(|value| value.is_zero()) // take all fully-consumed chunks out.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .count();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // kill all drained chunks.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let _ = self.unlocking.drain(..i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pre_total.saturating_sub(*total)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>Unit test</h1><p>Unit tests are all identical with the staking module&#x27;s test in that all logics are identical regarding slash, reward and validation.</p><table><thead><tr><th>Number</th><th>Deliverable</th><th>Specification</th></tr></thead><tbody><tr><td>0a.</td><td>License</td><td>Apache 2.0</td></tr><tr><td>0c.</td><td>Documentation</td><td>Documentation will introduce how to nominate</td></tr><tr><td>1.</td><td>Vault module</td><td>Vault module will declare dependancy injection trait to use session callback in <code>pallet-staking</code> module and the test code with separate <code>SessionManager</code> implementation will be provided</td></tr><tr><td>2.</td><td>Modified Staking module</td><td><code>pallet_staking</code> module which has two config trait for rebase callback and oracle staking callback will be provided</td></tr><tr><td>3.</td><td>Oracle module</td><td>same as staking module including curve integration but difference in slot allocation and separate slashing verifier will be included</td></tr><tr><td>4.</td><td>Unit test code</td><td>Unit test codes in <code>tests.rs</code> in each runtime module with separate <code>SessionManager</code> implementation</td></tr><tr><td>5.</td><td>Docker</td><td>We will provide a dockerfile to demonstrate the full functionality of Standard protocol chain</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-plans">Future Plans<a href="#future-plans" class="hash-link" aria-label="Direct link to Future Plans" title="Direct link to Future Plans">â€‹</a></h2><ul><li>Add more prices to add from the oracle (e.g. stock prices, commodities, etc) provider</li></ul><ul><li>Full function test on Kusama/Rococo.</li><li>Full function test on Polkadot.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-information-">Additional Information âž•<a href="#additional-information-" class="hash-link" aria-label="Direct link to Additional Information âž•" title="Direct link to Additional Information âž•">â€‹</a></h2><ul><li>Pitch: <a href="https://whitepaper.standardprotocol.org" target="_blank" rel="noopener noreferrer">https://whitepaper.standardprotocol.org</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/w3f/Grants-Program/edit/master/applications/Standard_Protocol.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-overview-" class="table-of-contents__link toc-highlight">Project Overview ðŸ“„</a><ul><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#problems-of-current-algorithmic-stablecoins" class="table-of-contents__link toc-highlight">Problems of current algorithmic stablecoins</a></li><li><a href="#solutions" class="table-of-contents__link toc-highlight">Solutions</a></li><li><a href="#documentation" class="table-of-contents__link toc-highlight">Documentation</a></li><li><a href="#core-runtime-modules" class="table-of-contents__link toc-highlight">Core Runtime Modules</a></li><li><a href="#ecosystem-fit" class="table-of-contents__link toc-highlight">Ecosystem Fit</a></li></ul></li><li><a href="#team-" class="table-of-contents__link toc-highlight">Team ðŸ‘¥</a><ul><li><a href="#team-members" class="table-of-contents__link toc-highlight">Team members</a></li><li><a href="#legal-structure" class="table-of-contents__link toc-highlight">Legal Structure</a></li><li><a href="#teams-experience" class="table-of-contents__link toc-highlight">Team&#39;s experience</a></li><li><a href="#team-code-repos" class="table-of-contents__link toc-highlight">Team Code Repos</a></li><li><a href="#team-linkedin-profiles" class="table-of-contents__link toc-highlight">Team LinkedIn Profiles</a></li></ul></li><li><a href="#development-roadmap-" class="table-of-contents__link toc-highlight">Development Roadmap ðŸ”©</a><ul><li><a href="#overview-1" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#milestone-1---middleware-for-data-submission-and-runtime-integration" class="table-of-contents__link toc-highlight">Milestone 1 - Middleware for data submission and runtime integration</a></li><li><a href="#oracle-provider-client" class="table-of-contents__link toc-highlight">Oracle provider client</a></li></ul></li><li><a href="#unit-tests" class="table-of-contents__link toc-highlight">Unit tests</a></li><li><a href="#oracle" class="table-of-contents__link toc-highlight">Oracle</a><ul><li><a href="#milestone-2---pos-oracle-reward-distribution" class="table-of-contents__link toc-highlight">Milestone 2 - PoS oracle reward distribution</a></li></ul></li><li><a href="#vault" class="table-of-contents__link toc-highlight">Vault</a></li><li><a href="#oracle-1" class="table-of-contents__link toc-highlight">Oracle</a></li><li><a href="#future-plans" class="table-of-contents__link toc-highlight">Future Plans</a></li><li><a href="#additional-information-" class="table-of-contents__link toc-highlight">Additional Information âž•</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More Info</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/w3f/Grants-Program" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://web3.foundation/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/Grants-Program/docs/Support Docs/privacy_policy">Privacy Policy</a></li></ul></div><div class="col footer__col"><div class="footer__title">Connect</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/Web3foundation" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://matrix.to/#/!XpynPDLusWUWfDpaqr:matrix.org?via=web3.foundation&amp;via=matrix.org&amp;via=matrix.parity.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Grants Community Matrix Channel<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Â© 2023 Web3 Foundation</div></div></div></footer></div>
<script src="/Grants-Program/assets/js/runtime~main.dded6a13.js"></script>
<script src="/Grants-Program/assets/js/main.91520eab.js"></script>
</body>
</html>