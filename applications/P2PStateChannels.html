<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-applications/P2PStateChannels" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">P2P State Channels | Web3 Foundation Grants</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://grants.web3.foundation/applications/P2PStateChannels"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="P2P State Channels | Web3 Foundation Grants"><meta data-rh="true" name="description" content="This document will be part of the terms and conditions of your agreement and, therefore, needs to contain all the required information about the project. Don&#x27;t remove any of the mandatory parts presented in bold letters or as headlines (except for the title)! Lines starting with a &gt; (such as this one) should be removed. Please use markdown instead of HTML (e.g., ` instead of `)."><meta data-rh="true" property="og:description" content="This document will be part of the terms and conditions of your agreement and, therefore, needs to contain all the required information about the project. Don&#x27;t remove any of the mandatory parts presented in bold letters or as headlines (except for the title)! Lines starting with a &gt; (such as this one) should be removed. Please use markdown instead of HTML (e.g., ` instead of `)."><link data-rh="true" rel="icon" href="/img/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://grants.web3.foundation/applications/P2PStateChannels"><link data-rh="true" rel="alternate" href="https://grants.web3.foundation/applications/P2PStateChannels" hreflang="en"><link data-rh="true" rel="alternate" href="https://grants.web3.foundation/applications/P2PStateChannels" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9VKKGZO0U1-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Web3 Foundation Grants" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.f3a7e75f.css">
<script src="/assets/js/runtime~main.785706f9.js" defer="defer"></script>
<script src="/assets/js/main.f737dd4d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#000;color:#ffffff" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><a target="_blank" rel="noopener noreferrer" href="https://medium.com/web3foundation/web3-foundation-ecodev-wave-26-7f145c39c2ef">Our blog post on Ecosystem Development Wave 26 is now online!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/w3f_logo.svg" alt="W3F Grants Program" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/w3f_logo.svg" alt="W3F Grants Program" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Grants Program</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/applications">List of Grants</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/docs/Process/how-to-apply">Apply</a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>P2P State Channels</h1></header>
<blockquote>
<p>This document will be part of the terms and conditions of your agreement and, therefore, needs to contain all the required information about the project. Don&#x27;t remove any of the mandatory parts presented in bold letters or as headlines (except for the title)! Lines starting with a <code>&gt;</code> (such as this one) should be removed. Please use markdown instead of HTML (e.g., <code>![](image.png)</code> instead of <code>&lt;img&gt;</code>).</p>
<p>See the <a href="https://github.com/w3f/Grants-Program/#pencil-process" target="_blank" rel="noopener noreferrer">Grants Program Process</a> on how to submit a proposal.</p>
</blockquote>
<ul>
<li><strong>Team Name:</strong> SIGMA 8 SOLUTIONS</li>
<li><strong>Payment Details:</strong>
<ul>
<li><strong>DOT</strong>: 15ZzLCvcrZXDCddQnUGgzNUcMkSK4PugKdraQp8pFawoDWz1</li>
<li><strong>USDT (Asset Hub)</strong>: 15ZzLCvcrZXDCddQnUGgzNUcMkSK4PugKdraQp8pFawoDWz1</li>
</ul>
</li>
<li><strong><a href="https://github.com/w3f/Grants-Program/tree/master#level_slider-levels" target="_blank" rel="noopener noreferrer">Level</a>:</strong> 3</li>
</ul>
<blockquote>
<p>‚ùó<!-- --> <em>The combination of your GitHub account submitting the application and the payment address above will be your unique identifier during the program. Please keep them safe.</em></p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-overview-page_facing_up">Project Overview <!-- -->üìÑ<a href="#project-overview-page_facing_up" class="hash-link" aria-label="Direct link to project-overview-page_facing_up" title="Direct link to project-overview-page_facing_up">‚Äã</a></h2>
<p>The tech part (minimal feature set - MFS) of our previous DF proposal - <a href="https://docs.google.com/document/d/1DcDFScgeXijnXSGuaa30uOnYNtRm_9OnAsM97igrSwA/" target="_blank" rel="noopener noreferrer">https://docs.google.com/document/d/1DcDFScgeXijnXSGuaa30uOnYNtRm_9OnAsM97igrSwA/</a></p>
<h1>Overview</h1>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tagline">Tagline:<a href="#tagline" class="hash-link" aria-label="Direct link to Tagline:" title="Direct link to Tagline:">‚Äã</a></h3>
<p>Framework for creating client side peer-to-peer (p2p) state channels for arbitrary state machines with shared security inherited from a distributed ledger (blockchain). All the peer-to-peer networking is done between users‚Äô clients.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="brief-description">Brief description:<a href="#brief-description" class="hash-link" aria-label="Direct link to Brief description:" title="Direct link to Brief description:">‚Äã</a></h3>
<p>The main goal of the project is to create fully peer-to-peer applications (without any central servers) that are highly scalable, resilient and secure, but also provide the building blocks by solving common problems to enable others to do the same.</p>
<p>Peer-to-peer (p2p) state channels have many benefits‚Äîthey‚Äôre highly scalable and decentralized due to their network topology and tendency to partition state within their group of interaction. They offer real-time communication that‚Äôs ‚Äòfree‚Äô (no transaction fee) but do not act like a trusted party like blockchains do.</p>
<p>What we aim to achieve is combine the best of both worlds, the decentralized and scalable nature of full p2p systems, while also inheriting full security from a distributed ledger.</p>
<p>Notice that society works in the exact same way. For most of our lives, we (peers) interact with other peers in small groups (partitions). We (peers) form agreements and commit to faithfully executing on them and in the case where those agreements fail, we go to a court system to dispute one another inorder to enforce those agreements. The courts have limited capacity and their intervention is slow and expensive, but they are trusted by all parties (that freely chose to be in that jurisdiction) to be impartial, objective and faithfully come to a verdict on the agreement/law (state machine).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-this-relate-to-polkadot">How does this relate to Polkadot<a href="#how-does-this-relate-to-polkadot" class="hash-link" aria-label="Direct link to How does this relate to Polkadot" title="Direct link to How does this relate to Polkadot">‚Äã</a></h3>
<p>The value proposition for Polkadot is improving the user experience by providing a ‚Äòfree‚Äô real-time execution environment which all parachains currently lack and expanding the market by onboarding new users and developers into the ecosystem.</p>
<h1>Project Details</h1>
<p>This section will be used to expand on the technical solution and the architecture.</p>
<p>The system is composed of a client side framework/SDK and on-chain smart contracts.</p>
<p>Tech stack:
On-chain: smart contracts (solidity)
Off-chain (p2p) - written in typescript, holepunch for p2p and discovery, ethereumjs for running the EVM on client, ethers for manipulating and signing evm data and everything else is built from scratch (typescript). The entire design is state machine and runtime independent (can support substrate) - it works with native tooling.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-main-responsibilities-of-the-client-side-framework-are">The main responsibilities of the client side framework are:<a href="#the-main-responsibilities-of-the-client-side-framework-are" class="hash-link" aria-label="Direct link to The main responsibilities of the client side framework are:" title="Direct link to The main responsibilities of the client side framework are:">‚Äã</a></h3>
<ol>
<li>Networking - establishing direct peer-to-peer connections and discovery over various transports (currently Holepunch),</li>
<li>State machine replication - allowing connected peers to commit to state machines and allowing them to progress and replicate those state machines,</li>
<li>Agreement tracking - tracking agreements on the order of transactions and state, managing forks, checking and collecting signatures, finalizing state</li>
<li>Virtual (logical) clock - Having a local logical clock that‚Äôs synced to the DLT clock (timestamp) - allows peers to have a local perception of time that mimics the one of the DLT, but tolerates skewness to a degree. This is of course subjective and peers will never reach consensus on the clock nor with other peers nor with the DLT itself. This is very important and will be discussed further below,</li>
<li>Dispute handling - constructing fraud proofs when a peer deviates from the protocol,</li>
<li>Observing and notifying on state change - hooks that allow external systems to subscribe and get notified when state changes happen - analogous to on-chain events.</li>
</ol>
<h1></h1>
<ol>
<li>
<p>P2PManager
Manages all peer-to-peer connections - how they‚Äôre established, which transport is used, receiving and broadcasting messages (RPCs) to other peers.
The message is interpreted on the RPC level and passed through appropriate pipelines based on the type of RPC. In the case of transactions, they‚Äôre forwarded to the StateManager for further processing.</p>
</li>
<li>
<p>StateManger
The central component of the system. It‚Äôs responsible for maintaining the correct state. It receives both p2p messages (transactions) and emitted events that happened on-chain.</p>
</li>
</ol>
<p>Received transactions pass through a verification pipeline (check signatures, is the signer part of the state channel, is it a duplicate, check timestamp, does it apply to the current state‚Ä¶). If all the checks pass, the transaction is applied to the state machine by invoking the stateTransition function. If everything is executed successfully, the signedTransaction is passed to the AgreementManager. If something fails, a dispute is invoked on-chain (if a cryptographic proof can be created to prove fraud)</p>
<p>Received on-chain events - SetState is emitted when the DLT enforces a correct state of the state machine. This creates a fork (check Agreements and Forks) and sets the genesis state for the fork. This and everything else that‚Äôs enforced through the DLT is accepted as correct unconditionally, since the DLT is the single uncontested source of truth and every honest peer continues building on the latest fork.</p>
<p>Timeout -
This is another responsibility of the StateManager.
There are 3 objective time parameters set for each state machine during creation:</p>
<p>p2pTime -  the max amount of time a peer can take to decide, execute and broadcast their Tx to other peers,
agreementTime - accounts for reasonable network delay, execution time and skewness of clocks. All agreements on the Tx (state transition) should happen within this time,
chainFallbackTime - if p2p agreements fail within p2pTime + agreementTime, this is the last resort allowing peers to post on chain.</p>
<p>When a peer fails to produce and broadcast a transaction that will progress the state machine forward within p2pTime + agreementTime in comparison to the previous transaction timestamp (each peer does this calculation in comparison to their local logical clock (this is subjective - see Clock)) - other peers won‚Äôt sign the transactionConfirmation even if they receive the transaction later. The peer still has time to invoke their transaction, but is forced to post the transaction on-chain as calldata (lazy execution) within chainFallbackTime. If the peer fails to do so and does not have all N signatures after that time expires (in comparison to the DLT clock), any peer (usually the one(s) that didn‚Äôt sign the confirmation) can invoke a dispute to remove the peer from the state channel (see Dispute Logic). The peer that was removed can challenge this dispute by providing all N signatures (confirmations) on the transaction and if successful the removal is reverted and the peer who initiated the dispute is removed and is fully slashed (penalty for byzantine behavior).</p>
<p>An honest peer can produce and broadcast a Tx that progresses the state machine forward within p2pTime + agreementTime, but another (byzantine) peer can refuse to sign the message confirmation and in such the issuing peer will never have all N signatures and will again be forced to post on-chain inorder to guarantee it won‚Äôt be removed from the state channel. In that case the peer will refuse to sign confirmations of transactions from other peers that failed to sign its transaction, forcing them to also post calldata on-chain. Like this, both peers are at an economic disadvantage, since posting on-chain invokes transaction fees, so the optimal move is to cooperate to save on transaction fees, knowing that failure to cooperate results in economic costs. However, the DLT will guarantee correct progression of the state machine even if only 1 peer is honest and all N-1 are byzantine. (see Agreements)</p>
<p>Clock
Every peer has a local subjective logical clock. The clock is synced with the DLT
clock (timestamp) in order to provide a local perception of time that mimics the DLT
time. Peers will never reach consensus on their clocks nor amongst themselves nor<br>
<!-- -->with the DLT itself. The protocol is designed to tolerate skewness to a degree. Peers use their clock to decide subjectively, how they want to interact with the system and other peers -  are incoming transactions too far in the future, too far in the past or about in time and based on their subjective opinion they come to an agreement or abstain from signing p2p. They use this clock also to invoke Timeout. While the perception of time is subjective and is designed to tolerate skewness to a degree, once measured and recorded as a timestamp, that information is objective and comparable. While each peer will compare it to their local clock and try to form agreements, if such agreements fail p2p and the system falls back on-chain, the DLT clock will prevail as a single uncontested source of truth and its comparison of the tx timestamp to its clock will be final.</p>
<ol start="3">
<li>AgreementManager (Agreements)
The system does NOT implement a variation of a classical BFT (Byzantine Fault Tolerant) consensus algorithm due to lack of large economic security amongst peers in a partition and the strong design principle to allow everyone to connect freely with everyone. As such the system can‚Äôt guarantee that within a partition there will not be less than ‚Öì byzantine actors as required by all classical BFT consensus algorithms. Since the DLT is used as a top level ‚Äúsupreme court‚Äù, we can design an optimistic consensus algorithm that tolerates N-1 byzantine actors - in other words we can design a system that‚Äôs Byzantine Fault Tolerant with at least 1 honest (non byzantine) actor by ultimately inheriting security from a DLT.</li>
</ol>
<p>Before explaining optimistic consensus, it‚Äôs important to understand the structure of a Transaction in this system:</p>
<p>A transaction in this system references the exact state (previousStateHash) to which it is an input, and references the expected state post execution (stateHash). This resembles the logic behind UTXOs to a degree.</p>
<p>Under optimistic consensus we can‚Äôt force peers to collaborate, but it‚Äôs in their best interest to do so, since failure to collaborate at best invokes posting calldata on-chain and paying transaction fees and at worst results in a full slash when provable fraud can be detected. Collaboration includes signing (confirming) all valid transactions without delay (satisfying agreementTime) and producing and broadcasting a transaction when it‚Äôs the peers turn to progress the state machine forward before timeout (check Timeout).</p>
<p>Optimistic consensus is reached when all N signatures directly or indirectly (check Virtual Voting) reference the transaction (state). This finalizes the transaction (state). With at least 1 honest peer, an invalid state will never be finalized.</p>
<p>If for any reason a peer doesn‚Äôt collect all N signatures on their issued transaction after agreement time, the peer will post their transaction on-chain (see Timeout). The peer will also opt out of signing transaction confirmations from peers that didn‚Äôt sign its transaction, forcing them too to post on-chain and too being at an economic disadvantage. Peers can at any time request to exit the state channel directly on the DLT if they don‚Äôt want to interact with other peers within the channel (subjective reputation and web of trust can help the peer initially decide with whom they want to connect, but is not required by the core protocol).</p>
<p>Virtual Voting - Same concept as with blocks in a blockchain. Since blocks are cryptographically linked with past blocks through the parent hash, a block at block height K indirectly supports and thus votes for all previous K-1 blocks that precede it. In our case, a transaction issued is connected directly to the previous transaction through the previousStateHash and since this is recursive, it votes for all previous transactions that precede it. This is really practical, since a byzantine actor not wishing to sign confirmations of other peers will at some point have to produce a valid transaction or be removed through Timeout - producing a valid transaction indirectly confirms all previous transactions. This property is very useful especially with round robin leader election (block production / who writes next) and guarantees that at most the last N transactions are enough to finalize a state even if no one wants to directly cooperate peer-to-peer.</p>
<p>Forks -
Forks ideally never happen and everyone cooperates fully p2p, without the need for the DLT ever to enforce a state, but in the case when the DLT has to step in, it creates a fork and sets the genesis state. The genesis state of a fork doesn‚Äôt require N signatures to be considered final since it‚Äôs enforced directly on the distributed ledger. Honest (non byzantine) peers always build on the latest fork.</p>
<ol start="4">
<li>
<p>DisputeHandler -
Whenever a peer detects deviation from the protocl, they initiate a dispute by going through the DisputeHandler, which creates a dispute on-chain asking the DLT to enforce a correct state. To initiate a dispute a peer provides the last known finalized transaction (state) + all the transactions till the latest one the peer signed (confirmed) (this is at most N transactions in total - see Virtual Voting). After initiating a dispute, the peer stops signing transactions for the given fork. Due to the chain not having all the data and ideally not having any, the disputes are not final and have a challenge period where they can be contested. If successfully challenged (by providing more data), the disputter is fully slashed, a correct state is enforced and the challenge window prolonged. All honest peers check the disputed data and without delay challenge it if possible, otherwise they continue building on the fork and let the challenge period expire. More details on Dispute Logic down below when we cover on-chain logic.</p>
</li>
<li>
<p>DLTEventListener -
Observes the DLT for relative events and passes them to the StateManager.
In V1 the blockchain interaction will be done through a provider, which the peers trust. In V2 we‚Äôll explore options of making peers ultra light clients so they can access the DLT directly and increase resilience (the bootstrapping problem makes this slight optimization not worth considering in V1, since some node has to always be trusted to provide the data).</p>
</li>
<li>
<p>AStateMachine -
Abstract state machine that defines the base class/contract of compatible state machines. While any state and state transition can be implemented and thus supporting arbitrary state machines, the system does require a minimal interface with some minimal properties.</p>
</li>
<li>
<p>StateObserver -
Observes the concrete state machine and allows for other systems to subscribe for updates when the state changes. Analogous to on-chain events.</p>
</li>
</ol>
<p>The main responsibilities of on-chain smart contracts are:</p>
<ol>
<li>Agreement verification - Verifies that all participants agree on a given state,</li>
<li>Dispute resolution (shared security) - Enforcing a correct state of the state machine if peer-to-peer agreements fail,</li>
<li>Settlement - final settlement of any assets that entered into the state channel,</li>
<li>Data Availability - Guaranteeing data availability for both state and transaction calldata if peer-to-peer agreements fail,</li>
<li>Liveness guarantees - In the case that the state machine can‚Äôt progress peer-to-peer, the DLT can progress it and remove any participants who failed to progress it within timeout,</li>
<li>Objective clock - provides a single global clock (timestamp) that‚Äôs uncontested and accepted as correct/true unconditionally. Peers sync their local logical clock to the DLT clock to mimic the DLT perception of time,</li>
</ol>
<p>Fraud proofs - fraud proofs in our system vastly differ from the ones of Optimistic Rollups such as Arbitrum/Optimism. The fraud proofs in their system are designed to work for servers that are handling transactions on behalf of other users and as such they have to post all the calldata on-chain for everyone to see and verify correctness or detect fraud. This is more expensive and less scalable, since more of the on-chain limited resources are being used. There are also no liveness guarantees, if the sequencer stops producing blocks.</p>
<p>In our system, all the transactions being executed within the channel belong solely to the participants of the channel and as such they don&#x27;t need to guarantee data availability for external parties. Data Availability comes into play only when peers fail to cooperate and as such its main goal is to guarantee data availability to other peers and provide a way to progress the state without cooperation or remove peers through Timeout.</p>
<p>ADisputeManager (Dispute Logic):
ADisputeManager is an abstract contract that implements all the dispute logic and provides an interface that the StateChannelManager contract must implement.</p>
<p>When a peer detects fraud locally, they initiate a dispute on-chain. In order to do so, they have to provide a proof of the last finalized state and all the transactions up to the last one the peer confirmed (this all can be done with at most the last N transactions and ideally with just 1 or 2). The peer also has to provide a fraud proof.</p>
<p>StateChannelManager:
There can exist many state channels in parallel (open channels) and as such this contract manages all state channels - opening/closing the channel, keeping track of state (bytes) without interpreting it, allowing multiple state machines to be linked and invoking the correct one when needed, allowing peers to post their Tx as calldata and guaranteeing Data Availability to all.</p>
<p>AStateMachine:
Abstract interface of a concrete state machine that only bears the state machine logic. Derived contracts execute p2p and when p2p agreements fail the same logic is used to enforce a correct state on-chan.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ecosystem-fit">Ecosystem Fit<a href="#ecosystem-fit" class="hash-link" aria-label="Direct link to Ecosystem Fit" title="Direct link to Ecosystem Fit">‚Äã</a></h3>
<p>Even though it will be built on top of the EVM, it&#x27;s needed more in Polkadot than in Ethereum, since Ethereum rollups offer &#x27;instant finality&#x27; to their users (they don&#x27;t wait for L1 finality). It&#x27;s compatible and built on top of native tooling. It&#x27;s designed to be state machine and runtime agnostic, meaning that substrate can be supported in the future, when we have more resources to build the nesessary tooling to support it. For now the focus is on the user experience, that all parachains currently lack by having a real-time execution environmet without transaction fees.</p>
<p>Where and how does your project fit into the ecosystem?</p>
<ul>
<li>On the core tech it fits as a public good / infrastructure by allowing everyone to build secure real-time p2p dApps. On the concrete state machines that we do/build, those are clearly dApps and provide a direct benefit to the end user. On the governance and upgrade side, Polkadot is the best fit by a long shot considering how it handles upgrades in contrast to others.</li>
</ul>
<p>Who is your target audience (parachain/dapp/wallet/UI developers, designers, your own user base, some dapp&#x27;s users, yourself)?</p>
<ul>
<li>The end user that uses the dApps is the target audience. That‚Äôs where the business model is.</li>
</ul>
<p>What need(s) does your project meet?</p>
<ul>
<li>Web2 user experience through real time communication that‚Äôs ‚Äòfree‚Äô, with web3 security guarantees.</li>
</ul>
<p>Are there any other projects similar to yours in the Substrate / Polkadot / Kusama ecosystem?</p>
<ul>
<li>Not that we‚Äôre aware of, not only in Polkadot / Kusama, but web3 in general since the state channels that are adopted are mostly payment channels and those are servers and in general all the scaling in web3 has been done on the ‚Äòserver‚Äô side, while we focus fully on the client side.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="team-busts_in_silhouette">Team <!-- -->üë•<a href="#team-busts_in_silhouette" class="hash-link" aria-label="Direct link to team-busts_in_silhouette" title="Direct link to team-busts_in_silhouette">‚Äã</a></h2>
<blockquote>
<p>Please note that the data provided in this section is for administrative and informational purposes only. All beneficiaries of a grant must also be listed in the KYC/KYB process during the application phase. See our <a href="https://grants.web3.foundation/docs/faq#what-is-kyckyb-and-why-do-i-have-to-provide-this-data" target="_blank" rel="noopener noreferrer">FAQ</a> for more info.</p>
</blockquote>
<h1>Team members</h1>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="partially-grant-supported">Partially grant supported:<a href="#partially-grant-supported" class="hash-link" aria-label="Direct link to Partially grant supported:" title="Direct link to Partially grant supported:">‚Äã</a></h3>
<p>Founder - Luka Stanisic
<a href="https://github.com/lukastanisic99" target="_blank" rel="noopener noreferrer">https://github.com/lukastanisic99</a>
<a href="https://www.linkedin.com/in/luka-stanisic-712907251/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/luka-stanisic-712907251/</a></p>
<p>Engineer - Dragan Basta
<a href="https://github.com/thepeaknick" target="_blank" rel="noopener noreferrer">https://github.com/thepeaknick</a>
<a href="https://www.linkedin.com/in/dragan-basta/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/dragan-basta/</a></p>
<p>Designer - Aleksa Krstic
<a href="https://www.linkedin.com/in/aleksa-krstic-124880112/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/aleksa-krstic-124880112/</a></p>
<p>Business development - Aleksa Gradinski
<a href="https://www.linkedin.com/in/aleksa-gradinski/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/aleksa-gradinski/</a></p>
<p>Business development - Gerard Murphy
<a href="https://www.linkedin.com/in/gerard-murphy-8939b520/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/gerard-murphy-8939b520/</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="advisors--not-grant-supported">Advisors / Not grant supported:<a href="#advisors--not-grant-supported" class="hash-link" aria-label="Direct link to Advisors / Not grant supported:" title="Direct link to Advisors / Not grant supported:">‚Äã</a></h3>
<p>Cryptography - Jeffrey Burdges
<a href="https://github.com/burdges" target="_blank" rel="noopener noreferrer">https://github.com/burdges</a>
<a href="https://www.linkedin.com/in/jeffreyburdges/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/jeffreyburdges/</a></p>
<p>Economics &amp; legal - Kasper Mai J√∏rgensen
<a href="https://www.linkedin.com/in/kmjoergensen/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/kmjoergensen/</a></p>
<p>Engineering - Andrew Burger
<a href="https://github.com/coax1d" target="_blank" rel="noopener noreferrer">https://github.com/coax1d</a>
<a href="https://www.linkedin.com/in/andrew-b-8a628870" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/andrew-b-8a628870</a></p>
<h1>Contact</h1>
<ul>
<li><strong>Contact Name:</strong> Luka Stanisic</li>
<li><strong>Contact Email:</strong> <a href="mailto:lukastanisic2@gmail.com" target="_blank" rel="noopener noreferrer">lukastanisic2@gmail.com</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="legal-structure">Legal Structure<a href="#legal-structure" class="hash-link" aria-label="Direct link to Legal Structure" title="Direct link to Legal Structure">‚Äã</a></h3>
<ul>
<li><strong>Registered Address:</strong> Beogradska 55, 11194 Rusanj, Serbia</li>
<li><strong>Registered Legal Entity:</strong> SIGMA 8 SOLUTIONS (LLC)</li>
</ul>
<h1>Team&#x27;s experience</h1>
<p>Luka - Background in engineering, protocol level of different DLTs (DAGs and blockchains), distributed systems at Microsoft Azure, Polkadot Blockchain Academy alumni with distinction.</p>
<p>Dragan - Software engineer with 10+ years of experience.</p>
<p>Aleksa Krstic - Senior UX/UI designer at another major DLT.</p>
<p>Aleksa Gradinski - In crypto since 2017, CEO of Agroblock ($1M annual profit), helped in negotiations and expansion of leading web3 companies in Serbia.</p>
<p>Gerard - Engineering degree holder with over a decade in high-end business development, overseeing multiple offices in the London property market. 15 years of professional poker playing and game theory expertise, bringing a strategic and analytical approach to business growth and a specific understanding of peer-to-peer commercial opportunities.</p>
<p>Jeff - Applied cryptographer and mathematician at the Web3 Foundation. One of the lead protocol designers behind Polkadot and Kusama.</p>
<p>Kasper - ex CFO Web3 Foundation and co-founder Polimec.</p>
<p>Andrew - Researcher/Engineer at the Web3 Foundation</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="development-status-open_book">Development Status <!-- -->üìñ<a href="#development-status-open_book" class="hash-link" aria-label="Direct link to development-status-open_book" title="Direct link to development-status-open_book">‚Äã</a></h2>
<p>In progress.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="development-roadmap-nut_and_bolt">Development Roadmap <!-- -->üî©<a href="#development-roadmap-nut_and_bolt" class="hash-link" aria-label="Direct link to development-roadmap-nut_and_bolt" title="Direct link to development-roadmap-nut_and_bolt">‚Äã</a></h2>
<p>Provide an SDK with a minimal set of features for alpha testing as soon as possible.</p>
<h1>Overview</h1>
<ul>
<li><strong>Total Estimated Duration:</strong> 3 months</li>
<li><strong>Full-Time Equivalent (FTE):</strong> Currently 1 person 24/7 and many part time with the team target going forward being 7 FTE</li>
<li><strong>Total Costs:</strong> $100000 - this covers the scope of this implementation</li>
<li><strong>DOT %:</strong> 50% (we&#x27;re open to taking 100% in DOT, with 50% being vested over 2 years)</li>
</ul>
<h1>Milestone 1 and budget ‚Äî Minimal feature set (MFS) - Blockchain components</h1>
<ul>
<li><strong>Estimated duration:</strong> 1.5 month</li>
<li><strong>Costs:</strong> 50000 USD</li>
</ul>
<table><thead><tr><th style="text-align:right">Number</th><th>Deliverable</th><th>Specification</th></tr></thead><tbody><tr><td style="text-align:right"><strong>0a.</strong></td><td>License</td><td>MIT</td></tr><tr><td style="text-align:right"><strong>0b.</strong></td><td>Documentation</td><td>We&#x27;ll provide examples and documentation on how to use the system. We&#x27;ll also provide a video tutorial.</td></tr><tr><td style="text-align:right"><strong>0c.</strong></td><td>Testing and Testing Guide</td><td>Core functions will be fully covered by comprehensive unit tests to ensure functionality and robustness. In the guide, we will describe how to run these tests.</td></tr><tr><td style="text-align:right"><strong>0d.</strong></td><td>Docker</td><td>We will provide a Dockerfile that can be used to test all the functionality delivered with this milestone.</td></tr><tr><td style="text-align:right">1.</td><td>Channel Opening</td><td>All the logic required to open channels. Commitment to arbitrary state machine logic (bytecode) as defined in the document above. Performs all composable operations on the global state as required by the user specific state machine (depositing assets, interacting with other contracts). Atomic success or failure.</td></tr><tr><td style="text-align:right">2.</td><td>Cryptography</td><td>Cryptographic primitives to support threshold signature verification. Algorithm: ECDSA as used in Ethereum. Working with vanila EVM opcodes (no precompiles). Simple treshold algorithm. Base algorithm uses a highly audited library (openzeppelin).</td></tr><tr><td style="text-align:right">3.</td><td>Liveness</td><td>Liveness logic to progress the state channel even when peer-to-peer agreements fail. Part of the dispute resolution as defined in the document above. Posting calldata, invoking timeout logic and challenge when needed. Described in great detail above in timeout logic and optimistic consensus.</td></tr></tbody></table>
<h1>Milestone 2 and budget ‚Äî Minimal feature set (MFS) - Client side components (sdk/framework)</h1>
<ul>
<li><strong>Estimated duration:</strong> 1.5 month</li>
<li><strong>Costs:</strong> 50000 USD</li>
</ul>
<table><thead><tr><th style="text-align:right">Number</th><th>Deliverable</th><th>Specification</th></tr></thead><tbody><tr><td style="text-align:right"><strong>0a.</strong></td><td>License</td><td>MIT</td></tr><tr><td style="text-align:right"><strong>0b.</strong></td><td>Documentation</td><td>We&#x27;ll provide examples and documentation on how to use the system. We&#x27;ll also provide a video tutorial.</td></tr><tr><td style="text-align:right"><strong>0c.</strong></td><td>Testing and Testing Guide</td><td>Core functions will be fully covered by comprehensive unit tests to ensure functionality and robustness. In the guide, we will describe how to run these tests.</td></tr><tr><td style="text-align:right"><strong>0d.</strong></td><td>Docker</td><td>We will provide a Dockerfile that can be used to test all the functionality delivered with this milestone.</td></tr><tr><td style="text-align:right">0e.</td><td>Article</td><td>We will publish an <strong>article</strong> that explains what was done as part of the grant</td></tr><tr><td style="text-align:right">1.</td><td>Networking and Discovery</td><td>Establishing p2p connections and discovery over holepunch. Using a permissionless DHT (distributed hash table) for peers to discover one another and using the holepunch algorithm to establish a direct peer-to-peer connection.</td></tr><tr><td style="text-align:right">2.</td><td>P2P State Machine</td><td>Running native smart contracts fully p2p.</td></tr><tr><td style="text-align:right">3.</td><td>Agreement Tracking</td><td>Tracking agreement on the state machine&#x27;s state. Described in great detail above under agreement tracking</td></tr><tr><td style="text-align:right">4.</td><td>Dispute Handling</td><td>Invoking liveness logic when p2p state progression fails. Described in details above under disputes and timeout.</td></tr><tr><td style="text-align:right">5.</td><td>Virtual Clock</td><td>Using the DLT clock as the single source of truth in regards to time. Described in detail above under virtual clock.</td></tr><tr><td style="text-align:right">6.</td><td>Observing &amp; Notifying</td><td>Hooks that allow external systems to subscribe and get notified when state changes happen. Described in detail above under observing and notifying on state change.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-plans">Future Plans<a href="#future-plans" class="hash-link" aria-label="Direct link to Future Plans" title="Direct link to Future Plans">‚Äã</a></h2>
<p>Everything we build, we build with resiliency, decentralization and scalability in mind. We never want to introduce a centralized server in our design or run any infrastructure. This offers a clear benefit to our users, but also to us, since we don‚Äôt have to maintain servers and our operational costs converge to 0 overtime. Our only long term costs should be development of new state machines and improving existing ones. We plan on picking and developing state machines that provide real utility, without any ponzi (unsustainable) economics. We want them to be useful and a better alternative to existing solutions today. We believe the systems we create can offer the good user experience of web2 (centralized) systems, with all of the web3 (decentralized) security and permissionless guarantees.</p>
<p>While the core infrastructure will always remain free as a public good and accessible to everyone, the concrete state machines will have a business model that‚Äôs sustainable.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-information-heavy_plus_sign">Additional Information <!-- -->‚ûï<a href="#additional-information-heavy_plus_sign" class="hash-link" aria-label="Direct link to additional-information-heavy_plus_sign" title="Direct link to additional-information-heavy_plus_sign">‚Äã</a></h2>
<p>** Continuation of our DF proposal - Web3 Foundation</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/w3f/Grants-Program/edit/master/applications/P2PStateChannels.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-overview-page_facing_up" class="table-of-contents__link toc-highlight">Project Overview üìÑ</a><ul><li><a href="#tagline" class="table-of-contents__link toc-highlight">Tagline:</a></li><li><a href="#brief-description" class="table-of-contents__link toc-highlight">Brief description:</a></li><li><a href="#how-does-this-relate-to-polkadot" class="table-of-contents__link toc-highlight">How does this relate to Polkadot</a></li><li><a href="#the-main-responsibilities-of-the-client-side-framework-are" class="table-of-contents__link toc-highlight">The main responsibilities of the client side framework are:</a></li><li><a href="#ecosystem-fit" class="table-of-contents__link toc-highlight">Ecosystem Fit</a></li></ul></li><li><a href="#team-busts_in_silhouette" class="table-of-contents__link toc-highlight">Team üë•</a><ul><li><a href="#partially-grant-supported" class="table-of-contents__link toc-highlight">Partially grant supported:</a></li><li><a href="#advisors--not-grant-supported" class="table-of-contents__link toc-highlight">Advisors / Not grant supported:</a></li><li><a href="#legal-structure" class="table-of-contents__link toc-highlight">Legal Structure</a></li></ul></li><li><a href="#development-status-open_book" class="table-of-contents__link toc-highlight">Development Status üìñ</a></li><li><a href="#development-roadmap-nut_and_bolt" class="table-of-contents__link toc-highlight">Development Roadmap üî©</a></li><li><a href="#future-plans" class="table-of-contents__link toc-highlight">Future Plans</a></li><li><a href="#additional-information-heavy_plus_sign" class="table-of-contents__link toc-highlight">Additional Information ‚ûï</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More Info</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/w3f/Grants-Program" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://web3.foundation/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Support Docs/privacy_policy">Privacy Policy</a></li><li class="footer__item"><a href="https://web3.foundation/legal-disclosures/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Legal Disclosures</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Connect</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/Web3foundation" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://matrix.to/#/!XpynPDLusWUWfDpaqr:matrix.org?via=web3.foundation&amp;via=matrix.org&amp;via=matrix.parity.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Grants Community Matrix Channel<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">¬© 2025 Web3 Foundation</div></div></div></footer></div>
</body>
</html>