<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-applications/parachain-staking">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Pallet-dPoS for Parachain Staking | Web3 Foundation Grants</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://w3f.github.io/Grants-Program/applications/parachain-staking"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Pallet-dPoS for Parachain Staking | Web3 Foundation Grants"><meta data-rh="true" name="description" content="Proposer:* Moonbeam Network"><meta data-rh="true" property="og:description" content="Proposer:* Moonbeam Network"><link data-rh="true" rel="icon" href="/Grants-Program/img/Web3Foundation.png"><link data-rh="true" rel="canonical" href="https://w3f.github.io/Grants-Program/applications/parachain-staking"><link data-rh="true" rel="alternate" href="https://w3f.github.io/Grants-Program/applications/parachain-staking" hreflang="en"><link data-rh="true" rel="alternate" href="https://w3f.github.io/Grants-Program/applications/parachain-staking" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9VKKGZO0U1-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Web3 Foundation Grants" href="/Grants-Program/opensearch.xml"><link rel="stylesheet" href="/Grants-Program/assets/css/styles.d8e07fe7.css">
<link rel="preload" href="/Grants-Program/assets/js/runtime~main.ffda9fac.js" as="script">
<link rel="preload" href="/Grants-Program/assets/js/main.a9dc2d54.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#000;color:#ffffff" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Check out <a target="_blank" rel="noopener noreferrer" href="https://web3.bamboohr.com/jobs/">our current job openings</a>!</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Grants-Program/"><div class="navbar__logo"><img src="/Grants-Program/img/Web3Foundation.png" alt="W3F Grants Program" class="themedImage_ToTc themedImage--light_HNdA"><img src="/Grants-Program/img/Web3Foundation.png" alt="W3F Grants Program" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">W3F Grants Program</b></a><a class="navbar__item navbar__link" href="/Grants-Program/docs/introduction">Introduction</a><a class="navbar__item navbar__link" href="/Grants-Program/applications">List of Grants</a><a class="navbar__item navbar__link" href="/Grants-Program/docs/faq">FAQ</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/Grants-Program/docs/Process/how-to-apply">Apply</a><a class="navbar__item navbar__link" href="/Grants-Program/docs/contribute">Contribute</a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Pallet-dPoS for Parachain Staking</h1><ul><li><strong>Proposer:</strong> <a href="https://github.com/PureStake/moonbeam" target="_blank" rel="noopener noreferrer">Moonbeam Network</a></li><li><strong>Payment Address:</strong> 0x9a66721302d9f30a9d11cf48a09c7ef1a842b5c8</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-overview-">Project Overview ðŸ“„<a href="#project-overview-" class="hash-link" aria-label="Direct link to Project Overview ðŸ“„" title="Direct link to Project Overview ðŸ“„">â€‹</a></h2><p>Moonbeam is an Ethereum-compatible parachain built with Substrate. Since January 2021, Moonbeam&#x27;s runtime developer team has written and maintained a delegated Proof of Stake (dPoS) implementation designed specifically for parachains called <a href="https://github.com/PureStake/moonbeam/tree/master/pallets/parachain-staking/src" target="_blank" rel="noopener noreferrer"><code>parachain-staking</code></a>. To make this code useful for other parachain teams, Moonbeam is applying for ecosystem funding to extend, benchmark, and document its dPoS implementation.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a href="#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">â€‹</a></h3><p>In the Polkadot consensus model, parachains have different requirements and constraints than the relay chain. While <code>frame/pallet-staking</code> offers many features necessary for relay chain consensus and shared security, it is overkill for parachains, which operate with more limited execution resources.</p><p>Instead of running an on-chain election, <a href="https://github.com/PureStake/moonbeam/tree/master/pallets/parachain-staking/src" target="_blank" rel="noopener noreferrer"><code>parachain-staking</code></a> implements direct delegation with a bounded number of nominations per <code>AccountId</code> (maximum of <code>Config::MaxCollatorsPerNominator</code> per account). In this paradigm, token holders (nominators) express exactly which collator candidates they would like to support and with what quantity of stake.</p><p>There is a new round every <code>&lt;Round&lt;T&gt;&gt;::get().length = 600</code> blocks. At the start of each round, the top <code>&lt;TotalSelected&lt;T&gt;&gt;::get() = 16</code> collator candidates (in terms of total backing stake) are chosen to be in the active collator set. At every block, a subset of this active collator set is chosen pseudorandomly by the <code>author-filter</code> pallet as valid block authors. Only valid block authors can produce blocks.</p><p>Block authors are logged via the <code>set_author_inherent</code> method in the <code>author-inherent</code> pallet. The logic in this runtime method reports each block author to <code>parachain-staking</code>, which distributes inflation rewards after a 2 round delay.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="team-">Team ðŸ‘¥<a href="#team-" class="hash-link" aria-label="Direct link to Team ðŸ‘¥" title="Direct link to Team ðŸ‘¥">â€‹</a></h2><ul><li><strong>Members:</strong> Derek Yoo, Alan Sapede, Antoine Estienne, Joshy Orndorff, Amar Singh</li><li><strong>LinkedIn Profiles</strong>: <a href="https://www.linkedin.com/in/derek-yoo-8a050/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/derek-yoo-8a050/</a>, <a href="https://www.linkedin.com/in/alansapede/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/alansapede/</a>,</li><li><strong>Code Repos:</strong> <a href="https://github.com/PureStake/moonbeam" target="_blank" rel="noopener noreferrer">https://github.com/PureStake/moonbeam</a></li><li><strong>Website:</strong> <a href="https://www.purestake.com/" target="_blank" rel="noopener noreferrer">https://www.purestake.com/</a>, <a href="https://moonbeam.network/" target="_blank" rel="noopener noreferrer">https://moonbeam.network/</a></li><li><strong>Legal Structure:</strong> PureStake Ltd, Floor 4, Willow House, Cricket Square, Grand Cayman, KY1-9010, Cayman Islands</li><li><strong>Team&#x27;s Experience:</strong> </li></ul><p>The PureStake team has extensive experience developing and delivering complex web2 software systems. In the last year, PureStake has built a number of web3 infrastructure projects including Algorand API Services (<a href="https://developer.purestake.io/" target="_blank" rel="noopener noreferrer">https://developer.purestake.io/</a>) and the Goalseeker block explorer (<a href="https://goalseeker.purestake.io/" target="_blank" rel="noopener noreferrer">https://goalseeker.purestake.io/</a>), among others.</p><p>Derek co-founded Fuze in 2006 and as CTO was responsible for engineering, technical operations, product management, and design as the company grew over time into a 700 person cloud business. Alan was responsible for large parts of the Fuze cloud backend. Before joining Fuze, Alan was on the Google Streetview Team and also worked at NVidia developing drivers.</p><p>Antoine has been developing Web3 Dapps since 2016. He has participated in 3 projects inside ConsenSys (VariabL, Localties and Fathom) and helped HyperNetwork build their token system. Now, he&#x27;s working for Moonbeam and has contributed to the polkadot-js suite (apps, common, api, etc).</p><p>Joshy and Amar worked at Parity on the Substrate Recipes.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="development-roadmap-">Development Roadmap ðŸ”©<a href="#development-roadmap-" class="hash-link" aria-label="Direct link to Development Roadmap ðŸ”©" title="Direct link to Development Roadmap ðŸ”©">â€‹</a></h2><ul><li><strong>Total Estimated Duration:</strong> 6 weeks</li><li><strong>Full-time equivalent (FTE):</strong> 2 FTE</li><li><strong>Total Costs:</strong> 30000 DAI</li></ul><p>Both milestones will be worked on in parallel, but UI development will lag changes to the pallet implementation.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="milestone-1-improve-parachain-staking-pallet">Milestone 1: Improve Parachain-Staking Pallet<a href="#milestone-1-improve-parachain-staking-pallet" class="hash-link" aria-label="Direct link to Milestone 1: Improve Parachain-Staking Pallet" title="Direct link to Milestone 1: Improve Parachain-Staking Pallet">â€‹</a></h3><ul><li><strong>Estimated Duration:</strong> 4 weeks </li><li><strong>Costs:</strong> 20000 DAI</li></ul><p>In addition to updating Rust crate-level docs and <a href="https://meta5.world/stake-docs/" target="_blank" rel="noopener noreferrer">outdated user-level docs</a> in step (5), we will also pursue the following changes to the current <a href="https://github.com/PureStake/moonbeam/tree/master/pallets/parachain-staking/src" target="_blank" rel="noopener noreferrer"><code>parachain-staking</code></a> implementation:</p><ol><li><p>Benchmark to derive transaction weights. This work has been started in <a href="https://github.com/PureStake/moonbeam/pull/372" target="_blank" rel="noopener noreferrer">this PR</a>.</p></li><li><p>Security Research Labs reported two critical vulnerabilities in <code>parachain-staking</code>: (i) total locked balance was not updated in <code>{collator, nominator}_bond_more</code> leading to a potential underflow error (which could trigger excessive issuance) (ii) bounded number of nominations per collator allowed any account to fill the slots with the minimum nomination thereby preventing higher nominations.</p></li><li><p>The inflation logic implemented in <a href="https://github.com/PureStake/moonbeam/blob/master/pallets/parachain-staking/src/inflation.rs" target="_blank" rel="noopener noreferrer"><code>parachain-staking</code></a> is minimal. Instead of integrating <code>pallet-staking</code>&#x27;s reward curve, the current implementation calculates per-round inflation derived from an annual inflation rate. Although the inflation rate can be updated by governance (sudo as of now), it is constant. Some parachain teams (i.e. Kilt) have requested configurable inflation that uses <code>pallet-staking</code>&#x27;s reward curve instead because it has been audited and reviewed more closely.</p></li><li><p>Moonbeam reserves 30% of inflation for future parachain bond(s). To support this functionality, <code>parachain-staking</code> added the storage item <code>ParachainBondConfig</code>. This storage item is updatable by the root origin; it configures the percent (30%) of inflation reserved as well as the <code>AccountId</code> which receives the reserved funds. This feature is convenient for parachains in the Polkadot ecosystem, all of which must pay rent to the network by locking funds in the parachain bond.</p></li></ol><table><thead><tr><th>Number</th><th>Deliverable</th><th>Specification</th></tr></thead><tbody><tr><td>0a.</td><td>License</td><td>GPL3</td></tr><tr><td>0d.</td><td>Documentation</td><td>Update Rust crate-level docs and <a href="https://meta5.world/stake-docs/" target="_blank" rel="noopener noreferrer">user-level docs</a> with implementation details.</td></tr><tr><td>1.</td><td>Benchmark</td><td>Benchmark the existing implementation to derive transaction weights and discern optimization opportunities.</td></tr><tr><td>2.</td><td>Patch SR-Labs Critical Vulnerabilities</td><td>Patch both critical vulnerabilities reported by SR labs.</td></tr><tr><td>3.</td><td>Configurable Inflation</td><td>Replace sudo with governance origin for setting inflation rate. Provide instructions for replacing constant inflation with <code>pallet-staking</code>&#x27;s reward curve logic.</td></tr><tr><td>4.</td><td>Configurable Parachain Bond Reservation</td><td>Add optional parachain bond configuration that enables reserving a portion of inflation for future parachain bonds.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="milestone-2-parachain-staking-polkadot-js-ui">Milestone 2: Parachain-Staking Polkadot-JS UI<a href="#milestone-2-parachain-staking-polkadot-js-ui" class="hash-link" aria-label="Direct link to Milestone 2: Parachain-Staking Polkadot-JS UI" title="Direct link to Milestone 2: Parachain-Staking Polkadot-JS UI">â€‹</a></h3><ul><li><strong>Estimated Duration:</strong> 4 weeks </li><li><strong>Costs:</strong> 10000 DAI</li></ul><table><thead><tr><th>Number</th><th>Deliverable</th><th>Specification</th></tr></thead><tbody><tr><td>0a.</td><td>License</td><td>Apache 2.0</td></tr><tr><td>1.</td><td>Custom Polkadot-JS UI</td><td>An overlay UI using polkadot-js similar to the <code>pallet-staking</code> UI</td></tr><tr><td>2.</td><td>PR polkadot-js apps</td><td>Make a pull request to polkadot-js apps with output</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-information-">Additional Information âž•<a href="#additional-information-" class="hash-link" aria-label="Direct link to Additional Information âž•" title="Direct link to Additional Information âž•">â€‹</a></h2><p>The current implementation has <a href="https://github.com/PureStake/moonbeam/blob/master/pallets/parachain-staking/src/tests.rs" target="_blank" rel="noopener noreferrer">significant unit test coverage</a> and this will be maintained throughout the changes listed in Milestone 1. There are also runtime integration tests written in Rust as well as TS integration tests. Maintenance is not explicitly included in the milestones because test coverage is already relatively comprehensive and we have an incentive to maintain it throughout the proposed changes.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/w3f/Grants-Program/edit/master/applications/parachain-staking.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-overview-" class="table-of-contents__link toc-highlight">Project Overview ðŸ“„</a><ul><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li></ul></li><li><a href="#team-" class="table-of-contents__link toc-highlight">Team ðŸ‘¥</a></li><li><a href="#development-roadmap-" class="table-of-contents__link toc-highlight">Development Roadmap ðŸ”©</a><ul><li><a href="#milestone-1-improve-parachain-staking-pallet" class="table-of-contents__link toc-highlight">Milestone 1: Improve Parachain-Staking Pallet</a></li><li><a href="#milestone-2-parachain-staking-polkadot-js-ui" class="table-of-contents__link toc-highlight">Milestone 2: Parachain-Staking Polkadot-JS UI</a></li></ul></li><li><a href="#additional-information-" class="table-of-contents__link toc-highlight">Additional Information âž•</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More Info</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/w3f/Grants-Program" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://web3.foundation/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/Grants-Program/docs/Support Docs/privacy_policy">Privacy Policy</a></li></ul></div><div class="col footer__col"><div class="footer__title">Connect</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/Web3foundation" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://matrix.to/#/!XpynPDLusWUWfDpaqr:matrix.org?via=web3.foundation&amp;via=matrix.org&amp;via=matrix.parity.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Grants Community Matrix Channel<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Â© 2023 Web3 Foundation</div></div></div></footer></div>
<script src="/Grants-Program/assets/js/runtime~main.ffda9fac.js"></script>
<script src="/Grants-Program/assets/js/main.a9dc2d54.js"></script>
</body>
</html>